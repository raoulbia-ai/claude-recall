{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/services/queue-integration.ts","mappings":";;;AAAA,2CAA8D;AAC9D,uCAA2C;AAC3C,qCAAyC;AACzC,qCAAyC;AAEzC;;;GAGG;AACH,MAAa,uBAAuB;IAWlC;QARQ,WAAM,GAAG,wBAAc,CAAC,WAAW,EAAE,CAAC;QACtC,WAAM,GAAG,sBAAa,CAAC,WAAW,EAAE,CAAC;QACrC,kBAAa,GAAG,KAAK,CAAC;QACtB,eAAU,GAAqB,IAAI,GAAG,EAAE,CAAC;QAEzC,0BAAqB,GAA0B,IAAI,GAAG,EAAE,CAAC;QACzD,mBAAc,GAAG,KAAK,CAAC;QAG7B,IAAI,CAAC,QAAQ,GAAG,oBAAQ,CAAC,WAAW,EAAE,CAAC;IACzC,CAAC;IAED,MAAM,CAAC,WAAW;QAChB,IAAI,CAAC,uBAAuB,CAAC,QAAQ,EAAE,CAAC;YACtC,uBAAuB,CAAC,QAAQ,GAAG,IAAI,uBAAuB,EAAE,CAAC;QACnE,CAAC;QACD,OAAO,uBAAuB,CAAC,QAAQ,CAAC;IAC1C,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,UAAU;QACd,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;YACvB,OAAO;QACT,CAAC;QAED,IAAI,CAAC;YACH,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,uCAAuC,CAAC,CAAC;YAErF,gCAAgC;YAChC,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAEhC,+CAA+C;YAC/C,MAAM,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAEjC,qCAAqC;YACrC,IAAI,CAAC,qBAAqB,EAAE,CAAC;YAE7B,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;YAC1B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,mDAAmD,CAAC,CAAC;QACnG,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,sBAAsB,EAAE,KAAK,CAAC,CAAC;YAC5E,MAAM,KAAK,CAAC;QACd,CAAC;IACH,CAAC;IAED;;OAEG;IACK,KAAK,CAAC,kBAAkB;QAC9B,iEAAiE;QACjE,MAAM,aAAa,GAAG,iCAAqB,CAAC,wBAAwB,EAAE,CAAC;QACvE,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;QAC9D,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC;QAElD,2DAA2D;QAC3D,MAAM,YAAY,GAAG,iCAAqB,CAAC,kBAAkB,EAAE,CAAC;QAChE,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;QAChE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,gBAAgB,EAAE,YAAY,CAAC,CAAC;QAEpD,4DAA4D;QAC5D,MAAM,eAAe,GAAG,iCAAqB,CAAC,qBAAqB,EAAE,CAAC;QACtE,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,eAAe,CAAC,CAAC;QACtE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,mBAAmB,EAAE,eAAe,CAAC,CAAC;QAE1D,6DAA6D;QAC7D,MAAM,gBAAgB,GAAG,iCAAqB,CAAC,sBAAsB,EAAE,CAAC;QACxE,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QACvE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,mBAAmB,EAAE,gBAAgB,CAAC,CAAC;QAE3D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,wCAAwC,CAAC,CAAC;IACxF,CAAC;IAED;;OAEG;IACK,KAAK,CAAC,mBAAmB;QAC/B,uEAAuE;QACvE,MAAM,IAAI,CAAC,kBAAkB,EAAE,CAAC;QAEhC,iCAAiC;QACjC,IAAI,CAAC,0BAA0B,EAAE,CAAC;QAElC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,4BAA4B,CAAC,CAAC;IAC5E,CAAC;IAED;;OAEG;IACK,KAAK,CAAC,kBAAkB;QAC9B,MAAM,aAAa,GAAG,sBAAa,CAAC,WAAW,EAAE,CAAC;QAElD,qCAAqC;QACrC,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,OAAO,EAAE,aAAa,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;QACjF,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,6BAA6B,EAAE,aAAa,CAAC,2BAA2B,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;QAE7H,MAAM,aAAa,GAAG,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,OAAO,CAAE,CAAC;QAC/D,MAAM,uBAAuB,GAAG,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,6BAA6B,CAAE,CAAC;QAE/F,2DAA2D;QAC3D,aAAa,CAAC,KAAK,GAAG,CAAC,OAAY,EAAE,EAAE;YACrC,4CAA4C;YAC5C,MAAM,MAAM,GAAG,aAAa,CAAC,OAAO,CAAC,CAAC;YAEtC,+CAA+C;YAC/C,IAAI,OAAO,CAAC,IAAI,KAAK,cAAc,IAAI,OAAO,CAAC,IAAI,KAAK,YAAY,EAAE,CAAC;gBACrE,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CACnC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,EAC7B;oBACE,IAAI,EAAE,OAAO,CAAC,IAAI;oBAClB,SAAS,EAAE,OAAO,CAAC,OAAO,EAAE,SAAS;oBACrC,QAAQ,EAAE,OAAO,CAAC,OAAO,EAAE,QAAQ;iBACpC,EACD;oBACE,QAAQ,EAAE,OAAO,CAAC,IAAI,KAAK,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/C,aAAa,EAAE,UAAU,OAAO,CAAC,GAAG,EAAE;iBACvC,CACF,CAAC;YACJ,CAAC;YAED,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC;QAEF,wDAAwD;QACxD,aAAa,CAAC,2BAA2B,GAAG,CAAC,UAAe,EAAE,OAAY,EAAE,EAAE;YAC5E,+BAA+B;YAC/B,MAAM,MAAM,GAAG,uBAAuB,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC;YAE5D,sCAAsC;YACtC,IAAI,CAAC,QAAQ,CAAC,uBAAuB,CACnC,UAAU,CAAC,KAAK,EAChB;gBACE,GAAG,OAAO;gBACV,aAAa,EAAE,UAAU,CAAC,GAAG;gBAC7B,UAAU,EAAE,UAAU,CAAC,UAAU;aAClC,EACD;gBACE,QAAQ,EAAE,CAAC,EAAE,gCAAgC;gBAC7C,aAAa,EAAE,cAAc,UAAU,CAAC,GAAG,EAAE;gBAC7C,UAAU,EAAE,CAAC;aACd,CACF,CAAC;YAEF,OAAO,MAAM,CAAC;QAChB,CAAC,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,6CAA6C,CAAC,CAAC;IAC7F,CAAC;IAED;;OAEG;IACK,0BAA0B;QAChC,MAAM,gBAAgB,GAAG,GAAG,EAAE;YAC5B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,6BAA6B,CAAC,CAAC;YAC3E,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAClB,CAAC,CAAC;QAEF,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,gBAAgB,CAAC,CAAC;QACvC,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,gBAAgB,CAAC,CAAC;QACxC,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,KAAK,EAAE,EAAE;YACxC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,oBAAoB,EAAE,KAAK,CAAC,CAAC;YAC1E,IAAI,CAAC,QAAQ,EAAE,CAAC;YAChB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAClB,CAAC,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACK,qBAAqB;QAC3B,wCAAwC;QACxC,IAAI,CAAC,qBAAqB,GAAG,WAAW,CAAC,GAAG,EAAE;YAC5C,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;gBACzB,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC1B,CAAC;QACH,CAAC,EAAE,KAAK,CAAC,CAAC;QAEV,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,2BAA2B,CAAC,CAAC;IAC3E,CAAC;IAED;;OAEG;IACK,KAAK,CAAC,gBAAgB;QAC5B,IAAI,CAAC;YACH,MAAM,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC;YAE/C,wCAAwC;YACxC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;gBACtB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,wBAAwB,EAAE;oBACpE,eAAe,EAAE,MAAM,CAAC,oBAAoB;oBAC5C,kBAAkB,EAAE,MAAM,CAAC,uBAAuB;oBAClD,cAAc,EAAE,MAAM,CAAC,mBAAmB;oBAC1C,eAAe,EAAE,MAAM,CAAC,eAAe;iBACxC,CAAC,CAAC;YACL,CAAC;YAED,wCAAwC;YACxC,IAAI,MAAM,CAAC,eAAe,GAAG,GAAG,EAAE,CAAC;gBACjC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,uCAAuC,EAAE;oBACpF,eAAe,EAAE,MAAM,CAAC,eAAe;iBACxC,CAAC,CAAC;YACL,CAAC;YAED,qCAAqC;YACrC,IAAI,MAAM,CAAC,uBAAuB,GAAG,EAAE,EAAE,CAAC;gBACxC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,mCAAmC,EAAE;oBAC/E,kBAAkB,EAAE,MAAM,CAAC,uBAAuB;iBACnD,CAAC,CAAC;YACL,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,qBAAqB,EAAE,KAAK,CAAC,CAAC;QAC7E,CAAC;IACH,CAAC;IAED;;OAEG;IAEH;;OAEG;IACH,gBAAgB,CACd,SAAiB,EACjB,OAAY,EACZ,UAII,EAAE;QAEN,OAAO,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,SAAS,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;IACrE,CAAC;IAED;;OAEG;IACH,mBAAmB,CACjB,QAAgB,EAChB,SAAiB,EACjB,OAAY,EACZ,UAII,EAAE;QAEN,OAAO,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,QAAQ,EAAE,SAAS,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;IAClF,CAAC;IAED;;OAEG;IACH,sBAAsB,CACpB,SAAmD,EACnD,OAAY,EACZ,UAII,EAAE;QAEN,OAAO,IAAI,CAAC,QAAQ,CAAC,sBAAsB,CAAC,SAAS,EAAE,OAAO,EAAE,OAAO,CAAC,CAAC;IAC3E,CAAC;IAED;;OAEG;IACH,aAAa,CAAC,SAAkB;QAC9B,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IAChD,CAAC;IAED;;OAEG;IACH,qBAAqB,CAAC,KAAc;QAClC,OAAO,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;IACpD,CAAC;IAED;;OAEG;IACH,qBAAqB,CAAC,UAAoB;QACxC,OAAO,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,UAAU,CAAC,CAAC;IACzD,CAAC;IAED;;OAEG;IACH,eAAe;QACb,OAAO,IAAI,CAAC,QAAQ,CAAC,eAAe,EAAE,CAAC;IACzC,CAAC;IAED;;OAEG;IACH,QAAQ;QACN,IAAI,CAAC,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,cAAc,EAAE,CAAC;YAC/C,OAAO;QACT,CAAC;QAED,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;QAC3B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,yCAAyC,CAAC,CAAC;QAEvF,IAAI,CAAC;YACH,yBAAyB;YACzB,IAAI,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBAC/B,aAAa,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;gBAC1C,IAAI,CAAC,qBAAqB,GAAG,SAAS,CAAC;YACzC,CAAC;YAED,0CAA0C;YAC1C,MAAM,aAAa,GAAG,sBAAa,CAAC,WAAW,EAAE,CAAC;YAClD,IAAI,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,OAAO,CAAC,EAAE,CAAC;gBAC5C,aAAa,CAAC,KAAK,GAAG,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,OAAO,CAAQ,CAAC;YACvE,CAAC;YACD,IAAI,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,6BAA6B,CAAC,EAAE,CAAC;gBAClE,aAAa,CAAC,2BAA2B,GAAG,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,6BAA6B,CAAQ,CAAC;YACnH,CAAC;YACD,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,CAAC;YAEnC,sBAAsB;YACtB,KAAK,MAAM,CAAC,SAAS,EAAE,SAAS,CAAC,IAAI,IAAI,CAAC,UAAU,EAAE,CAAC;gBACrD,IAAI,SAAS,IAAI,OAAO,SAAS,CAAC,IAAI,KAAK,UAAU,EAAE,CAAC;oBACtD,SAAS,CAAC,IAAI,EAAE,CAAC;oBACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,sBAAsB,SAAS,EAAE,CAAC,CAAC;gBACjF,CAAC;YACH,CAAC;YACD,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;YAExB,kBAAkB;YAClB,IAAI,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC;YAEtB,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;YAC3B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,EAAE,qCAAqC,CAAC,CAAC;QACrF,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,yBAAyB,EAAE,uBAAuB,EAAE,KAAK,CAAC,CAAC;QAC/E,CAAC;gBAAS,CAAC;YACT,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;QAC9B,CAAC;IACH,CAAC;CACF;AA3VD,0DA2VC;AAED;;;GAGG;AACH,MAAa,oBAAoB;IAK/B;QAFQ,WAAM,GAAG,wBAAc,CAAC,WAAW,EAAE,CAAC;QAG5C,IAAI,CAAC,kBAAkB,GAAG,uBAAuB,CAAC,WAAW,EAAE,CAAC;IAClE,CAAC;IAED,MAAM,CAAC,WAAW;QAChB,IAAI,CAAC,oBAAoB,CAAC,QAAQ,EAAE,CAAC;YACnC,oBAAoB,CAAC,QAAQ,GAAG,IAAI,oBAAoB,EAAE,CAAC;QAC7D,CAAC;QACD,OAAO,oBAAoB,CAAC,QAAQ,CAAC;IACvC,CAAC;IAED;;OAEG;IACH,cAAc,CAAC,QAAgB,EAAE,SAAc,EAAE,OAAY;QAC3D,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CACtC,UAAU,EACV;YACE,QAAQ;YACR,SAAS;YACT,OAAO;SACR,EACD;YACE,QAAQ,EAAE,CAAC,EAAE,6CAA6C;YAC1D,aAAa,EAAE,QAAQ,QAAQ,IAAI,IAAI,CAAC,GAAG,EAAE,EAAE;SAChD,CACF,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB,EAAE,gCAAgC,EAAE;YAC1E,QAAQ;YACR,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;SACxC,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,iBAAiB,CAAC,OAAe,EAAE,OAAY;QAC7C,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CACtC,aAAa,EACb;YACE,OAAO;YACP,OAAO;SACR,EACD;YACE,QAAQ,EAAE,CAAC,EAAE,kBAAkB;YAC/B,aAAa,EAAE,UAAU,IAAI,CAAC,GAAG,EAAE,EAAE;SACtC,CACF,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB,EAAE,mCAAmC,EAAE;YAC7E,aAAa,EAAE,OAAO,CAAC,MAAM;YAC7B,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;SACxC,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,qBAAqB,CAAC,OAAe,EAAE,OAAY;QACjD,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CACtC,iBAAiB,EACjB;YACE,OAAO;YACP,OAAO;SACR,EACD;YACE,QAAQ,EAAE,CAAC,EAAE,mCAAmC;YAChD,aAAa,EAAE,YAAY,IAAI,CAAC,GAAG,EAAE,EAAE;SACxC,CACF,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,sBAAsB,EAAE,uCAAuC,EAAE;YACjF,aAAa,EAAE,OAAO,CAAC,MAAM;YAC7B,WAAW,EAAE,MAAM,CAAC,IAAI,CAAC,OAAO,IAAI,EAAE,CAAC;SACxC,CAAC,CAAC;IACL,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,UAAU;QACd,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,EAAE,CAAC;QAC3C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,sBAAsB,EAAE,oCAAoC,CAAC,CAAC;IACjF,CAAC;CACF;AA1FD,oDA0FC;AAED;;GAEG;AACH,MAAa,mBAAmB;IAK9B;QAFQ,WAAM,GAAG,wBAAc,CAAC,WAAW,EAAE,CAAC;QAG5C,IAAI,CAAC,kBAAkB,GAAG,uBAAuB,CAAC,WAAW,EAAE,CAAC;IAClE,CAAC;IAED,MAAM,CAAC,WAAW;QAChB,IAAI,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC;YAClC,mBAAmB,CAAC,QAAQ,GAAG,IAAI,mBAAmB,EAAE,CAAC;QAC3D,CAAC;QACD,OAAO,mBAAmB,CAAC,QAAQ,CAAC;IACtC,CAAC;IAED;;OAEG;IACH,eAAe,CACb,QAAgB,EAChB,SAAiB,EACjB,OAAY,EACZ,UAII,EAAE;QAEN,MAAM,SAAS,GAAG,IAAI,CAAC,kBAAkB,CAAC,mBAAmB,CAC3D,QAAQ,EACR,SAAS,EACT,OAAO,EACP;YACE,QAAQ,EAAE,OAAO,CAAC,QAAQ,IAAI,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YAChE,aAAa,EAAE,OAAO,QAAQ,IAAI,SAAS,IAAI,IAAI,CAAC,GAAG,EAAE,EAAE;SAC5D,CACF,CAAC;QAEF,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,qBAAqB,EAAE,sBAAsB,EAAE;YAC/D,SAAS;YACT,QAAQ;YACR,SAAS;YACT,gBAAgB,EAAE,OAAO,CAAC,gBAAgB;SAC3C,CAAC,CAAC;QAEH,OAAO,SAAS,CAAC;IACnB,CAAC;IAED;;OAEG;IACH,mBAAmB,CAAC,KAAa,EAAE,OAAY;QAC7C,OAAO,IAAI,CAAC,eAAe,CACzB,QAAQ,EACR,QAAQ,EACR,EAAE,KAAK,EAAE,OAAO,EAAE,EAClB;YACE,QAAQ,EAAE,CAAC,EAAE,oCAAoC;YACjD,gBAAgB,EAAE,IAAI;SACvB,CACF,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,kBAAkB,CAAC,IAAS,EAAE,OAAY;QACxC,OAAO,IAAI,CAAC,eAAe,CACzB,QAAQ,EACR,OAAO,EACP,EAAE,IAAI,EAAE,OAAO,EAAE,EACjB;YACE,QAAQ,EAAE,CAAC,EAAE,0CAA0C;YACvD,gBAAgB,EAAE,KAAK;SACxB,CACF,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,UAAU;QACd,MAAM,IAAI,CAAC,kBAAkB,CAAC,UAAU,EAAE,CAAC;QAC3C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,EAAE,mCAAmC,CAAC,CAAC;IAC/E,CAAC;CACF;AAtFD,kDAsFC","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/services/queue-integration.ts"],"sourcesContent":["import { QueueAPI, QueueProcessorFactory } from './queue-api';\nimport { LoggingService } from './logging';\nimport { MemoryService } from './memory';\nimport { ConfigService } from './config';\n\n/**\n * Integration layer that connects the queue system with existing Claude Recall components\n * This service manages the lifecycle and coordination of queue-based processing\n */\nexport class QueueIntegrationService {\n  private static instance: QueueIntegrationService;\n  private queueAPI: QueueAPI;\n  private logger = LoggingService.getInstance();\n  private config = ConfigService.getInstance();\n  private isInitialized = false;\n  private processors: Map<string, any> = new Map();\n  private healthMonitorInterval?: NodeJS.Timeout;\n  private originalMemoryMethods: Map<string, Function> = new Map();\n  private isShuttingDown = false;\n\n  private constructor() {\n    this.queueAPI = QueueAPI.getInstance();\n  }\n\n  static getInstance(): QueueIntegrationService {\n    if (!QueueIntegrationService.instance) {\n      QueueIntegrationService.instance = new QueueIntegrationService();\n    }\n    return QueueIntegrationService.instance;\n  }\n\n  /**\n   * Initialize the queue integration system\n   */\n  async initialize(): Promise<void> {\n    if (this.isInitialized) {\n      return;\n    }\n\n    try {\n      this.logger.info('QueueIntegrationService', 'Initializing queue integration system');\n\n      // Register all queue processors\n      await this.registerProcessors();\n\n      // Set up event listeners for existing services\n      await this.setupEventListeners();\n\n      // Initialize queue health monitoring\n      this.startHealthMonitoring();\n\n      this.isInitialized = true;\n      this.logger.info('QueueIntegrationService', 'Queue integration system initialized successfully');\n    } catch (error) {\n      this.logger.error('QueueIntegrationService', 'Failed to initialize', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Register all queue processors\n   */\n  private async registerProcessors(): Promise<void> {\n    // Hook event processor for processing hook events asynchronously\n    const hookProcessor = QueueProcessorFactory.createHookEventProcessor();\n    this.queueAPI.registerProcessor('hook-events', hookProcessor);\n    this.processors.set('hook-events', hookProcessor);\n\n    // MCP operation processor for handling MCP tool operations\n    const mcpProcessor = QueueProcessorFactory.createMCPProcessor();\n    this.queueAPI.registerProcessor('mcp-operations', mcpProcessor);\n    this.processors.set('mcp-operations', mcpProcessor);\n\n    // Memory operation processor for handling memory operations\n    const memoryProcessor = QueueProcessorFactory.createMemoryProcessor();\n    this.queueAPI.registerProcessor('memory-operations', memoryProcessor);\n    this.processors.set('memory-operations', memoryProcessor);\n\n    // Pattern detection processor for analyzing content patterns\n    const patternProcessor = QueueProcessorFactory.createPatternProcessor();\n    this.queueAPI.registerProcessor('pattern-detection', patternProcessor);\n    this.processors.set('pattern-detection', patternProcessor);\n\n    this.logger.info('QueueIntegrationService', 'All processors registered successfully');\n  }\n\n  /**\n   * Set up event listeners to intercept and queue operations\n   */\n  private async setupEventListeners(): Promise<void> {\n    // Monkey patch memory service to use queue for non-critical operations\n    await this.patchMemoryService();\n\n    // Set up process event listeners\n    this.setupProcessEventListeners();\n\n    this.logger.info('QueueIntegrationService', 'Event listeners configured');\n  }\n\n  /**\n   * Patch MemoryService to use queue for background operations\n   */\n  private async patchMemoryService(): Promise<void> {\n    const memoryService = MemoryService.getInstance();\n    \n    // Store original methods for cleanup\n    this.originalMemoryMethods.set('store', memoryService.store.bind(memoryService));\n    this.originalMemoryMethods.set('storePreferenceWithOverride', memoryService.storePreferenceWithOverride.bind(memoryService));\n    \n    const originalStore = this.originalMemoryMethods.get('store')!;\n    const originalStorePreference = this.originalMemoryMethods.get('storePreferenceWithOverride')!;\n\n    // Override store method to use queue for pattern detection\n    memoryService.store = (request: any) => {\n      // Store immediately for critical operations\n      const result = originalStore(request);\n\n      // Queue pattern detection if it's user content\n      if (request.type === 'user-content' || request.type === 'preference') {\n        this.queueAPI.enqueuePatternDetection(\n          JSON.stringify(request.value),\n          {\n            type: request.type,\n            projectId: request.context?.projectId,\n            filePath: request.context?.filePath\n          },\n          {\n            priority: request.type === 'preference' ? 5 : 1,\n            correlationId: `memory-${request.key}`\n          }\n        );\n      }\n\n      return result;\n    };\n\n    // Override preference storage to use queue for analysis\n    memoryService.storePreferenceWithOverride = (preference: any, context: any) => {\n      // Store preference immediately\n      const result = originalStorePreference(preference, context);\n\n      // Queue for enhanced pattern analysis\n      this.queueAPI.enqueuePatternDetection(\n        preference.value,\n        {\n          ...context,\n          preferenceKey: preference.key,\n          isOverride: preference.isOverride\n        },\n        {\n          priority: 8, // High priority for preferences\n          correlationId: `preference-${preference.key}`,\n          maxRetries: 2\n        }\n      );\n\n      return result;\n    };\n\n    this.logger.info('QueueIntegrationService', 'MemoryService patched for queue integration');\n  }\n\n  /**\n   * Set up process event listeners for graceful shutdown\n   */\n  private setupProcessEventListeners(): void {\n    const gracefulShutdown = () => {\n      this.logger.info('QueueIntegrationService', 'Graceful shutdown initiated');\n      this.shutdown();\n      process.exit(0);\n    };\n\n    process.on('SIGINT', gracefulShutdown);\n    process.on('SIGTERM', gracefulShutdown);\n    process.on('uncaughtException', (error) => {\n      this.logger.error('QueueIntegrationService', 'Uncaught exception', error);\n      this.shutdown();\n      process.exit(1);\n    });\n  }\n\n  /**\n   * Start health monitoring for queues\n   */\n  private startHealthMonitoring(): void {\n    // Monitor queue health every 30 seconds\n    this.healthMonitorInterval = setInterval(() => {\n      if (!this.isShuttingDown) {\n        this.checkQueueHealth();\n      }\n    }, 30000);\n\n    this.logger.info('QueueIntegrationService', 'Health monitoring started');\n  }\n\n  /**\n   * Check queue health and log warnings for issues\n   */\n  private async checkQueueHealth(): Promise<void> {\n    try {\n      const health = this.queueAPI.getSystemHealth();\n\n      // Log warnings for unhealthy conditions\n      if (!health.isHealthy) {\n        this.logger.warn('QueueIntegrationService', 'Queue system unhealthy', {\n          pendingMessages: health.totalPendingMessages,\n          processingMessages: health.totalProcessingMessages,\n          failedMessages: health.totalFailedMessages,\n          deadLetterCount: health.deadLetterCount\n        });\n      }\n\n      // Alert on high dead letter queue count\n      if (health.deadLetterCount > 100) {\n        this.logger.error('QueueIntegrationService', 'High dead letter queue count detected', {\n          deadLetterCount: health.deadLetterCount\n        });\n      }\n\n      // Alert on stuck processing messages\n      if (health.totalProcessingMessages > 50) {\n        this.logger.warn('QueueIntegrationService', 'Many messages stuck in processing', {\n          processingMessages: health.totalProcessingMessages\n        });\n      }\n    } catch (error) {\n      this.logger.error('QueueIntegrationService', 'Health check failed', error);\n    }\n  }\n\n  /**\n   * Hook integration methods for external services\n   */\n\n  /**\n   * Process hook event asynchronously\n   */\n  processHookEvent(\n    eventType: string,\n    payload: any,\n    options: {\n      priority?: number;\n      delayMs?: number;\n      correlationId?: string;\n    } = {}\n  ): number {\n    return this.queueAPI.enqueueHookEvent(eventType, payload, options);\n  }\n\n  /**\n   * Process MCP operation asynchronously\n   */\n  processMCPOperation(\n    toolName: string,\n    operation: string,\n    payload: any,\n    options: {\n      priority?: number;\n      delayMs?: number;\n      correlationId?: string;\n    } = {}\n  ): number {\n    return this.queueAPI.enqueueMCPOperation(toolName, operation, payload, options);\n  }\n\n  /**\n   * Process memory operation asynchronously\n   */\n  processMemoryOperation(\n    operation: 'store' | 'search' | 'update' | 'delete',\n    payload: any,\n    options: {\n      priority?: number;\n      delayMs?: number;\n      correlationId?: string;\n    } = {}\n  ): number {\n    return this.queueAPI.enqueueMemoryOperation(operation, payload, options);\n  }\n\n  /**\n   * Get queue statistics for monitoring\n   */\n  getQueueStats(queueName?: string): any {\n    return this.queueAPI.getQueueStats(queueName);\n  }\n\n  /**\n   * Get dead letter messages for debugging\n   */\n  getDeadLetterMessages(limit?: number): any[] {\n    return this.queueAPI.getDeadLetterMessages(limit);\n  }\n\n  /**\n   * Requeue messages from dead letter queue\n   */\n  requeueFromDeadLetter(messageIds: number[]): number {\n    return this.queueAPI.requeueFromDeadLetter(messageIds);\n  }\n\n  /**\n   * Get system health status\n   */\n  getSystemHealth(): any {\n    return this.queueAPI.getSystemHealth();\n  }\n\n  /**\n   * Shutdown the integration service\n   */\n  shutdown(): void {\n    if (!this.isInitialized || this.isShuttingDown) {\n      return;\n    }\n\n    this.isShuttingDown = true;\n    this.logger.info('QueueIntegrationService', 'Shutting down queue integration service');\n\n    try {\n      // Stop health monitoring\n      if (this.healthMonitorInterval) {\n        clearInterval(this.healthMonitorInterval);\n        this.healthMonitorInterval = undefined;\n      }\n\n      // Restore original memory service methods\n      const memoryService = MemoryService.getInstance();\n      if (this.originalMemoryMethods.has('store')) {\n        memoryService.store = this.originalMemoryMethods.get('store') as any;\n      }\n      if (this.originalMemoryMethods.has('storePreferenceWithOverride')) {\n        memoryService.storePreferenceWithOverride = this.originalMemoryMethods.get('storePreferenceWithOverride') as any;\n      }\n      this.originalMemoryMethods.clear();\n\n      // Stop all processors\n      for (const [queueName, processor] of this.processors) {\n        if (processor && typeof processor.stop === 'function') {\n          processor.stop();\n          this.logger.info('QueueIntegrationService', `Processor stopped: ${queueName}`);\n        }\n      }\n      this.processors.clear();\n\n      // Close queue API\n      this.queueAPI.close();\n\n      this.isInitialized = false;\n      this.logger.info('QueueIntegrationService', 'Queue integration service shut down');\n    } catch (error) {\n      this.logger.error('QueueIntegrationService', 'Error during shutdown', error);\n    } finally {\n      this.isShuttingDown = false;\n    }\n  }\n}\n\n/**\n * Hook integration helper for backward compatibility\n * This maintains the existing hook interface while adding queue processing\n */\nexport class HookQueueIntegration {\n  private static instance: HookQueueIntegration;\n  private integrationService: QueueIntegrationService;\n  private logger = LoggingService.getInstance();\n\n  private constructor() {\n    this.integrationService = QueueIntegrationService.getInstance();\n  }\n\n  static getInstance(): HookQueueIntegration {\n    if (!HookQueueIntegration.instance) {\n      HookQueueIntegration.instance = new HookQueueIntegration();\n    }\n    return HookQueueIntegration.instance;\n  }\n\n  /**\n   * Process a tool use event through the queue system\n   */\n  processToolUse(toolName: string, toolInput: any, context: any): void {\n    this.integrationService.processHookEvent(\n      'tool-use',\n      {\n        toolName,\n        toolInput,\n        context\n      },\n      {\n        priority: 5, // Medium-high priority for tool use tracking\n        correlationId: `tool-${toolName}-${Date.now()}`\n      }\n    );\n\n    this.logger.debug('HookQueueIntegration', 'Tool use queued for processing', {\n      toolName,\n      contextKeys: Object.keys(context || {})\n    });\n  }\n\n  /**\n   * Process a user prompt through the queue system\n   */\n  processUserPrompt(content: string, context: any): void {\n    this.integrationService.processHookEvent(\n      'user-prompt',\n      {\n        content,\n        context\n      },\n      {\n        priority: 3, // Medium priority\n        correlationId: `prompt-${Date.now()}`\n      }\n    );\n\n    this.logger.debug('HookQueueIntegration', 'User prompt queued for processing', {\n      contentLength: content.length,\n      contextKeys: Object.keys(context || {})\n    });\n  }\n\n  /**\n   * Process a Claude response through the queue system\n   */\n  processClaudeResponse(content: string, context: any): void {\n    this.integrationService.processHookEvent(\n      'claude-response',\n      {\n        content,\n        context\n      },\n      {\n        priority: 2, // Lower priority than user prompts\n        correlationId: `response-${Date.now()}`\n      }\n    );\n\n    this.logger.debug('HookQueueIntegration', 'Claude response queued for processing', {\n      contentLength: content.length,\n      contextKeys: Object.keys(context || {})\n    });\n  }\n\n  /**\n   * Initialize the hook integration system\n   */\n  async initialize(): Promise<void> {\n    await this.integrationService.initialize();\n    this.logger.info('HookQueueIntegration', 'Hook queue integration initialized');\n  }\n}\n\n/**\n * MCP integration helper for queue-based MCP operations\n */\nexport class MCPQueueIntegration {\n  private static instance: MCPQueueIntegration;\n  private integrationService: QueueIntegrationService;\n  private logger = LoggingService.getInstance();\n\n  private constructor() {\n    this.integrationService = QueueIntegrationService.getInstance();\n  }\n\n  static getInstance(): MCPQueueIntegration {\n    if (!MCPQueueIntegration.instance) {\n      MCPQueueIntegration.instance = new MCPQueueIntegration();\n    }\n    return MCPQueueIntegration.instance;\n  }\n\n  /**\n   * Process an MCP tool call asynchronously\n   */\n  processToolCall(\n    toolName: string,\n    operation: string,\n    payload: any,\n    options: {\n      priority?: number;\n      requiresResponse?: boolean;\n      timeout?: number;\n    } = {}\n  ): number {\n    const messageId = this.integrationService.processMCPOperation(\n      toolName,\n      operation,\n      payload,\n      {\n        priority: options.priority || (options.requiresResponse ? 7 : 4),\n        correlationId: `mcp-${toolName}-${operation}-${Date.now()}`\n      }\n    );\n\n    this.logger.debug('MCPQueueIntegration', 'MCP operation queued', {\n      messageId,\n      toolName,\n      operation,\n      requiresResponse: options.requiresResponse\n    });\n\n    return messageId;\n  }\n\n  /**\n   * Process a memory search operation\n   */\n  processMemorySearch(query: string, context: any): number {\n    return this.processToolCall(\n      'memory',\n      'search',\n      { query, context },\n      {\n        priority: 6, // High priority for memory searches\n        requiresResponse: true\n      }\n    );\n  }\n\n  /**\n   * Process a memory store operation\n   */\n  processMemoryStore(data: any, context: any): number {\n    return this.processToolCall(\n      'memory',\n      'store',\n      { data, context },\n      {\n        priority: 5, // Medium-high priority for memory storage\n        requiresResponse: false\n      }\n    );\n  }\n\n  /**\n   * Initialize the MCP integration system\n   */\n  async initialize(): Promise<void> {\n    await this.integrationService.initialize();\n    this.logger.info('MCPQueueIntegration', 'MCP queue integration initialized');\n  }\n}"],"version":3}