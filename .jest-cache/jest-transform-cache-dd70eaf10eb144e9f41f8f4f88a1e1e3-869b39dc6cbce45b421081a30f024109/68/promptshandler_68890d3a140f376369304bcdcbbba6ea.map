{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/prompts-handler.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/prompts-handler.ts"],"sourcesContent":["import { MemoryService } from '../services/memory';\nimport { MemoryStorage } from '../memory/storage';\nimport { LoggingService } from '../services/logging';\nimport { MCPRequest, MCPResponse } from './server';\n\nexport interface MCPPrompt {\n  name: string;\n  description: string;\n  arguments?: Array<{\n    name: string;\n    description: string;\n    required?: boolean;\n  }>;\n}\n\nexport interface PromptMessage {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\nexport interface GetPromptResult {\n  description?: string;\n  messages: PromptMessage[];\n}\n\n/**\n * Handles MCP Prompts protocol\n * Prompts are reusable templates with memory context automatically injected\n * Claude Code can invoke these to get context-enriched prompts\n */\nexport class PromptsHandler {\n  private logger: LoggingService;\n  private memoryService: MemoryService;\n  private memoryStorage: MemoryStorage;\n\n  constructor() {\n    this.logger = LoggingService.getInstance();\n    this.memoryService = MemoryService.getInstance();\n    this.memoryStorage = (this.memoryService as any).storage;\n  }\n\n  /**\n   * Handle prompts/list request\n   * Returns list of available prompt templates\n   */\n  async handlePromptsList(request: MCPRequest): Promise<MCPResponse> {\n    try {\n      const prompts: MCPPrompt[] = [\n        {\n          name: 'with-preferences',\n          description: 'Inject user coding preferences into the conversation context',\n          arguments: []\n        },\n        {\n          name: 'with-project-context',\n          description: 'Inject relevant project knowledge (database configs, API patterns, etc.)',\n          arguments: [\n            {\n              name: 'topic',\n              description: 'Specific topic to focus on (e.g., \"database\", \"api\", \"testing\")',\n              required: false\n            }\n          ]\n        },\n        {\n          name: 'with-corrections',\n          description: 'Inject recent correction patterns to avoid repeating mistakes',\n          arguments: []\n        },\n        {\n          name: 'with-full-context',\n          description: 'Inject all relevant memories (preferences + project knowledge + corrections)',\n          arguments: [\n            {\n              name: 'task',\n              description: 'The task you want to perform',\n              required: true\n            }\n          ]\n        },\n        {\n          name: 'analyze-for-preferences',\n          description: 'Analyze conversation to extract and store new preferences',\n          arguments: [\n            {\n              name: 'conversation',\n              description: 'Recent conversation text to analyze',\n              required: true\n            }\n          ]\n        }\n      ];\n\n      this.logger.info('PromptsHandler', 'Listed prompts', {\n        count: prompts.length\n      });\n\n      return {\n        jsonrpc: '2.0',\n        id: request.id,\n        result: {\n          prompts\n        }\n      };\n    } catch (error) {\n      this.logger.error('PromptsHandler', 'Failed to list prompts', error);\n      return this.createErrorResponse(request.id, -32603, 'Failed to list prompts');\n    }\n  }\n\n  /**\n   * Handle prompts/get request\n   * Returns a specific prompt with memory context injected\n   */\n  async handlePromptsGet(request: MCPRequest): Promise<MCPResponse> {\n    try {\n      const { name, arguments: args } = request.params || {};\n\n      if (!name || typeof name !== 'string') {\n        return this.createErrorResponse(request.id, -32602, 'Missing or invalid name parameter');\n      }\n\n      let promptResult: GetPromptResult;\n\n      switch (name) {\n        case 'with-preferences':\n          promptResult = await this.getPreferencesPrompt();\n          break;\n\n        case 'with-project-context':\n          promptResult = await this.getProjectContextPrompt(args?.topic);\n          break;\n\n        case 'with-corrections':\n          promptResult = await this.getCorrectionsPrompt();\n          break;\n\n        case 'with-full-context':\n          promptResult = await this.getFullContextPrompt(args?.task);\n          break;\n\n        case 'analyze-for-preferences':\n          promptResult = await this.getAnalyzePreferencesPrompt(args?.conversation);\n          break;\n\n        default:\n          return this.createErrorResponse(request.id, -32602, `Unknown prompt: ${name}`);\n      }\n\n      this.logger.info('PromptsHandler', 'Generated prompt', {\n        name,\n        messageCount: promptResult.messages.length\n      });\n\n      return {\n        jsonrpc: '2.0',\n        id: request.id,\n        result: promptResult\n      };\n    } catch (error) {\n      this.logger.error('PromptsHandler', 'Failed to get prompt', error);\n      return this.createErrorResponse(request.id, -32603, 'Failed to get prompt');\n    }\n  }\n\n  /**\n   * Get preferences prompt\n   * Injects all user preferences into context\n   */\n  private async getPreferencesPrompt(): Promise<GetPromptResult> {\n    const preferences = this.memoryStorage.searchByContext({ type: 'preference' });\n\n    const preferencesText = this.formatPreferencesForPrompt(preferences);\n\n    return {\n      description: 'User coding preferences automatically injected',\n      messages: [\n        {\n          role: 'system',\n          content: `# User Coding Preferences\n\n${preferencesText}\n\nApply these preferences when generating code or making suggestions.`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Get project context prompt\n   * Injects relevant project knowledge\n   */\n  private async getProjectContextPrompt(topic?: string): Promise<GetPromptResult> {\n    let knowledge = this.memoryStorage.searchByContext({ type: 'project-knowledge' });\n\n    // Filter by topic if provided\n    if (topic) {\n      const results = this.memoryService.search(topic);\n      const knowledgeKeys = new Set(results.map(r => r.key));\n      knowledge = knowledge.filter(k => knowledgeKeys.has(k.key));\n    }\n\n    const contextText = this.formatKnowledgeForPrompt(knowledge);\n\n    return {\n      description: topic\n        ? `Project knowledge about ${topic}`\n        : 'All project knowledge',\n      messages: [\n        {\n          role: 'system',\n          content: `# Project Knowledge\n\n${contextText}\n\nUse this information when working with the project.`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Get corrections prompt\n   * Injects recent correction patterns\n   */\n  private async getCorrectionsPrompt(): Promise<GetPromptResult> {\n    const corrections = this.memoryStorage.searchByContext({ type: 'correction' });\n\n    // Get most recent 10\n    const recentCorrections = corrections\n      .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))\n      .slice(0, 10);\n\n    const correctionsText = this.formatCorrectionsForPrompt(recentCorrections);\n\n    return {\n      description: 'Recent correction patterns to avoid mistakes',\n      messages: [\n        {\n          role: 'system',\n          content: `# Correction Patterns\n\n${correctionsText}\n\nAvoid these patterns when generating code.`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Get full context prompt\n   * Injects all relevant memories for a specific task\n   */\n  private async getFullContextPrompt(task?: string): Promise<GetPromptResult> {\n    if (!task) {\n      return this.createErrorPrompt('Task parameter is required');\n    }\n\n    // Search for relevant memories based on task\n    const searchResults = this.memoryService.search(task);\n\n    // Get top 10 most relevant\n    const relevantMemories = searchResults.slice(0, 10);\n\n    const contextText = this.formatMemoriesForPrompt(relevantMemories);\n\n    return {\n      description: `Full context for: ${task}`,\n      messages: [\n        {\n          role: 'system',\n          content: `# Relevant Context\n\n${contextText}\n\nUse this context when working on: ${task}`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Get analyze preferences prompt\n   * This is a special prompt that asks Claude to analyze conversation\n   * and extract preferences to store\n   */\n  private async getAnalyzePreferencesPrompt(conversation?: string): Promise<GetPromptResult> {\n    if (!conversation) {\n      return this.createErrorPrompt('Conversation parameter is required');\n    }\n\n    return {\n      description: 'Analyze conversation for preference extraction',\n      messages: [\n        {\n          role: 'system',\n          content: `You are analyzing a conversation to extract user coding preferences.\n\nExtract any preferences about:\n- Programming languages and frameworks\n- Code style (indentation, quotes, semicolons, etc.)\n- File organization and naming\n- Testing approaches\n- Tool choices\n- Workflow patterns\n- Team conventions\n\nReturn a JSON array with format:\n[\n  {\n    \"key\": \"descriptive_key\",\n    \"value\": \"the preference value\",\n    \"confidence\": 0.0-1.0,\n    \"reasoning\": \"why this is a preference\"\n  }\n]\n\nBe conservative - only extract clear, explicit preferences.`\n        },\n        {\n          role: 'user',\n          content: `Analyze this conversation for preferences:\\n\\n${conversation}`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Format preferences for prompt injection\n   */\n  private formatPreferencesForPrompt(preferences: any[]): string {\n    if (preferences.length === 0) {\n      return '_No preferences stored yet._';\n    }\n\n    let text = '';\n\n    // Group by category\n    const grouped = this.groupByCategory(preferences);\n\n    for (const [category, prefs] of grouped.entries()) {\n      text += `## ${category}\\n\\n`;\n\n      for (const pref of prefs) {\n        const value = typeof pref.value === 'object'\n          ? JSON.stringify(pref.value)\n          : pref.value;\n\n        text += `- **${pref.key}**: ${value}\\n`;\n      }\n\n      text += '\\n';\n    }\n\n    return text;\n  }\n\n  /**\n   * Format knowledge for prompt injection\n   */\n  private formatKnowledgeForPrompt(knowledge: any[]): string {\n    if (knowledge.length === 0) {\n      return '_No project knowledge stored yet._';\n    }\n\n    let text = '';\n\n    for (const item of knowledge) {\n      text += `### ${item.key}\\n\\n`;\n\n      if (typeof item.value === 'object') {\n        text += '```json\\n';\n        text += JSON.stringify(item.value, null, 2);\n        text += '\\n```\\n\\n';\n      } else {\n        text += `${item.value}\\n\\n`;\n      }\n    }\n\n    return text;\n  }\n\n  /**\n   * Format corrections for prompt injection\n   */\n  private formatCorrectionsForPrompt(corrections: any[]): string {\n    if (corrections.length === 0) {\n      return '_No correction patterns yet._';\n    }\n\n    let text = '';\n\n    for (const correction of corrections) {\n      const pattern = typeof correction.value === 'object'\n        ? correction.value\n        : { description: correction.value };\n\n      if (pattern.original && pattern.corrected) {\n        text += `- ❌ Avoid: \\`${pattern.original}\\`\\n`;\n        text += `  ✓ Use instead: \\`${pattern.corrected}\\`\\n\\n`;\n      } else {\n        text += `- ${pattern.description || JSON.stringify(pattern)}\\n\\n`;\n      }\n    }\n\n    return text;\n  }\n\n  /**\n   * Format general memories for prompt injection\n   */\n  private formatMemoriesForPrompt(memories: any[]): string {\n    if (memories.length === 0) {\n      return '_No relevant memories found._';\n    }\n\n    let text = '';\n\n    for (const memory of memories) {\n      text += `### ${memory.type}: ${memory.key}\\n\\n`;\n\n      const value = typeof memory.value === 'object'\n        ? JSON.stringify(memory.value, null, 2)\n        : memory.value;\n\n      text += `${value}\\n\\n`;\n\n      if (memory.score) {\n        text += `_Relevance: ${(memory.score * 100).toFixed(0)}%_\\n\\n`;\n      }\n    }\n\n    return text;\n  }\n\n  /**\n   * Group memories by category\n   */\n  private groupByCategory(memories: any[]): Map<string, any[]> {\n    const groups = new Map<string, any[]>();\n\n    for (const memory of memories) {\n      const category = this.categorizeMemory(memory.key);\n      if (!groups.has(category)) {\n        groups.set(category, []);\n      }\n      groups.get(category)!.push(memory);\n    }\n\n    return groups;\n  }\n\n  /**\n   * Categorize memory by key\n   */\n  private categorizeMemory(key: string): string {\n    if (key.includes('test') || key.includes('spec')) return 'Testing';\n    if (key.includes('indent') || key.includes('format') || key.includes('style')) return 'Code Style';\n    if (key.includes('framework') || key.includes('library')) return 'Frameworks';\n    if (key.includes('file') || key.includes('directory')) return 'File Organization';\n    if (key.includes('git') || key.includes('commit')) return 'Version Control';\n    if (key.includes('database') || key.includes('db')) return 'Database';\n    if (key.includes('api') || key.includes('endpoint')) return 'API';\n    return 'General';\n  }\n\n  /**\n   * Create error prompt result\n   */\n  private createErrorPrompt(message: string): GetPromptResult {\n    return {\n      description: 'Error',\n      messages: [\n        {\n          role: 'system',\n          content: `Error: ${message}`\n        }\n      ]\n    };\n  }\n\n  /**\n   * Create error response\n   */\n  private createErrorResponse(id: string | number, code: number, message: string): MCPResponse {\n    return {\n      jsonrpc: '2.0',\n      id,\n      error: {\n        code,\n        message\n      }\n    };\n  }\n}\n"],"version":3}