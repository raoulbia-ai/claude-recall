{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/queue-system.test.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/queue-system.test.ts"],"sourcesContent":["import { QueueSystem, QueueMessage } from '../../src/services/queue-system';\nimport { QueueAPI } from '../../src/services/queue-api';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport Database from 'better-sqlite3';\n\ndescribe('QueueSystem', () => {\n  let queueSystem: QueueSystem;\n  let testDbPath: string;\n\n  beforeEach(async () => {\n    // Reset singleton instance\n    QueueSystem.resetInstance();\n    \n    // Create temporary test database\n    testDbPath = path.join(__dirname, `test-queue-${Date.now()}.db`);\n    \n    // Mock ConfigService to use test database\n    const mockConfig = {\n      getDatabasePath: () => testDbPath\n    };\n    \n    // Override ConfigService for testing\n    jest.doMock('../../src/services/config', () => ({\n      ConfigService: {\n        getInstance: () => mockConfig\n      }\n    }));\n\n    // Create fresh instance\n    queueSystem = QueueSystem.getInstance();\n  });\n\n  afterEach(async () => {\n    // Close queue system\n    queueSystem.close();\n    \n    // Reset singleton instance\n    QueueSystem.resetInstance();\n    \n    // Clean up test database\n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    \n    jest.clearAllMocks();\n    jest.resetModules();\n  });\n\n  describe('Database Initialization', () => {\n    test.skip('should initialize database schema correctly', () => {\n      const db = new Database(testDbPath);\n      \n      // Check if tables exist\n      const tablesQuery = \"SELECT name FROM sqlite_master WHERE type='table'\";\n      const tables = db.prepare(tablesQuery).all() as Array<{ name: string }>;\n      const tableNames = tables.map(t => t.name);\n      \n      expect(tableNames).toContain('queue_messages');\n      expect(tableNames).toContain('queue_configs');\n      expect(tableNames).toContain('dead_letter_queue');\n      \n      db.close();\n    });\n\n    test('should create required indexes', () => {\n      // Access the private db property for testing\n      const db = queueSystem['db'];\n      \n      const indexesQuery = \"SELECT name FROM sqlite_master WHERE type='index'\";\n      const indexes = db.prepare(indexesQuery).all() as Array<{ name: string }>;\n      const indexNames = indexes.map(i => i.name);\n      \n      expect(indexNames).toContain('idx_queue_messages_queue_status');\n      expect(indexNames).toContain('idx_queue_messages_scheduled');\n      expect(indexNames).toContain('idx_queue_messages_priority');\n    });\n  });\n\n  describe('Message Enqueue/Dequeue', () => {\n    test('should enqueue and dequeue messages correctly', () => {\n      const payload = { test: 'data', number: 123 };\n      \n      // Enqueue message\n      const messageId = queueSystem.enqueue(\n        'test-queue',\n        'test-message',\n        payload,\n        { priority: 5 }\n      );\n      \n      expect(messageId).toBeGreaterThan(0);\n      \n      // Dequeue message\n      const messages = queueSystem.dequeue('test-queue', 1);\n      \n      expect(messages).toHaveLength(1);\n      expect(messages[0].id).toBe(messageId);\n      expect(messages[0].queue_name).toBe('test-queue');\n      expect(messages[0].message_type).toBe('test-message');\n      expect(messages[0].payload).toEqual(payload);\n      expect(messages[0].priority).toBe(5);\n      expect(messages[0].status).toBe('processing');\n    });\n\n    test('should respect message priority ordering', () => {\n      // Enqueue messages with different priorities\n      const lowPriorityId = queueSystem.enqueue('test-queue', 'low', {}, { priority: 1 });\n      const highPriorityId = queueSystem.enqueue('test-queue', 'high', {}, { priority: 10 });\n      const mediumPriorityId = queueSystem.enqueue('test-queue', 'medium', {}, { priority: 5 });\n      \n      // Dequeue should return highest priority first\n      const messages = queueSystem.dequeue('test-queue', 3);\n      \n      expect(messages).toHaveLength(3);\n      expect(messages[0].id).toBe(highPriorityId);\n      expect(messages[1].id).toBe(mediumPriorityId);\n      expect(messages[2].id).toBe(lowPriorityId);\n    });\n\n    test.skip('should handle scheduled messages correctly', () => {\n      const futureTime = Date.now() + 10000; // 10 seconds in future\n      \n      // Enqueue message scheduled for future\n      const messageId = queueSystem.enqueue(\n        'test-queue',\n        'future-message',\n        { scheduled: true },\n        { scheduledAt: futureTime }\n      );\n      \n      // Should not dequeue immediately\n      let messages = queueSystem.dequeue('test-queue', 1);\n      expect(messages).toHaveLength(0);\n      \n      // Enqueue message for immediate processing\n      queueSystem.enqueue('test-queue', 'immediate', { now: true });\n      \n      // Should only get the immediate message\n      messages = queueSystem.dequeue('test-queue', 2);\n      expect(messages).toHaveLength(1);\n      expect(messages[0].message_type).toBe('immediate');\n    });\n  });\n\n  describe('Message Status Management', () => {\n    test('should mark messages as completed', () => {\n      const messageId = queueSystem.enqueue('test-queue', 'test', {});\n      const messages = queueSystem.dequeue('test-queue', 1);\n      \n      expect(messages[0].status).toBe('processing');\n      \n      queueSystem.markCompleted(messageId);\n      \n      // Verify status changed\n      const db = queueSystem['db'];\n      const result = db.prepare('SELECT status FROM queue_messages WHERE id = ?').get(messageId) as any;\n      expect(result.status).toBe('completed');\n    });\n\n    test.skip('should handle retry logic correctly', () => {\n      const messageId = queueSystem.enqueue('test-queue', 'test', {}, { maxRetries: 2 });\n      queueSystem.dequeue('test-queue', 1);\n      \n      // First failure should schedule retry\n      queueSystem.markFailed(messageId, 'Test error');\n      \n      const db = queueSystem['db'];\n      let result = db.prepare('SELECT status, retry_count FROM queue_messages WHERE id = ?').get(messageId) as any;\n      expect(result.status).toBe('retrying');\n      expect(result.retry_count).toBe(1);\n      \n      // Dequeue and fail again\n      queueSystem.dequeue('test-queue', 1);\n      queueSystem.markFailed(messageId, 'Test error 2');\n      \n      result = db.prepare('SELECT status, retry_count FROM queue_messages WHERE id = ?').get(messageId) as any;\n      expect(result.status).toBe('retrying');\n      expect(result.retry_count).toBe(2);\n      \n      // Third failure should move to dead letter queue\n      queueSystem.dequeue('test-queue', 1);\n      queueSystem.markFailed(messageId, 'Final error');\n      \n      result = db.prepare('SELECT status, retry_count FROM queue_messages WHERE id = ?').get(messageId) as any;\n      expect(result.status).toBe('failed');\n      \n      // Check dead letter queue\n      const dlqResult = db.prepare('SELECT COUNT(*) as count FROM dead_letter_queue WHERE original_message_id = ?').get(messageId) as any;\n      expect(dlqResult.count).toBe(1);\n    });\n  });\n\n  describe('Queue Statistics', () => {\n    test.skip('should return accurate queue statistics', () => {\n      // Create messages with different statuses\n      const completedId = queueSystem.enqueue('test-queue', 'completed', {});\n      const pendingId1 = queueSystem.enqueue('test-queue', 'pending1', {});\n      const pendingId2 = queueSystem.enqueue('test-queue', 'pending2', {});\n      const processingId = queueSystem.enqueue('test-queue', 'processing', {});\n      \n      // Mark one as completed\n      queueSystem.dequeue('test-queue', 1);\n      queueSystem.markCompleted(completedId);\n      \n      // Mark one as processing (dequeue)\n      queueSystem.dequeue('test-queue', 1);\n      \n      const stats = queueSystem.getQueueStats('test-queue');\n      \n      expect(stats.queueName).toBe('test-queue');\n      expect(stats.pending).toBe(2);\n      expect(stats.processing).toBe(1);\n      expect(stats.completed).toBe(1);\n      expect(stats.failed).toBe(0);\n      expect(stats.retrying).toBe(0);\n    });\n  });\n\n  describe('Cleanup Operations', () => {\n    test('should clean up old messages', () => {\n      // Create old completed message\n      const oldTime = Date.now() - (8 * 24 * 60 * 60 * 1000); // 8 days ago\n      const messageId = queueSystem.enqueue('test-queue', 'old', {});\n      \n      // Manually update processed_at to simulate old message\n      const db = queueSystem['db'];\n      db.prepare('UPDATE queue_messages SET status = ?, processed_at = ? WHERE id = ?')\n        .run('completed', oldTime, messageId);\n      \n      // Trigger cleanup\n      queueSystem['cleanupOldMessages']();\n      \n      // Message should be deleted\n      const result = db.prepare('SELECT COUNT(*) as count FROM queue_messages WHERE id = ?').get(messageId) as any;\n      expect(result.count).toBe(0);\n    });\n  });\n});\n\ndescribe('QueueAPI', () => {\n  let queueAPI: QueueAPI;\n  let testDbPath: string;\n\n  beforeEach(() => {\n    testDbPath = path.join(__dirname, `test-queue-api-${Date.now()}.db`);\n    \n    const mockConfig = {\n      getDatabasePath: () => testDbPath\n    };\n    \n    jest.doMock('../../src/services/config', () => ({\n      ConfigService: {\n        getInstance: () => mockConfig\n      }\n    }));\n\n    queueAPI = QueueAPI.getInstance();\n  });\n\n  afterEach(() => {\n    queueAPI.close();\n    \n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    \n    jest.clearAllMocks();\n    jest.resetModules();\n  });\n\n  describe('High-level Operations', () => {\n    test('should enqueue hook events correctly', () => {\n      const messageId = queueAPI.enqueueHookEvent(\n        'tool-use',\n        { toolName: 'test-tool', input: 'test-input' },\n        { priority: 7, correlationId: 'test-correlation' }\n      );\n      \n      expect(messageId).toBeGreaterThan(0);\n      \n      const messages = queueAPI.peekMessages('hook-events', 1);\n      expect(messages).toHaveLength(1);\n      expect(messages[0].message_type).toBe('tool-use');\n      expect(messages[0].priority).toBe(7);\n      expect(messages[0].correlation_id).toBe('test-correlation');\n    });\n\n    test('should enqueue MCP operations correctly', () => {\n      const messageId = queueAPI.enqueueMCPOperation(\n        'memory',\n        'search',\n        { query: 'test query' },\n        { priority: 6 }\n      );\n      \n      expect(messageId).toBeGreaterThan(0);\n      \n      const messages = queueAPI.peekMessages('mcp-operations', 1);\n      expect(messages).toHaveLength(1);\n      expect(messages[0].message_type).toBe('memory:search');\n      expect(messages[0].priority).toBe(6);\n    });\n\n    test('should handle bulk operations', () => {\n      const operations = [\n        { operation: 'store', payload: { key: 'test1', value: 'value1' } },\n        { operation: 'store', payload: { key: 'test2', value: 'value2' } },\n        { operation: 'search', payload: { query: 'test query' } }\n      ];\n      \n      // This would be tested with the enhanced memory tools\n      // For now, just verify the API exists\n      expect(typeof queueAPI.enqueueMemoryOperation).toBe('function');\n    });\n  });\n\n  describe('System Health', () => {\n    test('should return system health status', () => {\n      // Add some test messages\n      queueAPI.enqueueHookEvent('test', {});\n      queueAPI.enqueueMCPOperation('test', 'op', {});\n      \n      const health = queueAPI.getSystemHealth();\n      \n      expect(health).toHaveProperty('isHealthy');\n      expect(health).toHaveProperty('totalPendingMessages');\n      expect(health).toHaveProperty('totalProcessingMessages');\n      expect(health).toHaveProperty('totalFailedMessages');\n      expect(health).toHaveProperty('deadLetterCount');\n      expect(health).toHaveProperty('uptime');\n      \n      expect(health.totalPendingMessages).toBeGreaterThan(0);\n    });\n  });\n});\n\n// Migration tests removed - not applicable for fresh installations\n// These tests were for migrating from non-existent old schema"],"version":3}