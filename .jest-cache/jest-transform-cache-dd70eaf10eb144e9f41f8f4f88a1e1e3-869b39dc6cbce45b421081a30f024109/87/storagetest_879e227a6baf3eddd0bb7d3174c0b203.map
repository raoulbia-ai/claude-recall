{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/storage.test.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/storage.test.ts"],"sourcesContent":["import { MemoryStorage } from '../../src/memory/storage';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ndescribe('MemoryStorage', () => {\n  let storage: MemoryStorage;\n  \n  beforeEach(() => {\n    storage = new MemoryStorage(':memory:');\n  });\n  \n  afterEach(() => {\n    storage.close();\n  });\n  \n  it('should save and retrieve memories', () => {\n    const memory = {\n      key: 'test-key',\n      value: { data: 'test' },\n      type: 'preference',\n      project_id: 'test-project',\n      file_path: 'test.ts'\n    };\n    \n    storage.save(memory);\n    const retrieved = storage.retrieve('test-key');\n    \n    expect(retrieved).toBeDefined();\n    expect(retrieved?.value).toEqual(memory.value);\n    expect(retrieved?.type).toBe(memory.type);\n    expect(retrieved?.project_id).toBe(memory.project_id);\n    expect(retrieved?.file_path).toBe(memory.file_path);\n  });\n  \n  it('should update access count on retrieval', () => {\n    const memory = {\n      key: 'access-test',\n      value: { test: true },\n      type: 'test'\n    };\n    \n    storage.save(memory);\n    \n    const first = storage.retrieve('access-test');\n    expect(first?.access_count).toBe(1);\n    \n    const second = storage.retrieve('access-test');\n    expect(second?.access_count).toBe(2);\n    expect(second?.last_accessed).toBeDefined();\n  });\n  \n  it('should search memories by context', () => {\n    storage.save({\n      key: 'proj1-file1',\n      value: { data: 1 },\n      type: 'code',\n      project_id: 'project1',\n      file_path: 'file1.ts'\n    });\n    \n    storage.save({\n      key: 'proj1-file2',\n      value: { data: 2 },\n      type: 'code',\n      project_id: 'project1',\n      file_path: 'file2.ts'\n    });\n    \n    storage.save({\n      key: 'proj2-file1',\n      value: { data: 3 },\n      type: 'code',\n      project_id: 'project2',\n      file_path: 'file1.ts'\n    });\n    \n    const project1Memories = storage.searchByContext({ project_id: 'project1' });\n    expect(project1Memories).toHaveLength(2);\n    \n    const file1Memories = storage.searchByContext({ file_path: 'file1.ts' });\n    expect(file1Memories).toHaveLength(2);\n    \n    const codeMemories = storage.searchByContext({ type: 'code' });\n    expect(codeMemories).toHaveLength(3);\n  });\n  \n  it('should search memories by query', () => {\n    storage.save({\n      key: 'auth-function',\n      value: { name: 'validateAuth' },\n      type: 'function'\n    });\n    \n    storage.save({\n      key: 'user-auth',\n      value: { name: 'checkUser' },\n      type: 'function'\n    });\n    \n    storage.save({\n      key: 'config',\n      value: { authEnabled: true },\n      type: 'config'\n    });\n    \n    const authResults = storage.search('auth');\n    expect(authResults.length).toBeGreaterThanOrEqual(2);\n    expect(authResults.some(m => m.key === 'auth-function')).toBe(true);\n    expect(authResults.some(m => m.key === 'user-auth')).toBe(true);\n  });\n  \n  it('should get stats', () => {\n    storage.save({ key: 'pref1', value: {}, type: 'preference' });\n    storage.save({ key: 'pref2', value: {}, type: 'preference' });\n    storage.save({ key: 'code1', value: {}, type: 'code' });\n    \n    const stats = storage.getStats();\n    expect(stats.total).toBe(3);\n    expect(stats.byType.preference).toBe(2);\n    expect(stats.byType.code).toBe(1);\n  });\n  \n  it('should handle memory updates', () => {\n    const memory = {\n      key: 'update-test',\n      value: { version: 1 },\n      type: 'test'\n    };\n    \n    storage.save(memory);\n    \n    const updated = {\n      key: 'update-test',\n      value: { version: 2 },\n      type: 'test'\n    };\n    \n    storage.save(updated);\n    \n    const retrieved = storage.retrieve('update-test');\n    expect(retrieved?.value).toEqual({ version: 2 });\n  });\n  \n  it('should handle multiple initializations without errors', () => {\n    // Create a temporary file for the database\n    const tmpDb = path.join(__dirname, 'test-multi-init.db');\n    \n    try {\n      // First initialization\n      const storage1 = new MemoryStorage(tmpDb);\n      storage1.save({\n        key: 'init-test',\n        value: { test: true },\n        type: 'test'\n      });\n      storage1.close();\n      \n      // Second initialization - should not throw error\n      const storage2 = new MemoryStorage(tmpDb);\n      const retrieved = storage2.retrieve('init-test');\n      expect(retrieved?.value).toEqual({ test: true });\n      \n      // Third initialization - verify idempotency\n      const storage3 = new MemoryStorage(tmpDb);\n      storage3.save({\n        key: 'init-test-2',\n        value: { test: 2 },\n        type: 'test'\n      });\n      storage3.close();\n      \n      // Close second instance\n      storage2.close();\n      \n      // Verify both records exist\n      const storage4 = new MemoryStorage(tmpDb);\n      expect(storage4.retrieve('init-test')).toBeDefined();\n      expect(storage4.retrieve('init-test-2')).toBeDefined();\n      storage4.close();\n      \n    } finally {\n      // Clean up\n      if (fs.existsSync(tmpDb)) {\n        fs.unlinkSync(tmpDb);\n      }\n    }\n  });\n});"],"version":3}