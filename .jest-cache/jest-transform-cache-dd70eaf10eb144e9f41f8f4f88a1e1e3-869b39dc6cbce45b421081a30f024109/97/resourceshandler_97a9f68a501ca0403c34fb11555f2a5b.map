{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/resources-handler.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/resources-handler.ts"],"sourcesContent":["import { MemoryService } from '../services/memory';\nimport { MemoryStorage } from '../memory/storage';\nimport { LoggingService } from '../services/logging';\nimport { MCPRequest, MCPResponse } from './server';\n\nexport interface MCPResource {\n  uri: string;\n  name: string;\n  description: string;\n  mimeType: string;\n  metadata?: {\n    size?: number;\n    lastUpdated?: string;\n    category?: string;\n  };\n}\n\nexport interface ResourceContent {\n  uri: string;\n  mimeType: string;\n  text?: string;\n  blob?: string;\n}\n\n/**\n * Handles MCP Resources protocol\n * Resources are static/semi-static context that Claude Code can subscribe to\n * and automatically inject into conversations\n */\nexport class ResourcesHandler {\n  private logger: LoggingService;\n  private memoryService: MemoryService;\n  private memoryStorage: MemoryStorage;\n\n  constructor() {\n    this.logger = LoggingService.getInstance();\n    this.memoryService = MemoryService.getInstance();\n    this.memoryStorage = (this.memoryService as any).storage;\n  }\n\n  /**\n   * Handle resources/list request\n   * Returns list of available resources Claude Code can subscribe to\n   */\n  async handleResourcesList(request: MCPRequest): Promise<MCPResponse> {\n    try {\n      const stats = this.memoryService.getStats();\n      const resources: MCPResource[] = [];\n\n      // Resource: All preferences\n      if (stats.byType.preference > 0) {\n        resources.push({\n          uri: 'claude-recall://preferences/all',\n          name: 'User Preferences',\n          description: 'All stored coding preferences, tool choices, and workflow patterns',\n          mimeType: 'application/json',\n          metadata: {\n            size: stats.byType.preference,\n            category: 'preferences',\n            lastUpdated: new Date().toISOString()\n          }\n        });\n      }\n\n      // Resource: Project knowledge\n      if (stats.byType['project-knowledge'] > 0) {\n        resources.push({\n          uri: 'claude-recall://project/knowledge',\n          name: 'Project Knowledge',\n          description: 'Database configs, API patterns, architecture decisions, dependencies',\n          mimeType: 'application/json',\n          metadata: {\n            size: stats.byType['project-knowledge'],\n            category: 'knowledge',\n            lastUpdated: new Date().toISOString()\n          }\n        });\n      }\n\n      // Resource: Recent corrections\n      if (stats.byType.correction > 0) {\n        resources.push({\n          uri: 'claude-recall://corrections/recent',\n          name: 'Recent Corrections',\n          description: 'Patterns learned from corrections and mistakes to avoid',\n          mimeType: 'application/json',\n          metadata: {\n            size: Math.min(stats.byType.correction, 10),\n            category: 'corrections',\n            lastUpdated: new Date().toISOString()\n          }\n        });\n      }\n\n      // Resource: Active context (top 5 most relevant)\n      resources.push({\n        uri: 'claude-recall://context/active',\n        name: 'Active Context',\n        description: 'Most relevant memories for current work session',\n        mimeType: 'application/json',\n        metadata: {\n          size: 5,\n          category: 'context',\n          lastUpdated: new Date().toISOString()\n        }\n      });\n\n      this.logger.info('ResourcesHandler', 'Listed resources', {\n        count: resources.length,\n        categories: resources.map(r => r.metadata?.category)\n      });\n\n      return {\n        jsonrpc: '2.0',\n        id: request.id,\n        result: {\n          resources\n        }\n      };\n    } catch (error) {\n      this.logger.error('ResourcesHandler', 'Failed to list resources', error);\n      return this.createErrorResponse(request.id, -32603, 'Failed to list resources');\n    }\n  }\n\n  /**\n   * Handle resources/read request\n   * Returns content of a specific resource\n   */\n  async handleResourcesRead(request: MCPRequest): Promise<MCPResponse> {\n    try {\n      const { uri } = request.params || {};\n\n      if (!uri || typeof uri !== 'string') {\n        return this.createErrorResponse(request.id, -32602, 'Missing or invalid uri parameter');\n      }\n\n      let content: ResourceContent;\n\n      switch (uri) {\n        case 'claude-recall://preferences/all':\n          content = await this.getPreferencesResource(uri);\n          break;\n\n        case 'claude-recall://project/knowledge':\n          content = await this.getProjectKnowledgeResource(uri);\n          break;\n\n        case 'claude-recall://corrections/recent':\n          content = await this.getCorrectionsResource(uri);\n          break;\n\n        case 'claude-recall://context/active':\n          content = await this.getActiveContextResource(uri);\n          break;\n\n        default:\n          return this.createErrorResponse(request.id, -32602, `Unknown resource URI: ${uri}`);\n      }\n\n      this.logger.info('ResourcesHandler', 'Read resource', {\n        uri,\n        contentLength: content.text?.length || 0\n      });\n\n      return {\n        jsonrpc: '2.0',\n        id: request.id,\n        result: {\n          contents: [content]\n        }\n      };\n    } catch (error) {\n      this.logger.error('ResourcesHandler', 'Failed to read resource', error);\n      return this.createErrorResponse(request.id, -32603, 'Failed to read resource');\n    }\n  }\n\n  /**\n   * Get preferences resource content\n   */\n  private async getPreferencesResource(uri: string): Promise<ResourceContent> {\n    const memories = this.memoryStorage.searchByContext({ type: 'preference' });\n\n    // Format preferences for easy consumption\n    const preferences = memories.map(m => ({\n      key: m.key,\n      value: m.value,\n      timestamp: m.timestamp,\n      accessCount: m.access_count,\n      confidence: m.relevance_score\n    }));\n\n    // Group by category for better organization\n    const grouped = this.groupPreferences(preferences);\n\n    const text = this.formatPreferencesAsText(grouped);\n\n    return {\n      uri,\n      mimeType: 'text/markdown',\n      text\n    };\n  }\n\n  /**\n   * Get project knowledge resource content\n   */\n  private async getProjectKnowledgeResource(uri: string): Promise<ResourceContent> {\n    const memories = this.memoryStorage.searchByContext({ type: 'project-knowledge' });\n\n    const knowledge = memories.map(m => ({\n      key: m.key,\n      content: m.value,\n      project: m.project_id,\n      file: m.file_path,\n      timestamp: m.timestamp\n    }));\n\n    const text = this.formatKnowledgeAsText(knowledge);\n\n    return {\n      uri,\n      mimeType: 'text/markdown',\n      text\n    };\n  }\n\n  /**\n   * Get recent corrections resource content\n   */\n  private async getCorrectionsResource(uri: string): Promise<ResourceContent> {\n    const memories = this.memoryStorage.searchByContext({ type: 'correction' });\n\n    // Get most recent 10 corrections\n    const recentCorrections = memories\n      .sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0))\n      .slice(0, 10);\n\n    const corrections = recentCorrections.map(m => ({\n      pattern: m.value,\n      timestamp: m.timestamp,\n      frequency: m.access_count\n    }));\n\n    const text = this.formatCorrectionsAsText(corrections);\n\n    return {\n      uri,\n      mimeType: 'text/markdown',\n      text\n    };\n  }\n\n  /**\n   * Get active context resource content\n   * Returns most relevant memories for current session\n   */\n  private async getActiveContextResource(uri: string): Promise<ResourceContent> {\n    // Get top 5 most accessed memories from last 24 hours\n    const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);\n    const allMemories = this.memoryStorage.searchByContext({});\n\n    const recentMemories = allMemories\n      .filter(m => (m.timestamp || 0) > oneDayAgo)\n      .sort((a, b) => (b.access_count || 0) - (a.access_count || 0))\n      .slice(0, 5);\n\n    const context = recentMemories.map(m => ({\n      type: m.type,\n      key: m.key,\n      value: m.value,\n      relevance: m.relevance_score,\n      accessCount: m.access_count\n    }));\n\n    const text = this.formatContextAsText(context);\n\n    return {\n      uri,\n      mimeType: 'text/markdown',\n      text\n    };\n  }\n\n  /**\n   * Group preferences by category\n   */\n  private groupPreferences(preferences: any[]): Map<string, any[]> {\n    const groups = new Map<string, any[]>();\n\n    for (const pref of preferences) {\n      const category = this.categorizePreference(pref.key);\n      if (!groups.has(category)) {\n        groups.set(category, []);\n      }\n      groups.get(category)!.push(pref);\n    }\n\n    return groups;\n  }\n\n  /**\n   * Categorize preference by key\n   */\n  private categorizePreference(key: string): string {\n    if (key.includes('test') || key.includes('spec')) return 'Testing';\n    if (key.includes('indent') || key.includes('format') || key.includes('style')) return 'Code Style';\n    if (key.includes('framework') || key.includes('library')) return 'Frameworks';\n    if (key.includes('file') || key.includes('directory')) return 'File Organization';\n    if (key.includes('git') || key.includes('commit')) return 'Version Control';\n    return 'General';\n  }\n\n  /**\n   * Format preferences as human-readable text\n   */\n  private formatPreferencesAsText(grouped: Map<string, any[]>): string {\n    let text = '# User Preferences\\n\\n';\n    text += '_Automatically captured coding preferences and patterns_\\n\\n';\n\n    for (const [category, prefs] of grouped.entries()) {\n      text += `## ${category}\\n\\n`;\n\n      for (const pref of prefs) {\n        const value = typeof pref.value === 'object'\n          ? JSON.stringify(pref.value, null, 2)\n          : pref.value;\n\n        text += `- **${pref.key}**: ${value}\\n`;\n        if (pref.confidence >= 0.9) {\n          text += `  - ✓ High confidence (${(pref.confidence * 100).toFixed(0)}%)\\n`;\n        }\n      }\n      text += '\\n';\n    }\n\n    return text;\n  }\n\n  /**\n   * Format project knowledge as human-readable text\n   */\n  private formatKnowledgeAsText(knowledge: any[]): string {\n    let text = '# Project Knowledge\\n\\n';\n    text += '_Database configs, API patterns, architecture decisions_\\n\\n';\n\n    // Group by project if available\n    const byProject = new Map<string, any[]>();\n    for (const item of knowledge) {\n      const project = item.project || 'General';\n      if (!byProject.has(project)) {\n        byProject.set(project, []);\n      }\n      byProject.get(project)!.push(item);\n    }\n\n    for (const [project, items] of byProject.entries()) {\n      if (project !== 'General') {\n        text += `## Project: ${project}\\n\\n`;\n      }\n\n      for (const item of items) {\n        text += `### ${item.key}\\n\\n`;\n\n        if (typeof item.content === 'object') {\n          text += '```json\\n';\n          text += JSON.stringify(item.content, null, 2);\n          text += '\\n```\\n\\n';\n        } else {\n          text += `${item.content}\\n\\n`;\n        }\n\n        if (item.file) {\n          text += `_Related to: ${item.file}_\\n\\n`;\n        }\n      }\n    }\n\n    return text;\n  }\n\n  /**\n   * Format corrections as human-readable text\n   */\n  private formatCorrectionsAsText(corrections: any[]): string {\n    let text = '# Recent Corrections\\n\\n';\n    text += '_Patterns learned from mistakes to avoid_\\n\\n';\n\n    for (const correction of corrections) {\n      const pattern = typeof correction.pattern === 'object'\n        ? correction.pattern\n        : { description: correction.pattern };\n\n      text += `## Pattern\\n\\n`;\n\n      if (pattern.original && pattern.corrected) {\n        text += `- ❌ Avoid: \\`${pattern.original}\\`\\n`;\n        text += `- ✓ Use: \\`${pattern.corrected}\\`\\n`;\n      } else {\n        text += `- ${pattern.description || JSON.stringify(pattern)}\\n`;\n      }\n\n      if (correction.frequency > 1) {\n        text += `- Observed ${correction.frequency} times\\n`;\n      }\n\n      text += '\\n';\n    }\n\n    return text;\n  }\n\n  /**\n   * Format active context as human-readable text\n   */\n  private formatContextAsText(context: any[]): string {\n    let text = '# Active Context\\n\\n';\n    text += '_Most relevant memories for current session_\\n\\n';\n\n    if (context.length === 0) {\n      text += '_No active context yet. Memories will appear here as you work._\\n';\n      return text;\n    }\n\n    for (const item of context) {\n      text += `## ${item.type}\\n\\n`;\n\n      const value = typeof item.value === 'object'\n        ? JSON.stringify(item.value, null, 2)\n        : item.value;\n\n      text += `${value}\\n\\n`;\n      text += `_Used ${item.accessCount} times | Relevance: ${(item.relevance * 100).toFixed(0)}%_\\n\\n`;\n    }\n\n    return text;\n  }\n\n  /**\n   * Create error response\n   */\n  private createErrorResponse(id: string | number, code: number, message: string): MCPResponse {\n    return {\n      jsonrpc: '2.0',\n      id,\n      error: {\n        code,\n        message\n      }\n    };\n  }\n}\n"],"version":3}