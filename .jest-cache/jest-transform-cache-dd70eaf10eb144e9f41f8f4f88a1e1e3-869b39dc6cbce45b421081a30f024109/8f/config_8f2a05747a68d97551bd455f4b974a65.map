{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/services/config.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/services/config.ts"],"sourcesContent":["import * as path from 'path';\nimport * as fs from 'fs';\nimport * as os from 'os';\n\nexport interface ClaudeRecallConfig {\n  // Database configuration\n  database: {\n    path: string;\n    name: string;\n    // Compaction settings\n    compaction?: {\n      autoCompact: boolean;\n      compactThreshold: number;\n      maxMemories: number;\n      retention: {\n        toolUse: number;\n        corrections: number;\n        preferences: number;\n        projectKnowledge: number;\n      };\n    };\n  };\n  \n  // Logging configuration\n  logging: {\n    directory: string;\n    level: 'debug' | 'info' | 'warn' | 'error';\n    maxFiles: number;\n    maxSize: string;\n  };\n  \n  // Memory configuration\n  memory: {\n    maxRetrieval: number;\n    relevanceThreshold: number;\n    decayFactor: number;\n    halfLife: number;\n  };\n  \n  // Project configuration\n  project: {\n    rootDir: string;\n    name?: string;\n    id?: string;\n  };\n  \n  // Hook configuration\n  hooks: {\n    timeout: number;\n    enabled: boolean;\n  };\n}\n\nexport class ConfigService {\n  private static instance: ConfigService;\n  private config: ClaudeRecallConfig;\n  \n  private constructor() {\n    this.config = this.loadConfig();\n  }\n  \n  static getInstance(): ConfigService {\n    if (!ConfigService.instance) {\n      ConfigService.instance = new ConfigService();\n    }\n    return ConfigService.instance;\n  }\n  \n  private loadConfig(): ClaudeRecallConfig {\n    // Default configuration\n    const defaultConfig: ClaudeRecallConfig = {\n      database: {\n        path: process.env.CLAUDE_RECALL_DB_PATH || path.join(os.homedir(), '.claude-recall'),\n        name: process.env.CLAUDE_RECALL_DB_NAME || 'claude-recall.db',\n        compaction: {\n          autoCompact: process.env.CLAUDE_RECALL_AUTO_COMPACT !== 'false',\n          compactThreshold: parseInt(process.env.CLAUDE_RECALL_COMPACT_THRESHOLD || '10485760'), // 10MB\n          maxMemories: parseInt(process.env.CLAUDE_RECALL_MAX_MEMORIES || '10000'),\n          retention: {\n            toolUse: parseInt(process.env.CLAUDE_RECALL_RETAIN_TOOL_USE || '1000'),\n            corrections: parseInt(process.env.CLAUDE_RECALL_RETAIN_CORRECTIONS || '100'),\n            preferences: parseInt(process.env.CLAUDE_RECALL_RETAIN_PREFERENCES || '-1'), // Keep forever\n            projectKnowledge: parseInt(process.env.CLAUDE_RECALL_RETAIN_PROJECT_KNOWLEDGE || '-1') // Keep forever\n          }\n        }\n      },\n      logging: {\n        directory: process.env.CLAUDE_RECALL_LOG_DIR || path.join(os.homedir(), '.claude-recall', 'logs'),\n        level: (process.env.CLAUDE_RECALL_LOG_LEVEL as any) || 'info',\n        maxFiles: parseInt(process.env.CLAUDE_RECALL_LOG_MAX_FILES || '5'),\n        maxSize: process.env.CLAUDE_RECALL_LOG_MAX_SIZE || '10MB'\n      },\n      memory: {\n        maxRetrieval: parseInt(process.env.CLAUDE_RECALL_MAX_RETRIEVAL || '5'),\n        relevanceThreshold: parseFloat(process.env.CLAUDE_RECALL_RELEVANCE_THRESHOLD || '0.1'),\n        decayFactor: parseFloat(process.env.CLAUDE_RECALL_DECAY_FACTOR || '0.5'),\n        halfLife: parseInt(process.env.CLAUDE_RECALL_HALF_LIFE || '7')\n      },\n      project: {\n        rootDir: process.env.CLAUDE_PROJECT_DIR || process.cwd(),\n        name: process.env.CLAUDE_PROJECT_NAME,\n        id: process.env.CLAUDE_PROJECT_ID\n      },\n      hooks: {\n        timeout: parseInt(process.env.CLAUDE_RECALL_HOOK_TIMEOUT || '5000'),\n        enabled: process.env.CLAUDE_RECALL_HOOKS_ENABLED !== 'false'\n      }\n    };\n    \n    // Try to load custom config file\n    const configPaths = [\n      path.join(process.cwd(), '.claude-recall.json'),\n      path.join(process.cwd(), 'claude-recall.config.json'),\n      process.env.CLAUDE_RECALL_CONFIG_PATH\n    ].filter(Boolean);\n    \n    for (const configPath of configPaths) {\n      try {\n        if (fs.existsSync(configPath!)) {\n          const customConfig = JSON.parse(fs.readFileSync(configPath!, 'utf-8'));\n          return this.mergeConfig(defaultConfig, customConfig);\n        }\n      } catch (error) {\n        console.warn(`Failed to load config from ${configPath}: ${error}`);\n      }\n    }\n    \n    return defaultConfig;\n  }\n  \n  private mergeConfig(defaultConfig: ClaudeRecallConfig, customConfig: any): ClaudeRecallConfig {\n    return {\n      database: {\n        ...defaultConfig.database,\n        ...customConfig.database,\n        compaction: customConfig.database?.compaction ? {\n          ...defaultConfig.database.compaction,\n          ...customConfig.database.compaction,\n          retention: {\n            ...defaultConfig.database.compaction?.retention,\n            ...customConfig.database.compaction?.retention\n          }\n        } : defaultConfig.database.compaction\n      },\n      logging: { ...defaultConfig.logging, ...customConfig.logging },\n      memory: { ...defaultConfig.memory, ...customConfig.memory },\n      project: { ...defaultConfig.project, ...customConfig.project },\n      hooks: { ...defaultConfig.hooks, ...customConfig.hooks }\n    };\n  }\n  \n  getConfig(): ClaudeRecallConfig {\n    return { ...this.config };\n  }\n  \n  getDatabasePath(): string {\n    // ALWAYS use ~/.claude-recall/claude-recall.db regardless of environment variables\n    // This ensures consistency across CLI and MCP server\n    const dbDir = path.join(os.homedir(), '.claude-recall');\n    const dbPath = path.join(dbDir, 'claude-recall.db');\n    \n    // Ensure database directory exists\n    if (!fs.existsSync(dbDir)) {\n      fs.mkdirSync(dbDir, { recursive: true });\n    }\n    \n    return dbPath;\n  }\n  \n  getLogPath(logName: string): string {\n    return path.join(this.config.logging.directory, logName);\n  }\n  \n  getProjectId(): string {\n    return this.config.project.id || this.config.project.rootDir;\n  }\n  \n  updateConfig(updates: Partial<ClaudeRecallConfig>): void {\n    this.config = this.mergeConfig(this.config, updates);\n  }\n}"],"version":3}