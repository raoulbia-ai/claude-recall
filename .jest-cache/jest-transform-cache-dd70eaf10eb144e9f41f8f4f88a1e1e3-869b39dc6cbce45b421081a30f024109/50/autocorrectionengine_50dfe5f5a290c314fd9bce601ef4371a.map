{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/auto-correction-engine.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/auto-correction-engine.ts"],"sourcesContent":["import { MemoryService } from '../services/memory';\nimport { LoggingService } from '../services/logging';\nimport { TestResult } from './test-orchestrator';\n\nexport interface CodeSuggestion {\n  file: string;\n  line?: number;\n  original?: string;\n  suggested: string;\n  reason: string;\n  confidence: number;\n}\n\nexport interface CorrectionAttempt {\n  fix: CodeFix;\n  validation: ValidationResult;\n  shouldApply: boolean;\n}\n\nexport interface CodeFix {\n  issueType: string;\n  files: Array<{\n    path: string;\n    changes: Array<{\n      type: 'add' | 'modify' | 'delete';\n      content: string;\n      line?: number;\n    }>;\n  }>;\n  description: string;\n  confidence: number;\n}\n\nexport interface ValidationResult {\n  passed: boolean;\n  testsRun: number;\n  testsPassed: number;\n  improvements: string[];\n  regressions: string[];\n}\n\nexport interface FailureAnalysis {\n  issueType: 'search_compliance' | 'memory_persistence' | 'rate_limiting' | 'unknown';\n  rootCause: string;\n  affectedComponents: string[];\n  suggestedFixes: CodeSuggestion[];\n}\n\nexport class AutoCorrectionEngine {\n  private fixPatterns: Map<string, CodeFix> = new Map();\n  private successfulFixes: Map<string, CodeFix[]> = new Map();\n  \n  constructor(\n    private memoryService: MemoryService,\n    private logger: LoggingService\n  ) {\n    this.initializeFixPatterns();\n  }\n  \n  private initializeFixPatterns(): void {\n    // Pattern for search compliance issues\n    this.fixPatterns.set('missing_search', {\n      issueType: 'search_compliance',\n      files: [{\n        path: 'src/hooks/memory-search-enforcer.js',\n        changes: [{\n          type: 'modify',\n          content: `\n// Enhanced search enforcement\nexport function enforceMemorySearch(action, params) {\n  if (action === 'create_file' || action === 'modify_file') {\n    // Force search before file operations\n    const searchQuery = extractRelevantKeywords(params);\n    const searchResults = await memoryService.search(searchQuery);\n    \n    // Use search results to inform the action\n    params.context = {\n      ...params.context,\n      searchResults,\n      searchPerformed: true\n    };\n  }\n  return params;\n}`\n        }]\n      }],\n      description: 'Add search enforcement before file operations',\n      confidence: 0.8\n    });\n    \n    // Pattern for memory persistence issues\n    this.fixPatterns.set('memory_not_stored', {\n      issueType: 'memory_persistence',\n      files: [{\n        path: 'src/services/memory.ts',\n        changes: [{\n          type: 'modify',\n          content: `\n// Ensure memory persistence\nstore(request: MemoryStoreRequest): void {\n  try {\n    // Add retry logic for persistence\n    let retries = 3;\n    let stored = false;\n    \n    while (retries > 0 && !stored) {\n      try {\n        this.storage.save(memory);\n        stored = true;\n      } catch (err) {\n        retries--;\n        if (retries === 0) throw err;\n        await new Promise(r => setTimeout(r, 100));\n      }\n    }\n    \n    // Verify storage\n    const verified = this.storage.retrieve(memory.key);\n    if (!verified) {\n      throw new Error('Memory storage verification failed');\n    }\n  } catch (error) {\n    this.logger.error('Memory storage failed', error);\n    throw error;\n  }\n}`\n        }]\n      }],\n      description: 'Add retry logic and verification for memory persistence',\n      confidence: 0.75\n    });\n    \n    // Pattern for rate limiting bypass\n    this.fixPatterns.set('rate_limit_bypass', {\n      issueType: 'rate_limiting',\n      files: [{\n        path: 'src/mcp/rate-limiter.ts',\n        changes: [{\n          type: 'modify',\n          content: `\n// Stricter rate limiting\ncheckLimit(sessionId: string): boolean {\n  const now = Date.now();\n  const session = this.sessions.get(sessionId) || this.createSession(sessionId);\n  \n  // Clean old requests\n  session.requests = session.requests.filter(r => now - r < this.windowMs);\n  \n  // Check limit with buffer\n  const buffer = 0.9; // 90% of limit to be safe\n  if (session.requests.length >= this.maxRequests * buffer) {\n    this.logger.warn('Rate limit approaching', { sessionId, requests: session.requests.length });\n    return false;\n  }\n  \n  session.requests.push(now);\n  return true;\n}`\n        }]\n      }],\n      description: 'Implement stricter rate limiting with buffer',\n      confidence: 0.85\n    });\n  }\n  \n  async analyzeFailure(testResult: TestResult): Promise<FailureAnalysis> {\n    this.logger.info('AutoCorrectionEngine', 'Analyzing test failure', {\n      scenario: testResult.scenario,\n      status: testResult.status\n    });\n    \n    // Determine issue type based on violations\n    let issueType: FailureAnalysis['issueType'] = 'unknown';\n    let rootCause = 'Unknown issue';\n    const affectedComponents: string[] = [];\n    const suggestedFixes: CodeSuggestion[] = [];\n    \n    // Analyze compliance violations\n    for (const violation of testResult.observations.complianceViolations) {\n      if (violation.type === 'missing_search') {\n        issueType = 'search_compliance';\n        rootCause = 'Memory search not triggered before file operations';\n        affectedComponents.push('hooks/memory-search-enforcer.js');\n        \n        suggestedFixes.push({\n          file: 'src/hooks/memory-search-enforcer.js',\n          suggested: this.fixPatterns.get('missing_search')?.files[0].changes[0].content || '',\n          reason: 'Search must be performed before file creation to ensure context awareness',\n          confidence: 0.8\n        });\n      } else if (violation.type === 'memory_not_stored') {\n        issueType = 'memory_persistence';\n        rootCause = 'Memory storage mechanism failing or not persisting data';\n        affectedComponents.push('services/memory.ts', 'memory/storage.ts');\n        \n        suggestedFixes.push({\n          file: 'src/services/memory.ts',\n          suggested: this.fixPatterns.get('memory_not_stored')?.files[0].changes[0].content || '',\n          reason: 'Add retry logic and verification to ensure memories are persisted',\n          confidence: 0.75\n        });\n      } else if (violation.type === 'rate_limit_bypass') {\n        issueType = 'rate_limiting';\n        rootCause = 'Rate limiter not properly enforcing request limits';\n        affectedComponents.push('mcp/rate-limiter.ts');\n        \n        suggestedFixes.push({\n          file: 'src/mcp/rate-limiter.ts',\n          suggested: this.fixPatterns.get('rate_limit_bypass')?.files[0].changes[0].content || '',\n          reason: 'Implement stricter rate limiting with safety buffer',\n          confidence: 0.85\n        });\n      }\n    }\n    \n    // If no specific issue found, analyze insights\n    if (issueType === 'unknown' && testResult.insights.rootCause) {\n      rootCause = testResult.insights.rootCause;\n      \n      // Try to infer issue type from root cause\n      if (rootCause.includes('search')) {\n        issueType = 'search_compliance';\n        affectedComponents.push('hooks/memory-search-enforcer.js');\n      } else if (rootCause.includes('memory') || rootCause.includes('storage')) {\n        issueType = 'memory_persistence';\n        affectedComponents.push('services/memory.ts');\n      } else if (rootCause.includes('rate') || rootCause.includes('limit')) {\n        issueType = 'rate_limiting';\n        affectedComponents.push('mcp/rate-limiter.ts');\n      }\n    }\n    \n    return {\n      issueType,\n      rootCause,\n      affectedComponents,\n      suggestedFixes\n    };\n  }\n  \n  async generateFix(\n    analysis: FailureAnalysis,\n    codebaseContext?: any\n  ): Promise<CodeFix> {\n    this.logger.info('AutoCorrectionEngine', 'Generating fix', {\n      issueType: analysis.issueType,\n      components: analysis.affectedComponents\n    });\n    \n    // Get pattern-based fix if available\n    const patternFix = this.fixPatterns.get(\n      analysis.issueType === 'search_compliance' ? 'missing_search' :\n      analysis.issueType === 'memory_persistence' ? 'memory_not_stored' :\n      analysis.issueType === 'rate_limiting' ? 'rate_limit_bypass' :\n      'unknown'\n    );\n    \n    if (patternFix) {\n      // Enhance fix with context if available\n      if (codebaseContext) {\n        patternFix.confidence = this.adjustConfidenceBasedOnContext(\n          patternFix.confidence,\n          codebaseContext\n        );\n      }\n      \n      return patternFix;\n    }\n    \n    // Generate custom fix based on analysis\n    const customFix: CodeFix = {\n      issueType: analysis.issueType,\n      files: analysis.suggestedFixes.map(suggestion => ({\n        path: suggestion.file,\n        changes: [{\n          type: 'modify',\n          content: suggestion.suggested,\n          line: suggestion.line\n        }]\n      })),\n      description: `Auto-generated fix for ${analysis.issueType}: ${analysis.rootCause}`,\n      confidence: Math.max(...analysis.suggestedFixes.map(f => f.confidence), 0.5)\n    };\n    \n    return customFix;\n  }\n  \n  async attemptFix(\n    testResult: TestResult,\n    codebaseContext?: any\n  ): Promise<CorrectionAttempt> {\n    this.logger.info('AutoCorrectionEngine', 'Attempting automatic fix', {\n      scenario: testResult.scenario,\n      status: testResult.status\n    });\n    \n    // Analyze the failure\n    const analysis = await this.analyzeFailure(testResult);\n    \n    // Generate fix\n    const fix = await this.generateFix(analysis, codebaseContext);\n    \n    // Validate fix (simplified - in real implementation would apply and test)\n    const validation = await this.validateFix(fix, testResult);\n    \n    // Decide if fix should be applied\n    const shouldApply = validation.passed && fix.confidence >= 0.7;\n    \n    // Learn from the attempt\n    if (shouldApply) {\n      this.recordSuccessfulFix(analysis.issueType, fix);\n    }\n    \n    return {\n      fix,\n      validation,\n      shouldApply\n    };\n  }\n  \n  private async validateFix(fix: CodeFix, originalResult: TestResult): Promise<ValidationResult> {\n    // Simplified validation - in real implementation would:\n    // 1. Apply fix to sandbox environment\n    // 2. Re-run tests\n    // 3. Compare results\n    \n    const validation: ValidationResult = {\n      passed: false,\n      testsRun: 0,\n      testsPassed: 0,\n      improvements: [],\n      regressions: []\n    };\n    \n    // Simulate validation based on fix confidence and issue type\n    if (fix.confidence >= 0.7) {\n      validation.passed = true;\n      validation.testsRun = 5;\n      validation.testsPassed = Math.floor(5 * fix.confidence);\n      \n      if (fix.issueType === 'search_compliance') {\n        validation.improvements.push('Search now triggered before file operations');\n      } else if (fix.issueType === 'memory_persistence') {\n        validation.improvements.push('Memory persistence reliability improved');\n      } else if (fix.issueType === 'rate_limiting') {\n        validation.improvements.push('Rate limiting now properly enforced');\n      }\n      \n      // Check for potential regressions\n      if (fix.confidence < 0.9) {\n        validation.regressions.push('Potential performance impact - monitor closely');\n      }\n    } else {\n      validation.testsRun = 5;\n      validation.testsPassed = 2;\n      validation.regressions.push('Fix does not adequately address the issue');\n    }\n    \n    return validation;\n  }\n  \n  private adjustConfidenceBasedOnContext(\n    baseConfidence: number,\n    context: any\n  ): number {\n    let adjustedConfidence = baseConfidence;\n    \n    // Increase confidence if we've seen similar fixes work\n    if (context.previousSuccesses) {\n      adjustedConfidence = Math.min(1, adjustedConfidence + 0.1);\n    }\n    \n    // Decrease confidence if codebase is complex\n    if (context.complexity === 'high') {\n      adjustedConfidence = Math.max(0, adjustedConfidence - 0.1);\n    }\n    \n    // Adjust based on test coverage\n    if (context.testCoverage) {\n      const coverageBonus = context.testCoverage / 100 * 0.2;\n      adjustedConfidence = Math.min(1, adjustedConfidence + coverageBonus);\n    }\n    \n    return adjustedConfidence;\n  }\n  \n  private recordSuccessfulFix(issueType: string, fix: CodeFix): void {\n    if (!this.successfulFixes.has(issueType)) {\n      this.successfulFixes.set(issueType, []);\n    }\n    \n    const fixes = this.successfulFixes.get(issueType)!;\n    fixes.push(fix);\n    \n    // Keep only last 10 successful fixes per issue type\n    if (fixes.length > 10) {\n      fixes.shift();\n    }\n    \n    this.logger.info('AutoCorrectionEngine', 'Recorded successful fix', {\n      issueType,\n      totalSuccessfulFixes: fixes.length\n    });\n  }\n  \n  // Get learning insights\n  getLearningInsights(): {\n    mostCommonIssues: string[];\n    successRate: number;\n    recommendedFixes: Map<string, CodeFix>;\n  } {\n    const insights = {\n      mostCommonIssues: Array.from(this.successfulFixes.keys()),\n      successRate: 0,\n      recommendedFixes: new Map<string, CodeFix>()\n    };\n    \n    // Calculate success rate\n    let totalFixes = 0;\n    for (const fixes of this.successfulFixes.values()) {\n      totalFixes += fixes.length;\n    }\n    \n    if (totalFixes > 0) {\n      // Simplified - in real implementation would track attempts vs successes\n      insights.successRate = 0.75; // Assume 75% success rate\n    }\n    \n    // Get most successful fixes\n    for (const [issueType, fixes] of this.successfulFixes) {\n      if (fixes.length > 0) {\n        // Get fix with highest confidence\n        const bestFix = fixes.reduce((best, current) => \n          current.confidence > best.confidence ? current : best\n        );\n        insights.recommendedFixes.set(issueType, bestFix);\n      }\n    }\n    \n    return insights;\n  }\n}"],"version":3}