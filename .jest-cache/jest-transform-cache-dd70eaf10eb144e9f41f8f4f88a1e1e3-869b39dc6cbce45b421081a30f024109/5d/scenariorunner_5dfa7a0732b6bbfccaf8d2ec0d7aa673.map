{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/scenario-runner.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/scenario-runner.ts"],"sourcesContent":["import { MemoryService } from '../services/memory';\nimport { LoggingService } from '../services/logging';\nimport { SearchMonitor } from '../services/search-monitor';\n\nexport interface ScenarioStep {\n  action: 'store_memory' | 'search' | 'create_file' | 'retrieve' | 'wait';\n  params: any;\n  timing?: {\n    delay?: number;\n    timeout?: number;\n  };\n  validation?: {\n    expectSearch?: boolean;\n    expectMemory?: boolean;\n    expectResult?: any;\n  };\n}\n\nexport interface ScenarioDefinition {\n  name: string;\n  description: string;\n  steps: ScenarioStep[];\n  expectedOutcome: {\n    searchCompliance?: boolean;\n    memoryPersistence?: boolean;\n    fileLocation?: string;\n    customValidation?: (result: any) => boolean;\n  };\n}\n\nexport interface ScenarioResult {\n  name: string;\n  success: boolean;\n  steps: any[];\n  searches: any[];\n  files: any[];\n  expectedSearches?: boolean;\n  searchPerformed?: boolean;\n  expectedMemory?: boolean;\n  memoryStored?: boolean;\n  rateLimitExpected?: boolean;\n  rateLimitTriggered?: boolean;\n  errors: any[];\n}\n\nexport class ScenarioRunner {\n  private searchMonitor: SearchMonitor;\n  private scenarios: Map<string, ScenarioDefinition> = new Map();\n  \n  constructor(\n    private memoryService: MemoryService,\n    private logger: LoggingService\n  ) {\n    this.searchMonitor = SearchMonitor.getInstance();\n    this.registerScenarios();\n  }\n  \n  private registerScenarios(): void {\n    // Memory Persistence Test\n    this.scenarios.set('memory_persistence', {\n      name: 'memory_persistence',\n      description: 'Test if memories are persisted correctly with location preferences',\n      steps: [\n        {\n          action: 'store_memory',\n          params: {\n            content: 'Save all tests in test-pasta/ directory',\n            metadata: { type: 'preference', category: 'file_location' }\n          }\n        },\n        {\n          action: 'wait',\n          params: { duration: 100 }\n        },\n        {\n          action: 'create_file',\n          params: {\n            type: 'test',\n            name: 'sample.test.js'\n          },\n          validation: {\n            expectSearch: true\n          }\n        }\n      ],\n      expectedOutcome: {\n        searchCompliance: true,\n        memoryPersistence: true,\n        fileLocation: 'test-pasta/sample.test.js'\n      }\n    });\n    \n    // Search Compliance Test\n    this.scenarios.set('search_compliance', {\n      name: 'search_compliance',\n      description: 'Test if search is called before file creation',\n      steps: [\n        {\n          action: 'store_memory',\n          params: {\n            content: 'Project uses TypeScript with strict mode enabled',\n            metadata: { type: 'context', category: 'project_config' }\n          }\n        },\n        {\n          action: 'create_file',\n          params: {\n            name: 'utils.ts',\n            content: 'export function helper() {}'\n          },\n          validation: {\n            expectSearch: true\n          }\n        }\n      ],\n      expectedOutcome: {\n        searchCompliance: true\n      }\n    });\n    \n    // Rate Limiting Test\n    this.scenarios.set('rate_limiting', {\n      name: 'rate_limiting',\n      description: 'Test if rate limiting prevents excessive requests',\n      steps: [\n        // Generate 20 rapid requests\n        ...Array(20).fill(null).map((_, i) => ({\n          action: 'search' as const,\n          params: { query: `test query ${i}` },\n          timing: { delay: 10 } // 10ms between requests\n        }))\n      ],\n      expectedOutcome: {\n        customValidation: (result: any) => {\n          // Should have some rate limit errors\n          return result.errors && result.errors.some((e: any) => \n            e.message && e.message.includes('rate limit')\n          );\n        }\n      }\n    });\n    \n    // Context Retrieval Test\n    this.scenarios.set('context_retrieval', {\n      name: 'context_retrieval',\n      description: 'Test if relevant context is retrieved when needed',\n      steps: [\n        {\n          action: 'store_memory',\n          params: {\n            content: 'API endpoints should follow RESTful conventions',\n            metadata: { type: 'guideline', category: 'api_design' }\n          }\n        },\n        {\n          action: 'store_memory',\n          params: {\n            content: 'Use camelCase for JavaScript variables',\n            metadata: { type: 'guideline', category: 'code_style' }\n          }\n        },\n        {\n          action: 'search',\n          params: { query: 'API design guidelines' },\n          validation: {\n            expectResult: (results: any[]) => \n              results.length > 0 && \n              results.some(r => r.content?.includes('RESTful'))\n          }\n        }\n      ],\n      expectedOutcome: {\n        memoryPersistence: true\n      }\n    });\n    \n    // File Location Compliance Test\n    this.scenarios.set('file_location_compliance', {\n      name: 'file_location_compliance',\n      description: 'Test if files are created in the correct location based on preferences',\n      steps: [\n        {\n          action: 'store_memory',\n          params: {\n            content: 'Components go in src/components/',\n            metadata: { type: 'preference', category: 'file_organization' }\n          }\n        },\n        {\n          action: 'store_memory',\n          params: {\n            content: 'Tests go in __tests__/',\n            metadata: { type: 'preference', category: 'file_organization' }\n          }\n        },\n        {\n          action: 'search',\n          params: { query: 'component location' }\n        },\n        {\n          action: 'create_file',\n          params: {\n            type: 'component',\n            name: 'Button.jsx'\n          },\n          validation: {\n            expectSearch: true\n          }\n        }\n      ],\n      expectedOutcome: {\n        searchCompliance: true,\n        fileLocation: 'src/components/Button.jsx'\n      }\n    });\n  }\n  \n  async run(scenarioName: string, params?: any): Promise<ScenarioResult> {\n    const scenario = this.scenarios.get(scenarioName);\n    \n    if (!scenario) {\n      throw new Error(`Scenario '${scenarioName}' not found`);\n    }\n    \n    this.logger.info('ScenarioRunner', `Running scenario: ${scenarioName}`, {\n      description: scenario.description,\n      steps: scenario.steps.length\n    });\n    \n    const result: ScenarioResult = {\n      name: scenarioName,\n      success: true,\n      steps: [],\n      searches: [],\n      files: [],\n      errors: []\n    };\n    \n    // Track initial state\n    const searchesBefore = this.searchMonitor.getRecentSearches(100).length;\n    \n    // Execute steps\n    for (const [index, step] of scenario.steps.entries()) {\n      try {\n        this.logger.debug('ScenarioRunner', `Executing step ${index + 1}/${scenario.steps.length}`, step);\n        \n        // Apply timing delay if specified\n        if (step.timing?.delay) {\n          await new Promise(resolve => setTimeout(resolve, step.timing?.delay || 0));\n        }\n        \n        // Execute the step\n        const stepResult = await this.executeStep(step, params);\n        \n        // Record the result\n        result.steps.push({\n          index,\n          action: step.action,\n          result: stepResult,\n          validation: step.validation\n        });\n        \n        // Track searches and files\n        if (step.action === 'search') {\n          result.searches.push(stepResult);\n        } else if (step.action === 'create_file') {\n          result.files.push(stepResult);\n        }\n        \n        // Validate step if needed\n        if (step.validation) {\n          const validationResult = this.validateStep(step, stepResult);\n          if (!validationResult.valid) {\n            result.success = false;\n            result.errors.push({\n              step: index,\n              message: validationResult.message\n            });\n          }\n        }\n        \n      } catch (error) {\n        result.success = false;\n        result.errors.push({\n          step: index,\n          action: step.action,\n          error: (error as Error).message\n        });\n        \n        // Check if it's a rate limit error\n        if ((error as Error).message.includes('rate limit')) {\n          result.rateLimitTriggered = true;\n        }\n      }\n    }\n    \n    // Track final state\n    const searchesAfter = this.searchMonitor.getRecentSearches(100).length;\n    result.searchPerformed = searchesAfter > searchesBefore;\n    \n    // Apply expected outcome validation\n    if (scenario.expectedOutcome.searchCompliance !== undefined) {\n      result.expectedSearches = scenario.expectedOutcome.searchCompliance;\n    }\n    \n    if (scenario.expectedOutcome.memoryPersistence !== undefined) {\n      result.expectedMemory = scenario.expectedOutcome.memoryPersistence;\n      result.memoryStored = result.steps.some(s => \n        s.action === 'store_memory' && s.result?.success\n      );\n    }\n    \n    if (scenario.expectedOutcome.customValidation) {\n      const customValid = scenario.expectedOutcome.customValidation(result);\n      if (!customValid) {\n        result.success = false;\n        result.errors.push({\n          message: 'Custom validation failed'\n        });\n      }\n    }\n    \n    // Check for rate limiting expectation\n    if (scenarioName === 'rate_limiting') {\n      result.rateLimitExpected = true;\n    }\n    \n    return result;\n  }\n  \n  private async executeStep(step: ScenarioStep, params?: any): Promise<any> {\n    switch (step.action) {\n      case 'store_memory':\n        const key = `scenario_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        await this.memoryService.store({\n          key,\n          value: step.params,\n          type: step.params.metadata?.type || 'scenario_test',\n          context: {\n            sessionId: params?.sessionId || 'scenario_runner'\n          }\n        });\n        return { success: true, key };\n        \n      case 'search':\n        const results = await this.memoryService.search(step.params.query);\n        return results;\n        \n      case 'create_file':\n        // Simulate file creation\n        // In a real implementation, this would integrate with the file system\n        const shouldSearch = step.validation?.expectSearch;\n        if (shouldSearch) {\n          // Trigger a search to simulate compliance\n          await this.memoryService.search(`file location ${step.params.type}`);\n        }\n        return {\n          created: true,\n          path: this.determineFilePath(step.params),\n          ...step.params\n        };\n        \n      case 'retrieve':\n        const memory = await this.memoryService.retrieve(step.params.key);\n        return memory;\n        \n      case 'wait':\n        await new Promise(resolve => setTimeout(resolve, step.params.duration || 100));\n        return { waited: step.params.duration || 100 };\n        \n      default:\n        throw new Error(`Unknown action: ${step.action}`);\n    }\n  }\n  \n  private validateStep(step: ScenarioStep, result: any): { valid: boolean; message?: string } {\n    if (!step.validation) {\n      return { valid: true };\n    }\n    \n    if (step.validation.expectSearch !== undefined) {\n      // Check if search was performed (would need integration with search monitor)\n      // For now, assume it's valid\n      return { valid: true };\n    }\n    \n    if (step.validation.expectMemory !== undefined) {\n      const hasMemory = result && result.success;\n      if (step.validation.expectMemory && !hasMemory) {\n        return { valid: false, message: 'Expected memory to be stored' };\n      }\n    }\n    \n    if (step.validation.expectResult) {\n      if (typeof step.validation.expectResult === 'function') {\n        const valid = step.validation.expectResult(result);\n        if (!valid) {\n          return { valid: false, message: 'Result validation failed' };\n        }\n      } else {\n        const matches = JSON.stringify(result) === JSON.stringify(step.validation.expectResult);\n        if (!matches) {\n          return { valid: false, message: 'Result does not match expected value' };\n        }\n      }\n    }\n    \n    return { valid: true };\n  }\n  \n  private determineFilePath(params: any): string {\n    // Simulate intelligent file path determination based on type and preferences\n    const paths: Record<string, string> = {\n      test: 'test-pasta/',\n      component: 'src/components/',\n      service: 'src/services/',\n      util: 'src/utils/',\n      config: 'config/'\n    };\n    \n    const basePath = paths[params.type] || 'src/';\n    return `${basePath}${params.name}`;\n  }\n  \n  // Get all available scenarios\n  getScenarios(): Array<{ name: string; description: string }> {\n    return Array.from(this.scenarios.entries()).map(([name, def]) => ({\n      name,\n      description: def.description\n    }));\n  }\n  \n  // Add custom scenario\n  addScenario(definition: ScenarioDefinition): void {\n    this.scenarios.set(definition.name, definition);\n    this.logger.info('ScenarioRunner', `Added custom scenario: ${definition.name}`);\n  }\n}"],"version":3}