{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/tools/test-tools.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/mcp/tools/test-tools.ts"],"sourcesContent":["import { MCPTool, MCPContext } from '../server';\nimport { MemoryService } from '../../services/memory';\nimport { LoggingService } from '../../services/logging';\nimport { SearchMonitor } from '../../services/search-monitor';\nimport { TestOrchestrator } from '../../testing/test-orchestrator';\nimport { ObservableDatabase } from '../../testing/observable-database';\nimport { MockClaude } from '../../testing/mock-claude';\nimport { ScenarioRunner } from '../../testing/scenario-runner';\n\nexport class TestTools {\n  private tools: MCPTool[] = [];\n  private testOrchestrator: TestOrchestrator;\n  \n  constructor(\n    private memoryService: MemoryService,\n    private logger: LoggingService\n  ) {\n    this.testOrchestrator = new TestOrchestrator(memoryService, logger);\n    this.registerTools();\n  }\n  \n  private registerTools(): void {\n    this.tools = [\n      {\n        name: 'mcp__test__run_scenario',\n        description: 'Run a predefined test scenario for memory compliance',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            scenario: { \n              type: 'string', \n              description: 'Name of the scenario to run (e.g., \"memory_persistence\", \"search_compliance\", \"rate_limiting\")' \n            },\n            params: { \n              type: 'object', \n              description: 'Optional parameters for the scenario' \n            }\n          },\n          required: ['scenario']\n        },\n        handler: this.handleRunScenario.bind(this)\n      },\n      {\n        name: 'mcp__test__observe_behavior',\n        description: 'Observe and analyze system behavior for a specific action',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            action: { \n              type: 'string', \n              description: 'Action to observe (e.g., \"store_memory\", \"create_file\", \"search\")' \n            },\n            params: { \n              type: 'object', \n              description: 'Parameters for the action' \n            }\n          },\n          required: ['action']\n        },\n        handler: this.handleObserveBehavior.bind(this)\n      },\n      {\n        name: 'mcp__test__validate_fix',\n        description: 'Validate a proposed fix by running relevant tests',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            issueId: { \n              type: 'string', \n              description: 'ID of the issue being fixed' \n            },\n            fixDescription: { \n              type: 'string', \n              description: 'Description of the fix applied' \n            },\n            testScenarios: { \n              type: 'array', \n              description: 'List of scenarios to test',\n              items: { type: 'string' }\n            }\n          },\n          required: ['issueId', 'fixDescription']\n        },\n        handler: this.handleValidateFix.bind(this)\n      },\n      {\n        name: 'mcp__test__get_results',\n        description: 'Get detailed test results and history',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            sessionId: { \n              type: 'string', \n              description: 'Optional session ID to filter results' \n            },\n            limit: { \n              type: 'number', \n              description: 'Maximum number of results to return' \n            }\n          }\n        },\n        handler: this.handleGetResults.bind(this)\n      },\n      {\n        name: 'mcp__test__simulate_claude',\n        description: 'Simulate Claude agent behavior with configurable compliance',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            prompt: { \n              type: 'string', \n              description: 'Prompt to simulate' \n            },\n            complianceLevel: { \n              type: 'number', \n              description: 'Compliance level (0-1) for memory search behavior' \n            },\n            expectedBehavior: { \n              type: 'object', \n              description: 'Expected behavior to validate against' \n            }\n          },\n          required: ['prompt']\n        },\n        handler: this.handleSimulateClaude.bind(this)\n      },\n      {\n        name: 'mcp__test__memory_scenario',\n        description: 'Test memory search compliance with live scenarios',\n        inputSchema: {\n          type: 'object',\n          properties: {\n            storeContent: { \n              type: 'string', \n              description: 'Memory content to store' \n            },\n            testAction: { \n              type: 'string', \n              description: 'Action to test after storing memory' \n            }\n          },\n          required: ['storeContent', 'testAction']\n        },\n        handler: this.handleMemoryScenario.bind(this)\n      }\n    ];\n  }\n  \n  private async handleRunScenario(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { scenario, params = {} } = input;\n      \n      this.logger.info('TestTools', `Running scenario: ${scenario}`, {\n        sessionId: context.sessionId,\n        params\n      });\n      \n      const result = await this.testOrchestrator.runScenario({\n        name: scenario,\n        params,\n        sessionId: context.sessionId\n      });\n      \n      return {\n        scenario,\n        status: result.status,\n        observations: result.observations,\n        insights: result.insights,\n        reproduction: result.reproduction,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to run scenario', error);\n      throw error;\n    }\n  }\n  \n  private async handleObserveBehavior(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { action, params = {} } = input;\n      \n      const observation = await this.testOrchestrator.observeBehavior(\n        action,\n        params,\n        context.sessionId\n      );\n      \n      return {\n        action,\n        observed: observation.observed,\n        databaseChanges: observation.databaseChanges,\n        searchCalls: observation.searchCalls,\n        complianceStatus: observation.complianceStatus,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to observe behavior', error);\n      throw error;\n    }\n  }\n  \n  private async handleValidateFix(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { issueId, fixDescription, testScenarios = [] } = input;\n      \n      const validation = await this.testOrchestrator.validateFix({\n        issueId,\n        fixDescription,\n        testScenarios,\n        sessionId: context.sessionId\n      });\n      \n      return {\n        issueId,\n        fixDescription,\n        validationPassed: validation.passed,\n        testResults: validation.results,\n        confidence: validation.confidence,\n        recommendations: validation.recommendations,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to validate fix', error);\n      throw error;\n    }\n  }\n  \n  private async handleGetResults(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { sessionId, limit = 10 } = input;\n      \n      const results = await this.testOrchestrator.getTestHistory({\n        sessionId: sessionId || context.sessionId,\n        limit\n      });\n      \n      return {\n        results: results.history,\n        summary: results.summary,\n        trends: results.trends,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to get results', error);\n      throw error;\n    }\n  }\n  \n  private async handleSimulateClaude(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { prompt, complianceLevel = 0.5, expectedBehavior } = input;\n      \n      const simulation = await this.testOrchestrator.simulateClaudeInteraction({\n        prompt,\n        complianceLevel,\n        expectedBehavior,\n        sessionId: context.sessionId\n      });\n      \n      return {\n        prompt,\n        toolsSelected: simulation.toolsSelected,\n        executionResults: simulation.executionResults,\n        databaseChanges: simulation.databaseChanges,\n        searchCallsMade: simulation.searchCallsMade,\n        complianceMatched: simulation.complianceMatched,\n        behaviorAsExpected: simulation.behaviorAsExpected,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to simulate Claude', error);\n      throw error;\n    }\n  }\n  \n  private async handleMemoryScenario(input: any, context: MCPContext): Promise<any> {\n    try {\n      const { storeContent, testAction } = input;\n      \n      // Store memory\n      await this.memoryService.store({\n        key: `test_memory_${Date.now()}`,\n        value: { content: storeContent },\n        type: 'test',\n        context: { sessionId: context.sessionId }\n      });\n      \n      // Create observable database to track changes\n      const observer = new ObservableDatabase(this.memoryService);\n      observer.startTracking();\n      \n      // Track search calls\n      const searchMonitor = SearchMonitor.getInstance();\n      const searchesBefore = searchMonitor.getRecentSearches(1).length;\n      \n      // Execute test action\n      let actionResult: any;\n      let actionError: Error | null = null;\n      \n      try {\n        // Parse and execute the test action\n        if (testAction.startsWith('create_file')) {\n          // Simulate file creation\n          actionResult = { action: 'create_file', executed: true };\n        } else if (testAction.startsWith('search')) {\n          // Simulate search\n          const query = testAction.match(/search\\(['\"](.+)['\"]\\)/)?.[1] || 'test';\n          actionResult = await this.memoryService.search(query);\n        } else {\n          actionResult = { action: testAction, executed: true };\n        }\n      } catch (err) {\n        actionError = err as Error;\n      }\n      \n      // Check if search was called\n      const searchesAfter = searchMonitor.getRecentSearches(1).length;\n      const searchCalled = searchesAfter > searchesBefore;\n      \n      // Get database changes\n      const dbChanges = observer.getChanges();\n      observer.stopTracking();\n      \n      // Analyze compliance\n      const issues: string[] = [];\n      if (!searchCalled && testAction.includes('create')) {\n        issues.push('Search not called before file creation');\n      }\n      \n      return {\n        success: searchCalled && !actionError,\n        searchCalled,\n        result: actionResult,\n        error: actionError?.message,\n        databaseChanges: dbChanges,\n        issues,\n        timestamp: new Date().toISOString()\n      };\n      \n    } catch (error) {\n      this.logger.error('TestTools', 'Failed to run memory scenario', error);\n      throw error;\n    }\n  }\n  \n  getTools(): MCPTool[] {\n    return this.tools;\n  }\n}"],"version":3}