{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/tests/integration/intelligent-retrieval.test.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/tests/integration/intelligent-retrieval.test.ts"],"sourcesContent":["import { MemoryEnhancer } from '../../src/services/memory-enhancer';\nimport { MemoryService } from '../../src/services/memory';\nimport { PatternService } from '../../src/services/pattern-service';\nimport { MemoryStorage } from '../../src/memory/storage';\nimport { ConfigService } from '../../src/services/config';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ndescribe('Intelligent Retrieval Integration Tests', () => {\n  let memoryEnhancer: MemoryEnhancer;\n  let memoryService: MemoryService;\n  let testDbPath: string;\n  \n  beforeAll(() => {\n    // Clear any existing singleton instance\n    (MemoryService as any).instance = null;\n    \n    // Setup test database\n    testDbPath = path.join(__dirname, '../fixtures/test-intelligent-retrieval.db');\n    \n    // Create fixtures directory if it doesn't exist\n    const fixturesDir = path.dirname(testDbPath);\n    if (!fs.existsSync(fixturesDir)) {\n      fs.mkdirSync(fixturesDir, { recursive: true });\n    }\n    \n    // Remove existing test database\n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    \n    // Mock config to use test database\n    jest.spyOn(ConfigService.prototype, 'getDatabasePath').mockReturnValue(testDbPath);\n    jest.spyOn(ConfigService.prototype, 'getProjectId').mockReturnValue('test-project');\n    \n    // Initialize services\n    memoryService = MemoryService.getInstance();\n    memoryEnhancer = new MemoryEnhancer();\n    \n    // Populate test data\n    setupTestData();\n  });\n  \n  afterAll(() => {\n    // Cleanup\n    if (memoryService) {\n      memoryService.close();\n    }\n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    jest.restoreAllMocks();\n  });\n  \n  function setupTestData() {\n    // Add test directory preference\n    memoryService.storePreference({\n      pattern: 'test directory',\n      value: 'tests/',\n      description: 'Tests should be saved in tests/ directory'\n    }, {\n      projectId: 'test-project',\n      timestamp: Date.now()\n    });\n    \n    // Add error history\n    memoryService.store({\n      key: 'error_fix_typeof',\n      value: {\n        error: 'TypeError: Cannot read property of undefined',\n        file: 'auth.js',\n        fix: 'Added null check before accessing property',\n        line: 42\n      },\n      type: 'project-knowledge',\n      context: {\n        projectId: 'test-project',\n        filePath: 'auth.js'\n      }\n    });\n    \n    // Add code style preferences\n    memoryService.storePreference({\n      pattern: 'arrow functions',\n      value: 'prefer arrow functions for callbacks',\n      examples: ['setTimeout(() => {}, 100)', 'array.map(x => x * 2)']\n    }, {\n      projectId: 'test-project'\n    });\n    \n    memoryService.storePreference({\n      pattern: 'async/await',\n      value: 'use async/await instead of promises',\n      examples: ['async function fetchData() { await api.get() }']\n    }, {\n      projectId: 'test-project'\n    });\n    \n    // Add API conventions\n    memoryService.store({\n      key: 'api_conventions',\n      value: {\n        pattern: 'RESTful API',\n        baseUrl: '/api/v1',\n        conventions: {\n          endpoints: 'plural nouns (e.g., /users, /products)',\n          methods: 'GET, POST, PUT, DELETE',\n          responses: 'JSON with consistent structure'\n        }\n      },\n      type: 'project-knowledge',\n      context: {\n        projectId: 'test-project'\n      }\n    });\n  }\n  \n  describe('Real-world scenarios', () => {\n    test('Scenario 1: User says \"create a test for auth\" → System retrieves test directory preference', async () => {\n      const prompt = 'create a test for the user service';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should find the test directory preference\n      const testDirMemory = results.find(m => \n        m.value && \n        typeof m.value === 'object' && \n        (m.value.value?.includes('tests/') || \n         m.value.description?.includes('tests/'))\n      );\n      \n      expect(testDirMemory).toBeDefined();\n      expect(testDirMemory?.type).toBe('preference');\n      expect(JSON.stringify(testDirMemory?.value)).toContain('tests/');\n    });\n    \n    test('Scenario 2: User says \"fix TypeError\" → System retrieves previous TypeError fixes', async () => {\n      const prompt = 'fix the undefined error in auth.js';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should find the previous TypeError fix\n      const errorFixMemory = results.find(m => \n        m.key === 'error_fix_typeof' ||\n        (m.value && JSON.stringify(m.value).includes('TypeError'))\n      );\n      \n      expect(errorFixMemory).toBeDefined();\n      expect(errorFixMemory?.type).toBe('project-knowledge');\n      expect(errorFixMemory?.value).toHaveProperty('fix');\n    });\n    \n    test('Scenario 3: User says \"refactor to use async\" → System retrieves async/await preferences', async () => {\n      const prompt = 'refactor this function to use modern syntax';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should find async/await and arrow function preferences\n      const asyncPref = results.find(m => \n        m.value && \n        JSON.stringify(m.value).includes('async/await')\n      );\n      \n      const arrowPref = results.find(m => \n        m.value && \n        JSON.stringify(m.value).includes('arrow functions')\n      );\n      \n      expect(asyncPref).toBeDefined();\n      expect(arrowPref).toBeDefined();\n      expect(asyncPref?.type).toBe('preference');\n      expect(arrowPref?.type).toBe('preference');\n    });\n    \n    test('Scenario 4: User says \"add user endpoint\" → System retrieves API conventions', async () => {\n      const prompt = 'add a new API endpoint for products';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should find API conventions\n      const apiMemory = results.find(m => \n        m.key === 'api_conventions' ||\n        (m.value && JSON.stringify(m.value).includes('RESTful'))\n      );\n      \n      expect(apiMemory).toBeDefined();\n      expect(apiMemory?.type).toBe('project-knowledge');\n      expect(apiMemory?.value).toHaveProperty('baseUrl');\n      expect(apiMemory?.value).toHaveProperty('conventions');\n    });\n  });\n  \n  describe('Pattern detection integration', () => {\n    test('should correctly identify test creation tasks without explicit \"directory\" mention', async () => {\n      const prompts = [\n        'create a test for auth module',\n        'write tests for user service',\n        'add unit test for login function',\n        'make a test case for registration'\n      ];\n      \n      for (const prompt of prompts) {\n        const results = await memoryEnhancer.enhanceSearch(prompt);\n        \n        // Each should retrieve test directory preference\n        const hasTestDirPref = results.some(m => \n          JSON.stringify(m.value).includes('tests/')\n        );\n        \n        expect(hasTestDirPref).toBe(true);\n      }\n    });\n    \n    test('should identify bug fix patterns and retrieve relevant fixes', async () => {\n      // Test specific error types that we have data for\n      const errorPrompt = 'fix TypeError in authentication';\n      const results = await memoryEnhancer.enhanceSearch(errorPrompt);\n      \n      // Should find the TypeError fix we stored\n      const hasTypeErrorFix = results.some(m => \n        m.key === 'error_fix_typeof' ||\n        (m.value && JSON.stringify(m.value).includes('TypeError'))\n      );\n      \n      expect(hasTypeErrorFix).toBe(true);\n      \n      // Test general bug fix patterns\n      const bugPrompts = [\n        'fix undefined error in auth.js',\n        'resolve error in auth.js'\n      ];\n      \n      for (const prompt of bugPrompts) {\n        const bugResults = await memoryEnhancer.enhanceSearch(prompt);\n        \n        // Should find some relevant memory (either the TypeError fix or preferences)\n        const hasRelevantMemory = bugResults.length > 0 && bugResults.some(m => \n          m.type === 'project-knowledge' || \n          m.type === 'preference' ||\n          (m.value && JSON.stringify(m.value).toLowerCase().includes('error'))\n        );\n        \n        expect(hasRelevantMemory).toBe(true);\n      }\n    });\n  });\n  \n  describe('Performance requirements', () => {\n    test('should complete all searches within 100ms', async () => {\n      const prompts = [\n        'create a test for user authentication service',\n        'fix TypeError: Cannot read property length of undefined in utils.js',\n        'refactor dashboard component to use hooks instead of class',\n        'add REST API endpoint for product inventory management'\n      ];\n      \n      for (const prompt of prompts) {\n        const startTime = Date.now();\n        await memoryEnhancer.enhanceSearch(prompt);\n        const endTime = Date.now();\n        \n        expect(endTime - startTime).toBeLessThan(100);\n      }\n    });\n    \n    test('should handle large result sets efficiently', async () => {\n      // Add many memories\n      for (let i = 0; i < 100; i++) {\n        memoryService.store({\n          key: `bulk_test_${i}`,\n          value: { data: `test data ${i}` },\n          type: 'project-knowledge',\n          context: { projectId: 'test-project' }\n        });\n      }\n      \n      const startTime = Date.now();\n      const results = await memoryEnhancer.enhanceSearch('search for test data');\n      const endTime = Date.now();\n      \n      expect(endTime - startTime).toBeLessThan(100);\n      expect(results.length).toBeLessThanOrEqual(10); // Should limit results\n    });\n  });\n  \n  describe('Backwards compatibility', () => {\n    test('should work when pattern detection returns empty results', async () => {\n      const prompt = 'random query without patterns';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should still work and return any direct matches\n      expect(Array.isArray(results)).toBe(true);\n    });\n    \n    test('should preserve existing direct search functionality', async () => {\n      // Store a memory that should be found by direct search\n      memoryService.store({\n        key: 'direct_match_test',\n        value: 'specific test value for direct matching',\n        type: 'project-knowledge',\n        context: { projectId: 'test-project' }\n      });\n      \n      const prompt = 'specific test value for direct matching';\n      const results = await memoryEnhancer.enhanceSearch(prompt);\n      \n      // Should find the direct match\n      const directMatch = results.find(m => m.key === 'direct_match_test');\n      expect(directMatch).toBeDefined();\n    });\n  });\n});"],"version":3}