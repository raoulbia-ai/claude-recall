{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/test-orchestrator.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/testing/test-orchestrator.ts"],"sourcesContent":["import { MemoryService } from '../services/memory';\nimport { LoggingService } from '../services/logging';\nimport { ObservableDatabase } from './observable-database';\nimport { MockClaude } from './mock-claude';\nimport { ScenarioRunner } from './scenario-runner';\nimport { AutoCorrectionEngine } from './auto-correction-engine';\n\nexport interface TestScenario {\n  name: string;\n  params?: any;\n  sessionId?: string;\n}\n\nexport interface TestResult {\n  scenario: string;\n  status: 'passed' | 'failed' | 'partial';\n  observations: {\n    memoriesStored: any[];\n    searchesPerformed: any[];\n    filesCreated: any[];\n    complianceViolations: any[];\n  };\n  insights: {\n    rootCause?: string;\n    suggestedFix?: string;\n    confidenceLevel: number;\n  };\n  reproduction: {\n    steps: string[];\n    environment: any;\n  };\n}\n\nexport interface ObservationResult {\n  observed: any;\n  databaseChanges: any[];\n  searchCalls: any[];\n  complianceStatus: 'compliant' | 'non-compliant' | 'partial';\n}\n\nexport interface ValidationResult {\n  passed: boolean;\n  results: any[];\n  confidence: number;\n  recommendations: string[];\n}\n\nexport interface SimulationResult {\n  toolsSelected: any[];\n  executionResults: any[];\n  databaseChanges: any[];\n  searchCallsMade: any[];\n  complianceMatched: boolean;\n  behaviorAsExpected: boolean;\n}\n\nexport interface TestHistory {\n  history: any[];\n  summary: {\n    totalTests: number;\n    passed: number;\n    failed: number;\n    complianceRate: number;\n  };\n  trends: {\n    improvementRate: number;\n    commonIssues: string[];\n  };\n}\n\nexport class TestOrchestrator {\n  private observableDb: ObservableDatabase;\n  private mockClaude: MockClaude;\n  private scenarioRunner: ScenarioRunner;\n  private autoCorrectionEngine: AutoCorrectionEngine;\n  private testHistory: Map<string, any[]> = new Map();\n  \n  constructor(\n    private memoryService: MemoryService,\n    private logger: LoggingService\n  ) {\n    this.observableDb = new ObservableDatabase(memoryService);\n    this.mockClaude = new MockClaude(memoryService, logger);\n    this.scenarioRunner = new ScenarioRunner(memoryService, logger);\n    this.autoCorrectionEngine = new AutoCorrectionEngine(memoryService, logger);\n  }\n  \n  async runScenario(scenario: TestScenario): Promise<TestResult> {\n    const startTime = Date.now();\n    this.logger.info('TestOrchestrator', `Running scenario: ${scenario.name}`, scenario);\n    \n    // Start tracking database changes\n    this.observableDb.startTracking();\n    \n    try {\n      // Run the scenario\n      const scenarioResult = await this.scenarioRunner.run(scenario.name, scenario.params);\n      \n      // Get observations\n      const dbChanges = this.observableDb.getChanges();\n      this.observableDb.stopTracking();\n      \n      // Analyze results\n      const analysis = this.analyzeResults(scenarioResult, dbChanges);\n      \n      // Build test result\n      const result: TestResult = {\n        scenario: scenario.name,\n        status: analysis.status,\n        observations: {\n          memoriesStored: dbChanges.filter(c => c.operation === 'INSERT'),\n          searchesPerformed: scenarioResult.searches || [],\n          filesCreated: scenarioResult.files || [],\n          complianceViolations: analysis.violations\n        },\n        insights: {\n          rootCause: analysis.rootCause,\n          suggestedFix: analysis.suggestedFix,\n          confidenceLevel: analysis.confidence\n        },\n        reproduction: {\n          steps: scenarioResult.steps || [],\n          environment: {\n            timestamp: startTime,\n            sessionId: scenario.sessionId,\n            duration: Date.now() - startTime\n          }\n        }\n      };\n      \n      // Store in history\n      this.addToHistory(scenario.sessionId || 'default', result);\n      \n      return result;\n      \n    } catch (error) {\n      this.logger.error('TestOrchestrator', 'Scenario execution failed', error);\n      this.observableDb.stopTracking();\n      \n      return {\n        scenario: scenario.name,\n        status: 'failed',\n        observations: {\n          memoriesStored: [],\n          searchesPerformed: [],\n          filesCreated: [],\n          complianceViolations: [{\n            type: 'execution_error',\n            message: (error as Error).message\n          }]\n        },\n        insights: {\n          rootCause: (error as Error).message,\n          suggestedFix: 'Check scenario configuration and system state',\n          confidenceLevel: 0.3\n        },\n        reproduction: {\n          steps: [`Error: ${(error as Error).message}`],\n          environment: {\n            timestamp: startTime,\n            sessionId: scenario.sessionId,\n            duration: Date.now() - startTime\n          }\n        }\n      };\n    }\n  }\n  \n  async observeBehavior(action: string, params: any, sessionId: string): Promise<ObservationResult> {\n    this.logger.info('TestOrchestrator', `Observing behavior: ${action}`, { params, sessionId });\n    \n    // Start observation\n    this.observableDb.startTracking();\n    const searchesBefore = this.getSearchCount();\n    \n    try {\n      // Execute the action\n      let observed: any;\n      \n      switch (action) {\n        case 'store_memory':\n          observed = await this.memoryService.store({\n            key: params.key || `test_${Date.now()}`,\n            value: params.value || { content: 'test' },\n            type: params.type || 'test',\n            context: { sessionId }\n          });\n          break;\n          \n        case 'search':\n          observed = await this.memoryService.search(params.query || 'test');\n          break;\n          \n        case 'create_file':\n          // Simulate file creation\n          observed = { action: 'create_file', path: params.path || 'test.js' };\n          break;\n          \n        default:\n          observed = { action, params };\n      }\n      \n      // Get observations\n      const dbChanges = this.observableDb.getChanges();\n      const searchesAfter = this.getSearchCount();\n      const searchCalls = searchesAfter - searchesBefore;\n      \n      // Determine compliance\n      let complianceStatus: 'compliant' | 'non-compliant' | 'partial' = 'compliant';\n      \n      if (action === 'create_file' && searchCalls === 0) {\n        complianceStatus = 'non-compliant';\n      } else if (action === 'store_memory' && dbChanges.length === 0) {\n        complianceStatus = 'partial';\n      }\n      \n      return {\n        observed,\n        databaseChanges: dbChanges,\n        searchCalls: Array(searchCalls).fill({ action: 'search', timestamp: Date.now() }),\n        complianceStatus\n      };\n      \n    } finally {\n      this.observableDb.stopTracking();\n    }\n  }\n  \n  async validateFix(params: {\n    issueId: string;\n    fixDescription: string;\n    testScenarios: string[];\n    sessionId: string;\n  }): Promise<ValidationResult> {\n    this.logger.info('TestOrchestrator', `Validating fix for issue: ${params.issueId}`, params);\n    \n    const results: any[] = [];\n    let passedCount = 0;\n    \n    // Run test scenarios\n    for (const scenarioName of params.testScenarios) {\n      const result = await this.runScenario({\n        name: scenarioName,\n        sessionId: params.sessionId\n      });\n      \n      results.push({\n        scenario: scenarioName,\n        status: result.status,\n        violations: result.observations.complianceViolations\n      });\n      \n      if (result.status === 'passed') {\n        passedCount++;\n      }\n    }\n    \n    // Calculate confidence\n    const confidence = params.testScenarios.length > 0\n      ? passedCount / params.testScenarios.length\n      : 0;\n    \n    // Generate recommendations\n    const recommendations: string[] = [];\n    \n    if (confidence < 0.5) {\n      recommendations.push('Fix does not adequately address the issue');\n      recommendations.push('Review the implementation and test coverage');\n    } else if (confidence < 0.8) {\n      recommendations.push('Fix partially addresses the issue');\n      recommendations.push('Consider additional edge cases');\n    } else {\n      recommendations.push('Fix appears to be effective');\n      recommendations.push('Monitor for regression in production');\n    }\n    \n    return {\n      passed: confidence >= 0.8,\n      results,\n      confidence,\n      recommendations\n    };\n  }\n  \n  async simulateClaudeInteraction(params: {\n    prompt: string;\n    complianceLevel: number;\n    expectedBehavior?: any;\n    sessionId: string;\n  }): Promise<SimulationResult> {\n    this.logger.info('TestOrchestrator', 'Simulating Claude interaction', params);\n    \n    // Set compliance level\n    this.mockClaude.setComplianceLevel(params.complianceLevel);\n    \n    // Start tracking\n    this.observableDb.startTracking();\n    const searchesBefore = this.getSearchCount();\n    \n    try {\n      // Simulate Claude processing the prompt\n      const interaction = await this.mockClaude.simulateInteraction(params.prompt);\n      \n      // Get observations\n      const dbChanges = this.observableDb.getChanges();\n      const searchesAfter = this.getSearchCount();\n      \n      // Check if behavior matches expectations\n      let behaviorAsExpected = true;\n      if (params.expectedBehavior) {\n        behaviorAsExpected = this.compareBehavior(\n          interaction,\n          params.expectedBehavior\n        );\n      }\n      \n      // Check compliance\n      const searchCallsMade = searchesAfter - searchesBefore;\n      const complianceMatched = searchCallsMade > 0 || !params.prompt.includes('create');\n      \n      return {\n        toolsSelected: interaction.toolsSelected,\n        executionResults: interaction.executionResults,\n        databaseChanges: dbChanges,\n        searchCallsMade: Array(searchCallsMade).fill({ action: 'search' }),\n        complianceMatched,\n        behaviorAsExpected\n      };\n      \n    } finally {\n      this.observableDb.stopTracking();\n    }\n  }\n  \n  async getTestHistory(params: {\n    sessionId?: string;\n    limit?: number;\n  }): Promise<TestHistory> {\n    const sessionId = params.sessionId || 'default';\n    const history = this.testHistory.get(sessionId) || [];\n    const limitedHistory = params.limit ? history.slice(-params.limit) : history;\n    \n    // Calculate summary\n    const totalTests = limitedHistory.length;\n    const passed = limitedHistory.filter(t => t.status === 'passed').length;\n    const failed = limitedHistory.filter(t => t.status === 'failed').length;\n    const complianceRate = totalTests > 0 ? passed / totalTests : 0;\n    \n    // Analyze trends\n    const recentTests = limitedHistory.slice(-10);\n    const recentPassed = recentTests.filter(t => t.status === 'passed').length;\n    const improvementRate = recentTests.length > 0 ? recentPassed / recentTests.length : 0;\n    \n    // Find common issues\n    const issues: Map<string, number> = new Map();\n    for (const test of limitedHistory) {\n      if (test.observations?.complianceViolations) {\n        for (const violation of test.observations.complianceViolations) {\n          const key = violation.type || violation.message;\n          issues.set(key, (issues.get(key) || 0) + 1);\n        }\n      }\n    }\n    \n    const commonIssues = Array.from(issues.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 5)\n      .map(([issue]) => issue);\n    \n    return {\n      history: limitedHistory,\n      summary: {\n        totalTests,\n        passed,\n        failed,\n        complianceRate\n      },\n      trends: {\n        improvementRate,\n        commonIssues\n      }\n    };\n  }\n  \n  private analyzeResults(scenarioResult: any, dbChanges: any[]): any {\n    const violations: any[] = [];\n    let status: 'passed' | 'failed' | 'partial' = 'passed';\n    let rootCause: string | undefined;\n    let suggestedFix: string | undefined;\n    let confidence = 1.0;\n    \n    // Check for search compliance\n    if (scenarioResult.expectedSearches && !scenarioResult.searchPerformed) {\n      violations.push({\n        type: 'missing_search',\n        message: 'Expected search was not performed'\n      });\n      status = 'failed';\n      rootCause = 'Memory search not triggered before action';\n      suggestedFix = 'Ensure search is called in the appropriate hooks or middleware';\n      confidence = 0.8;\n    }\n    \n    // Check for memory persistence\n    if (scenarioResult.expectedMemory && dbChanges.length === 0) {\n      violations.push({\n        type: 'memory_not_stored',\n        message: 'Expected memory was not persisted'\n      });\n      status = status === 'failed' ? 'failed' : 'partial';\n      rootCause = rootCause || 'Memory storage mechanism not functioning';\n      suggestedFix = suggestedFix || 'Check database connection and storage logic';\n      confidence = Math.min(confidence, 0.6);\n    }\n    \n    // Check for rate limiting\n    if (scenarioResult.rateLimitExpected && !scenarioResult.rateLimitTriggered) {\n      violations.push({\n        type: 'rate_limit_bypass',\n        message: 'Rate limiting did not trigger as expected'\n      });\n      status = 'partial';\n      rootCause = rootCause || 'Rate limiter not properly configured';\n      suggestedFix = suggestedFix || 'Review rate limiter thresholds and implementation';\n      confidence = Math.min(confidence, 0.7);\n    }\n    \n    return {\n      status,\n      violations,\n      rootCause,\n      suggestedFix,\n      confidence\n    };\n  }\n  \n  private addToHistory(sessionId: string, result: TestResult): void {\n    if (!this.testHistory.has(sessionId)) {\n      this.testHistory.set(sessionId, []);\n    }\n    \n    const history = this.testHistory.get(sessionId)!;\n    history.push(result);\n    \n    // Keep only last 100 results per session\n    if (history.length > 100) {\n      history.shift();\n    }\n  }\n  \n  private getSearchCount(): number {\n    // In a real implementation, this would query the search monitor\n    // For now, return a mock value\n    return Math.floor(Math.random() * 10);\n  }\n  \n  private compareBehavior(actual: any, expected: any): boolean {\n    // Simple comparison for now\n    // In a real implementation, this would do deep comparison\n    return JSON.stringify(actual.toolsSelected) === JSON.stringify(expected.toolsSelected);\n  }\n}"],"version":3}