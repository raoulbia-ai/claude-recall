{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/services/preference-extractor.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/services/preference-extractor.ts"],"sourcesContent":["import { LoggingService } from './logging';\n\nexport interface ExtractedPreference {\n  key: string;           // e.g., \"test_location\", \"code_style\"\n  value: string;         // e.g., \"tests-arlo\", \"4_spaces\"\n  confidence: number;    // 0.0-1.0 confidence score\n  raw: string;           // Original text\n  isOverride: boolean;   // True if this updates existing preference\n  overrideSignals: string[]; // e.g., [\"moving forward\", \"actually\"]\n}\n\nexport class PreferenceExtractor {\n  private logger = LoggingService.getInstance();\n  \n  private readonly OVERRIDE_SIGNALS = {\n    temporal: [\"moving forward\", \"from now on\", \"going forward\", \"henceforth\"],\n    change: [\"actually\", \"instead\", \"rather than\", \"changed my mind\"],\n    update: [\"update to\", \"replace with\", \"switch to\", \"migrate to\"],\n    revert: [\"go back to\", \"return to\", \"revert to\", \"back to using\"]\n  };\n\n  private readonly PREFERENCE_PATTERNS = {\n    test_location: {\n      triggers: [\"test\", \"tests\", \"test files\", \"testing\", \"spec\", \"specs\"],\n      locationWords: [\"in\", \"to\", \"at\", \"under\", \"within\", \"inside\"],\n      valuePattern: /(?:in|to|at|under|within|inside)\\s+([\\w\\-\\/\\.]+)/i\n    },\n    code_style: {\n      triggers: [\"spaces\", \"tabs\", \"indentation\", \"indent\", \"formatting\", \"style\"],\n      patterns: [\n        { pattern: /(\\d+)\\s*spaces?/i, extract: (m: RegExpMatchArray) => `${m[1]}_spaces` },\n        { pattern: /tabs?/i, extract: () => \"tabs\" },\n        { pattern: /semicolons?/i, extract: () => \"semicolons\" },\n        { pattern: /no\\s*semicolons?/i, extract: () => \"no_semicolons\" },\n        { pattern: /single\\s*quotes?/i, extract: () => \"single_quotes\" },\n        { pattern: /double\\s*quotes?/i, extract: () => \"double_quotes\" }\n      ]\n    },\n    framework_choice: {\n      triggers: [\"use\", \"prefer\", \"framework\", \"library\", \"package\"],\n      frameworks: {\n        http_client: [\"axios\", \"fetch\", \"superagent\", \"got\"],\n        test_framework: [\"jest\", \"vitest\", \"mocha\", \"jasmine\", \"cypress\"],\n        build_tool: [\"webpack\", \"vite\", \"rollup\", \"parcel\"],\n        ui_framework: [\"react\", \"vue\", \"angular\", \"svelte\"]\n      }\n    },\n    file_organization: {\n      triggers: [\"save\", \"store\", \"put\", \"place\", \"create\", \"organize\"],\n      types: [\"config\", \"configs\", \"configuration\", \"assets\", \"images\", \"styles\", \"components\"]\n    }\n  };\n\n  /**\n   * Extract preferences from natural language text\n   */\n  extractPreferences(prompt: string): ExtractedPreference[] {\n    try {\n      const sentences = this.splitIntoSentences(prompt);\n      const preferences: ExtractedPreference[] = [];\n\n      for (const sentence of sentences) {\n        if (this.indicatesPreference(sentence)) {\n          const preference = this.extractPreferenceFromSentence(sentence);\n          if (preference && preference.confidence > 0.6) { // Only high-confidence extractions\n            preferences.push(preference);\n            \n            this.logger.debug('PreferenceExtractor', `Extracted preference: ${preference.key} = ${preference.value}`, {\n              confidence: preference.confidence,\n              isOverride: preference.isOverride,\n              raw: preference.raw\n            });\n          }\n        }\n      }\n\n      return preferences;\n    } catch (error) {\n      this.logger.logServiceError('PreferenceExtractor', 'extractPreferences', error as Error);\n      return [];\n    }\n  }\n\n  /**\n   * Check if sentence indicates a preference\n   */\n  private indicatesPreference(sentence: string): boolean {\n    const lower = sentence.toLowerCase();\n    \n    // Check for preference indicators\n    const preferenceIndicators = [\n      \"prefer\", \"use\", \"save\", \"store\", \"put\", \"place\", \"create\", \"make\",\n      \"should\", \"want\", \"like\", \"love\", \"always\", \"never\", \"from now on\",\n      \"moving forward\", \"going forward\", \"henceforth\"\n    ];\n    \n    return preferenceIndicators.some(indicator => lower.includes(indicator));\n  }\n\n  /**\n   * Extract preference from a single sentence\n   */\n  private extractPreferenceFromSentence(sentence: string): ExtractedPreference | null {\n    const lower = sentence.toLowerCase();\n    \n    // Try each preference pattern\n    for (const [key, pattern] of Object.entries(this.PREFERENCE_PATTERNS)) {\n      const preference = this.extractSpecificPreference(sentence, key, pattern);\n      if (preference) {\n        return preference;\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Extract specific preference type from sentence\n   */\n  private extractSpecificPreference(sentence: string, key: string, pattern: any): ExtractedPreference | null {\n    const lower = sentence.toLowerCase();\n    \n    // Check if sentence contains triggers for this preference type\n    const hasTrigger = pattern.triggers.some((trigger: string) => lower.includes(trigger));\n    if (!hasTrigger) return null;\n    \n    let value: string | null = null;\n    let confidence = 0.7; // Base confidence\n    \n    switch (key) {\n      case 'test_location':\n        value = this.extractTestLocation(sentence, pattern);\n        break;\n      case 'code_style':\n        value = this.extractCodeStyle(sentence, pattern);\n        break;\n      case 'framework_choice':\n        value = this.extractFrameworkChoice(sentence, pattern);\n        break;\n      case 'file_organization':\n        value = this.extractFileOrganization(sentence, pattern);\n        break;\n    }\n    \n    if (!value) return null;\n    \n    // Detect override intent\n    const overrideSignals = this.detectOverrideSignals(sentence);\n    const isOverride = overrideSignals.length > 0;\n    \n    // Boost confidence for explicit preferences\n    if (lower.includes(\"prefer\") || lower.includes(\"always\") || lower.includes(\"never\")) {\n      confidence += 0.2;\n    }\n    \n    // Boost confidence for override signals\n    if (isOverride) {\n      confidence += 0.1;\n    }\n    \n    // Boost confidence for specific patterns\n    if (lower.includes(\"from now on\") || lower.includes(\"moving forward\")) {\n      confidence += 0.15;\n    }\n    \n    return {\n      key: this.getPreferenceKey(key, value, sentence),\n      value,\n      confidence: Math.min(confidence, 1.0),\n      raw: sentence.trim(),\n      isOverride,\n      overrideSignals\n    };\n  }\n\n  /**\n   * Extract test location from sentence\n   */\n  private extractTestLocation(sentence: string, pattern: any): string | null {\n    const match = sentence.match(pattern.valuePattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n    \n    // Fallback: look for directory-like words after location words\n    const words = sentence.split(/\\s+/);\n    for (let i = 0; i < words.length - 1; i++) {\n      if (pattern.locationWords.some((locWord: string) => words[i].toLowerCase() === locWord)) {\n        const nextWord = words[i + 1];\n        if (nextWord && /^[\\w\\-\\/\\.]+$/.test(nextWord)) {\n          return nextWord;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Extract code style preferences\n   */\n  private extractCodeStyle(sentence: string, pattern: any): string | null {\n    for (const stylePattern of pattern.patterns) {\n      const match = sentence.match(stylePattern.pattern);\n      if (match) {\n        return stylePattern.extract(match);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Extract framework choice preferences\n   */\n  private extractFrameworkChoice(sentence: string, pattern: any): string | null {\n    const lower = sentence.toLowerCase();\n    \n    for (const [category, frameworks] of Object.entries(pattern.frameworks)) {\n      for (const framework of frameworks as string[]) {\n        if (lower.includes(framework)) {\n          return framework;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Extract file organization preferences\n   */\n  private extractFileOrganization(sentence: string, pattern: any): string | null {\n    const lower = sentence.toLowerCase();\n    \n    // Look for file type + location pattern\n    for (const type of pattern.types) {\n      if (lower.includes(type)) {\n        const locationMatch = sentence.match(new RegExp(`${type}.*?(?:in|to|at|under)\\\\s+([\\\\w\\\\-\\\\/\\\\.]+)`, 'i'));\n        if (locationMatch && locationMatch[1]) {\n          return `${type}:${locationMatch[1]}`;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Get the appropriate preference key based on the detected pattern\n   */\n  private getPreferenceKey(key: string, value: string, sentence: string): string {\n    if (key === 'framework_choice') {\n      return this.getFrameworkKey(value);\n    } else if (key === 'code_style') {\n      // Map code_style to more specific keys\n      const lower = sentence.toLowerCase();\n      if (lower.includes('indent') || lower.includes('spaces') || lower.includes('tabs')) {\n        return 'indentation';\n      } else if (lower.includes('quote')) {\n        return 'quotes';\n      } else if (lower.includes('semicolon')) {\n        return 'semicolons';\n      }\n    }\n    \n    return key;\n  }\n\n  /**\n   * Get the appropriate framework key based on detected framework\n   */\n  private getFrameworkKey(framework: string): string {\n    const frameworkMappings: Record<string, string> = {\n      'axios': 'http_client',\n      'fetch': 'http_client',\n      'superagent': 'http_client',\n      'got': 'http_client',\n      'jest': 'test_framework',\n      'vitest': 'test_framework',\n      'mocha': 'test_framework',\n      'jasmine': 'test_framework',\n      'cypress': 'test_framework',\n      'webpack': 'build_tool',\n      'vite': 'build_tool',\n      'rollup': 'build_tool',\n      'parcel': 'build_tool',\n      'react': 'ui_framework',\n      'vue': 'ui_framework',\n      'angular': 'ui_framework',\n      'svelte': 'ui_framework'\n    };\n    \n    return frameworkMappings[framework] || 'framework_choice';\n  }\n\n  /**\n   * Detect override signals in sentence\n   */\n  private detectOverrideSignals(sentence: string): string[] {\n    const lower = sentence.toLowerCase();\n    const signals: string[] = [];\n    \n    for (const [category, signalList] of Object.entries(this.OVERRIDE_SIGNALS)) {\n      for (const signal of signalList) {\n        if (lower.includes(signal.toLowerCase())) {\n          signals.push(signal);\n        }\n      }\n    }\n    \n    return signals;\n  }\n\n  /**\n   * Split text into sentences for processing\n   */\n  private splitIntoSentences(text: string): string[] {\n    // Enhanced sentence splitting that handles common patterns\n    return text.split(/[.!?]+|(?:\\n\\s*\\n)/)\n               .map(s => s.trim())\n               .filter(s => s.length > 10) // Filter out very short fragments\n               .map(s => s.replace(/\\s+/g, ' ')); // Normalize whitespace\n  }\n}"],"version":3}