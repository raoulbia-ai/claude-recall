{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/services/search-monitor.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/services/search-monitor.ts"],"sourcesContent":["import { LoggingService } from './logging';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as os from 'os';\n\nexport interface SearchCall {\n  timestamp: number;\n  query: string;\n  resultCount: number;\n  sessionId: string;\n  source: 'mcp' | 'cli' | 'direct';\n  context?: any;\n}\n\nexport class SearchMonitor {\n  private static instance: SearchMonitor;\n  private logger: LoggingService;\n  private searchCalls: SearchCall[] = [];\n  private monitoringEnabled: boolean = true;\n  private logPath: string;\n\n  private constructor() {\n    this.logger = LoggingService.getInstance();\n    this.logPath = path.join(os.homedir(), '.claude-recall', 'search-monitor.log');\n    this.ensureLogDirectory();\n  }\n\n  static getInstance(): SearchMonitor {\n    if (!SearchMonitor.instance) {\n      SearchMonitor.instance = new SearchMonitor();\n    }\n    return SearchMonitor.instance;\n  }\n\n  private ensureLogDirectory(): void {\n    const dir = path.dirname(this.logPath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n  }\n\n  recordSearch(query: string, resultCount: number, sessionId: string, source: 'mcp' | 'cli' | 'direct', context?: any): void {\n    if (!this.monitoringEnabled) return;\n\n    const searchCall: SearchCall = {\n      timestamp: Date.now(),\n      query,\n      resultCount,\n      sessionId,\n      source,\n      context\n    };\n\n    this.searchCalls.push(searchCall);\n\n    // Log to file for persistence\n    this.logToFile(searchCall);\n\n    // Log to console in development\n    this.logger.info('SearchMonitor', 'Memory search performed', {\n      query: query.substring(0, 50) + (query.length > 50 ? '...' : ''),\n      results: resultCount,\n      source,\n      sessionId\n    });\n  }\n\n  private logToFile(searchCall: SearchCall): void {\n    try {\n      const logEntry = JSON.stringify({\n        ...searchCall,\n        datetime: new Date(searchCall.timestamp).toISOString()\n      }) + '\\n';\n\n      fs.appendFileSync(this.logPath, logEntry, 'utf8');\n    } catch (error) {\n      this.logger.error('SearchMonitor', 'Failed to write to log file', error);\n    }\n  }\n\n  getRecentSearches(limit: number = 100): SearchCall[] {\n    return this.searchCalls.slice(-limit);\n  }\n\n  getSearchStats(): {\n    totalSearches: number;\n    searchesBySource: Record<string, number>;\n    averageResultCount: number;\n    lastSearchTime?: Date;\n  } {\n    const stats = {\n      totalSearches: this.searchCalls.length,\n      searchesBySource: {} as Record<string, number>,\n      averageResultCount: 0,\n      lastSearchTime: undefined as Date | undefined\n    };\n\n    if (this.searchCalls.length > 0) {\n      let totalResults = 0;\n      \n      for (const call of this.searchCalls) {\n        stats.searchesBySource[call.source] = (stats.searchesBySource[call.source] || 0) + 1;\n        totalResults += call.resultCount;\n      }\n\n      stats.averageResultCount = totalResults / this.searchCalls.length;\n      stats.lastSearchTime = new Date(this.searchCalls[this.searchCalls.length - 1].timestamp);\n    }\n\n    return stats;\n  }\n\n  checkCompliance(timeWindowMs: number = 300000): { // 5 minutes\n    compliant: boolean;\n    details: {\n      totalActions: number;\n      searchesPerformed: number;\n      complianceRate: number;\n      issues: string[];\n    };\n  } {\n    const now = Date.now();\n    const recentSearches = this.searchCalls.filter(s => s.timestamp > now - timeWindowMs);\n\n    // This is a simplified check - in reality, we'd need to correlate with actual file operations\n    const expectedSearchRate = 0.8; // Expect 80% of actions to have a search\n    const actualRate = recentSearches.length > 0 ? 1.0 : 0.0;\n\n    const issues: string[] = [];\n    if (actualRate < expectedSearchRate) {\n      issues.push(`Search rate (${(actualRate * 100).toFixed(0)}%) below expected ${(expectedSearchRate * 100).toFixed(0)}%`);\n    }\n\n    return {\n      compliant: actualRate >= expectedSearchRate,\n      details: {\n        totalActions: recentSearches.length,\n        searchesPerformed: recentSearches.length,\n        complianceRate: actualRate,\n        issues\n      }\n    };\n  }\n\n  clearLogs(): void {\n    this.searchCalls = [];\n    try {\n      if (fs.existsSync(this.logPath)) {\n        fs.unlinkSync(this.logPath);\n      }\n    } catch (error) {\n      this.logger.error('SearchMonitor', 'Failed to clear log file', error);\n    }\n  }\n\n  setMonitoringEnabled(enabled: boolean): void {\n    this.monitoringEnabled = enabled;\n    this.logger.info('SearchMonitor', `Monitoring ${enabled ? 'enabled' : 'disabled'}`);\n  }\n}"],"version":3}