{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/conversation-context-manager.test.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/tests/unit/conversation-context-manager.test.ts"],"sourcesContent":["/**\n * Tests for ConversationContextManager\n * Phase 4: Duplicate detection and conversation context tracking\n */\n\nimport { ConversationContextManager } from '../../src/services/conversation-context-manager';\n\ndescribe('ConversationContextManager', () => {\n  let manager: ConversationContextManager;\n\n  beforeEach(() => {\n    manager = ConversationContextManager.getInstance();\n    // Clear any existing data\n    const stats = manager.getStats();\n    if (stats.activeSessions > 0) {\n      // Manually clean up if needed (cleanup method is available)\n      manager.cleanup();\n    }\n  });\n\n  afterEach(() => {\n    // Cleanup after each test\n    manager.cleanup();\n  });\n\n  describe('recordAction', () => {\n    it('should record an action successfully', () => {\n      const sessionId = 'test-session-1';\n      const action = 'analyze_preferences';\n      const input = { query: 'test' };\n      const result = { preferences: [] };\n\n      manager.recordAction(sessionId, action, input, result);\n\n      const recentActions = manager.getRecentActions(sessionId);\n      expect(recentActions).toHaveLength(1);\n      expect(recentActions[0].action).toBe(action);\n      expect(recentActions[0].sessionId).toBe(sessionId);\n    });\n\n    it('should maintain action order (most recent first)', () => {\n      const sessionId = 'test-session-2';\n\n      manager.recordAction(sessionId, 'action1', {}, { result: 1 });\n      manager.recordAction(sessionId, 'action2', {}, { result: 2 });\n      manager.recordAction(sessionId, 'action3', {}, { result: 3 });\n\n      const recentActions = manager.getRecentActions(sessionId);\n      expect(recentActions[0].action).toBe('action3'); // Most recent\n      expect(recentActions[1].action).toBe('action2');\n      expect(recentActions[2].action).toBe('action1');\n    });\n\n    it('should limit actions per session to prevent memory bloat', () => {\n      const sessionId = 'test-session-3';\n\n      // Record more than MAX_ACTIONS_PER_SESSION (50)\n      for (let i = 0; i < 60; i++) {\n        manager.recordAction(sessionId, `action${i}`, {}, { result: i });\n      }\n\n      const allActions = manager.getRecentActions(sessionId, 100);\n      expect(allActions.length).toBeLessThanOrEqual(50);\n    });\n  });\n\n  describe('checkForDuplicate', () => {\n    it('should detect duplicate with identical action and input', () => {\n      const sessionId = 'test-session-4';\n      const action = 'analyze_preferences';\n      const input = { conversation: 'Can you analyze our conversation for preferences?' };\n\n      // First call - record it\n      manager.recordAction(sessionId, action, input, { preferences: [] });\n\n      // Second call - should detect duplicate\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input);\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n      expect(duplicateCheck.previousAction).toBeDefined();\n      expect(duplicateCheck.suggestion).toBeDefined();\n      expect(duplicateCheck.turnsSince).toBeDefined();\n    });\n\n    it('should NOT detect duplicate with different action', () => {\n      const sessionId = 'test-session-5';\n      const input = { query: 'test' };\n\n      manager.recordAction(sessionId, 'action1', input, {});\n\n      const duplicateCheck = manager.checkForDuplicate(sessionId, 'action2', input);\n\n      expect(duplicateCheck.isDuplicate).toBe(false);\n    });\n\n    it('should NOT detect duplicate with different input', () => {\n      const sessionId = 'test-session-6';\n      const action = 'search_memories';\n\n      manager.recordAction(sessionId, action, { query: 'first query' }, {});\n\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, { query: 'different query' });\n\n      expect(duplicateCheck.isDuplicate).toBe(false);\n    });\n\n    it('should NOT detect duplicate if outside detection window', () => {\n      const sessionId = 'test-session-7';\n      const action = 'test_action';\n      const input = { data: 'test' };\n\n      // Record 4 actions to move the first one outside the window (window = 3)\n      manager.recordAction(sessionId, action, input, {});\n      manager.recordAction(sessionId, 'other1', {}, {});\n      manager.recordAction(sessionId, 'other2', {}, {});\n      manager.recordAction(sessionId, 'other3', {}, {});\n\n      // Now check for duplicate - should not find it (outside window)\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input);\n\n      expect(duplicateCheck.isDuplicate).toBe(false);\n    });\n\n    it('should provide helpful suggestion when duplicate detected', () => {\n      const sessionId = 'test-session-8';\n      const action = 'analyze_preferences';\n      const input = { conversation: 'test' };\n\n      manager.recordAction(sessionId, action, input, { preferences: [] });\n\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input);\n\n      expect(duplicateCheck.suggestion).toContain('performed this action');\n      expect(duplicateCheck.suggestion).toContain('analyze');\n    });\n  });\n\n  describe('getRecentActions', () => {\n    it('should return empty array for non-existent session', () => {\n      const actions = manager.getRecentActions('non-existent-session');\n      expect(actions).toEqual([]);\n    });\n\n    it('should respect limit parameter', () => {\n      const sessionId = 'test-session-9';\n\n      for (let i = 0; i < 20; i++) {\n        manager.recordAction(sessionId, `action${i}`, {}, {});\n      }\n\n      const actions = manager.getRecentActions(sessionId, 5);\n      expect(actions).toHaveLength(5);\n    });\n  });\n\n  describe('getRecentResult', () => {\n    it('should return most recent result for given action', () => {\n      const sessionId = 'test-session-10';\n      const action = 'test_action';\n\n      manager.recordAction(sessionId, action, {}, { value: 1 });\n      manager.recordAction(sessionId, 'other_action', {}, { value: 99 });\n      manager.recordAction(sessionId, action, {}, { value: 2 });\n\n      const result = manager.getRecentResult(sessionId, action);\n      expect(result).toEqual({ value: 2 }); // Most recent\n    });\n\n    it('should return null if action not found', () => {\n      const sessionId = 'test-session-11';\n\n      const result = manager.getRecentResult(sessionId, 'non_existent_action');\n      expect(result).toBeNull();\n    });\n  });\n\n  describe('clearSession', () => {\n    it('should clear all data for a session', () => {\n      const sessionId = 'test-session-12';\n\n      manager.recordAction(sessionId, 'action1', {}, {});\n      manager.recordAction(sessionId, 'action2', {}, {});\n\n      expect(manager.getRecentActions(sessionId)).toHaveLength(2);\n\n      manager.clearSession(sessionId);\n\n      expect(manager.getRecentActions(sessionId)).toHaveLength(0);\n    });\n  });\n\n  describe('cleanup', () => {\n    it('should remove timed-out sessions', async () => {\n      const sessionId = 'test-session-13';\n\n      manager.recordAction(sessionId, 'action1', {}, {});\n\n      const statsBefore = manager.getStats();\n      expect(statsBefore.activeSessions).toBeGreaterThan(0);\n\n      // Wait for session to timeout (this would take 30 minutes in production)\n      // For testing, we'll just call cleanup and verify it works\n      manager.cleanup();\n\n      // In a real test, we'd mock the timestamp to simulate timeout\n      // For now, just verify cleanup doesn't error\n      const statsAfter = manager.getStats();\n      expect(statsAfter.activeSessions).toBeGreaterThanOrEqual(0);\n    });\n  });\n\n  describe('getStats', () => {\n    it('should return correct statistics', () => {\n      const session1 = 'test-session-14';\n      const session2 = 'test-session-15';\n\n      manager.recordAction(session1, 'action1', {}, {});\n      manager.recordAction(session1, 'action2', {}, {});\n      manager.recordAction(session2, 'action3', {}, {});\n\n      const stats = manager.getStats();\n\n      expect(stats.activeSessions).toBe(2);\n      expect(stats.totalActions).toBe(3);\n      expect(stats.averageActionsPerSession).toBe(1.5);\n    });\n  });\n\n  describe('Edge cases', () => {\n    it('should handle string input normalization', () => {\n      const sessionId = 'test-session-16';\n      const action = 'test_action';\n\n      // Record with extra whitespace\n      manager.recordAction(sessionId, action, '  Test   String  ', {});\n\n      // Check with normalized string\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, 'Test String');\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n    });\n\n    it('should handle case-insensitive action matching', () => {\n      const sessionId = 'test-session-17';\n\n      manager.recordAction(sessionId, 'ANALYZE_PREFERENCES', { query: 'test' }, {});\n\n      const duplicateCheck = manager.checkForDuplicate(sessionId, 'analyze_preferences', { query: 'test' });\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n    });\n\n    it('should handle object input with relevant fields', () => {\n      const sessionId = 'test-session-18';\n      const action = 'search';\n\n      const input1 = { query: 'test query', irrelevant: 'data' };\n      const input2 = { query: 'test query', differentIrrelevant: 'data' };\n\n      manager.recordAction(sessionId, action, input1, {});\n\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input2);\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n    });\n  });\n\n  describe('Real-world scenario: Duplicate question detection', () => {\n    it('should detect when user asks same question twice in a row', () => {\n      const sessionId = 'user-session-1';\n      const action = 'mcp__claude-recall__store_preferences';\n      const input = {\n        conversation: 'Can you analyze our conversation for preferences?'\n      };\n      const result = {\n        stored: true,\n        preferences: [\n          { key: 'testing_framework', value: 'jest' }\n        ]\n      };\n\n      // User asks first time\n      manager.recordAction(sessionId, action, input, result);\n\n      // User asks same question immediately\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input);\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n      expect(duplicateCheck.turnsSince).toBe(0);\n      expect(duplicateCheck.suggestion).toContain('just performed');\n      expect(duplicateCheck.previousAction?.result).toEqual(result);\n    });\n\n    it('should handle multiple different actions between duplicates', () => {\n      const sessionId = 'user-session-2';\n      const action = 'analyze';\n      const input = { query: 'analyze this' };\n\n      // First action\n      manager.recordAction(sessionId, action, input, { result: 'first' });\n\n      // Different actions in between\n      manager.recordAction(sessionId, 'other1', {}, {});\n      manager.recordAction(sessionId, 'other2', {}, {});\n\n      // Duplicate within window\n      const duplicateCheck = manager.checkForDuplicate(sessionId, action, input);\n\n      expect(duplicateCheck.isDuplicate).toBe(true);\n      expect(duplicateCheck.turnsSince).toBe(2);\n      expect(duplicateCheck.suggestion).toContain('2 turns ago');\n    });\n  });\n});\n"],"version":3}