{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/src/services/failure-extractor.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/src/services/failure-extractor.ts"],"sourcesContent":["import { Memory, StructuredMemoryValue } from '../memory/storage';\nimport { LoggingService } from './logging';\n\n/**\n * Structured failure memory value (v0.7.0+)\n * Based on ReasoningBank's counterfactual reasoning approach\n */\nexport interface FailureMemoryContent {\n  what_failed: string;  // What action/approach failed\n  why_failed: string;   // Root cause analysis\n  what_should_do: string;  // Counterfactual - what should have been done instead\n  context: string;  // Situation where failure occurred\n  preventative_checks: string[];  // Checks to prevent recurrence\n  alternative_approaches?: string[];  // Other potential solutions\n}\n\nexport interface TaskContext {\n  query?: string;\n  project_id?: string;\n  file_path?: string;\n  timestamp?: number;\n}\n\n/**\n * FailureExtractor Service (v0.7.0)\n *\n * Extracts failure memories with counterfactual reasoning from:\n * 1. Error objects + context\n * 2. User corrections (\"That didn't work\", \"Failed\")\n *\n * Inspired by ReasoningBank's approach to learning from failures\n */\nexport class FailureExtractor {\n  private static instance: FailureExtractor;\n  private logger: LoggingService;\n\n  private constructor() {\n    this.logger = LoggingService.getInstance();\n  }\n\n  static getInstance(): FailureExtractor {\n    if (!FailureExtractor.instance) {\n      FailureExtractor.instance = new FailureExtractor();\n    }\n    return FailureExtractor.instance;\n  }\n\n  /**\n   * Extract failure memory from error + context\n   */\n  extractFromError(\n    error: Error,\n    context: TaskContext,\n    attemptedAction: string\n  ): Memory | null {\n    try {\n      const whatFailed = this.extractWhatFailed(error, attemptedAction);\n      const whyFailed = this.inferWhyFailed(error, context);\n      const whatShouldDo = this.suggestAlternative(error, context);\n\n      if (!whatFailed || !whyFailed) {\n        this.logger.debug('FailureExtractor', 'Insufficient data to extract failure', {\n          error: error.message,\n          action: attemptedAction\n        });\n        return null;\n      }\n\n      const content: FailureMemoryContent = {\n        what_failed: whatFailed,\n        why_failed: whyFailed,\n        what_should_do: whatShouldDo || 'Review error details and adjust approach',\n        context: context.query || attemptedAction || 'Unknown context',\n        preventative_checks: this.generateChecks(whatFailed, whyFailed),\n        alternative_approaches: this.suggestAlternatives(error, context)\n      };\n\n      const value: StructuredMemoryValue = {\n        title: `Avoid: ${this.truncate(whatFailed, 50)}`,\n        description: this.truncate(whyFailed, 100),\n        content\n      };\n\n      return {\n        key: this.generateFailureKey(whatFailed, context),\n        value,\n        type: 'failure',\n        project_id: context.project_id,\n        file_path: context.file_path,\n        confidence_score: 0.75,\n        timestamp: context.timestamp || Date.now(),\n        sophistication_level: 2  // Self-reflection level\n      };\n    } catch (err) {\n      this.logger.error('FailureExtractor', 'Failed to extract failure memory', err);\n      return null;\n    }\n  }\n\n  /**\n   * Extract failure memory from user correction\n   */\n  extractFromUserCorrection(\n    userMessage: string,\n    priorAction: string,\n    context: TaskContext\n  ): Memory | null {\n    try {\n      // Check if message indicates failure\n      if (!this.isFailureIndicator(userMessage)) {\n        return null;\n      }\n\n      const whatFailed = priorAction || 'Previous approach';\n      const whyFailed = this.parseUserReason(userMessage) || 'User reported failure';\n      const whatShouldDo = this.parseUserSolution(userMessage) || 'See user correction';\n\n      const content: FailureMemoryContent = {\n        what_failed: whatFailed,\n        why_failed: whyFailed,\n        what_should_do: whatShouldDo,\n        context: context.query || userMessage,\n        preventative_checks: []\n      };\n\n      const value: StructuredMemoryValue = {\n        title: `User Correction: ${this.truncate(whatFailed, 50)}`,\n        description: `User reported: ${this.truncate(whyFailed, 80)}`,\n        content\n      };\n\n      return {\n        key: this.generateFailureKey(whatFailed, context),\n        value,\n        type: 'failure',\n        project_id: context.project_id,\n        confidence_score: 0.9,  // High confidence from user feedback\n        timestamp: context.timestamp || Date.now(),\n        sophistication_level: 2\n      };\n    } catch (err) {\n      this.logger.error('FailureExtractor', 'Failed to extract user correction', err);\n      return null;\n    }\n  }\n\n  /**\n   * Extract what failed from error and action\n   */\n  private extractWhatFailed(error: Error, action: string): string {\n    // Try to parse action for specific operation\n    if (action) {\n      // Clean up action description\n      const cleanAction = action.replace(/^(tried to|attempting to|failed to)\\s+/i, '');\n      return cleanAction;\n    }\n\n    // Fall back to error message\n    return error.message || 'Unknown operation';\n  }\n\n  /**\n   * Infer why failure occurred based on error type\n   */\n  private inferWhyFailed(error: Error, context: TaskContext): string {\n    const message = error.message.toLowerCase();\n\n    // File system errors\n    if (message.includes('enoent') || message.includes('no such file')) {\n      return 'File does not exist at expected location';\n    }\n    if (message.includes('eacces') || message.includes('permission denied')) {\n      return 'Permission denied - insufficient file access rights';\n    }\n    if (message.includes('eexist') || message.includes('already exists')) {\n      return 'File or directory already exists at target location';\n    }\n\n    // Network/API errors\n    if (message.includes('econnrefused') || message.includes('connection refused')) {\n      return 'Connection refused - service may not be running';\n    }\n    if (message.includes('timeout') || message.includes('etimedout')) {\n      return 'Operation timed out - service may be slow or unresponsive';\n    }\n    if (message.includes('404') || message.includes('not found')) {\n      return 'Resource not found at specified endpoint';\n    }\n\n    // Code execution errors\n    if (message.includes('syntaxerror')) {\n      return 'Syntax error in code - invalid JavaScript/TypeScript syntax';\n    }\n    if (message.includes('referenceerror')) {\n      return 'Reference error - variable or function not defined';\n    }\n    if (message.includes('typeerror')) {\n      return 'Type error - unexpected type or undefined value';\n    }\n\n    // Generic fallback\n    if (error.stack) {\n      // Try to extract meaningful info from stack trace\n      const firstLine = error.stack.split('\\n')[0];\n      return firstLine || error.message;\n    }\n\n    return error.message;\n  }\n\n  /**\n   * Suggest counterfactual - what should have been done\n   */\n  private suggestAlternative(error: Error, context: TaskContext): string {\n    const message = error.message.toLowerCase();\n\n    // File system alternatives\n    if (message.includes('enoent')) {\n      return 'Verify file path exists before reading. Use fs.existsSync() or similar check.';\n    }\n    if (message.includes('eacces')) {\n      return 'Check file permissions or run with appropriate user privileges.';\n    }\n    if (message.includes('eexist')) {\n      return 'Check if file exists before creating, or use overwrite mode if intentional.';\n    }\n\n    // Network alternatives\n    if (message.includes('econnrefused')) {\n      return 'Verify service is running and accessible. Check host/port configuration.';\n    }\n    if (message.includes('timeout')) {\n      return 'Increase timeout value or optimize service performance. Add retry logic.';\n    }\n\n    // Code alternatives\n    if (message.includes('syntaxerror')) {\n      return 'Review code syntax carefully. Run linter to identify issues.';\n    }\n    if (message.includes('referenceerror')) {\n      return 'Ensure variable/function is defined before use. Check imports and scope.';\n    }\n    if (message.includes('typeerror')) {\n      return 'Add null/undefined checks before accessing properties. Use optional chaining.';\n    }\n\n    return 'Review error message and documentation for correct usage.';\n  }\n\n  /**\n   * Suggest multiple alternative approaches\n   */\n  private suggestAlternatives(error: Error, context: TaskContext): string[] {\n    const message = error.message.toLowerCase();\n    const alternatives: string[] = [];\n\n    if (message.includes('enoent')) {\n      alternatives.push('Use try-catch with fs.existsSync() before file operations');\n      alternatives.push('Provide default file path or create file if missing');\n      alternatives.push('Use absolute paths instead of relative paths');\n    }\n\n    if (message.includes('timeout')) {\n      alternatives.push('Implement exponential backoff retry strategy');\n      alternatives.push('Increase timeout threshold');\n      alternatives.push('Add circuit breaker pattern for failing services');\n    }\n\n    return alternatives;\n  }\n\n  /**\n   * Generate preventative checks\n   */\n  private generateChecks(whatFailed: string, whyFailed: string): string[] {\n    const checks: string[] = [];\n    const combined = `${whatFailed} ${whyFailed}`.toLowerCase();\n\n    if (combined.includes('file') && combined.includes('not exist')) {\n      checks.push('Verify file exists before reading (fs.existsSync)');\n      checks.push('Handle ENOENT errors gracefully');\n    }\n\n    if (combined.includes('permission')) {\n      checks.push('Check file/directory permissions before access');\n      checks.push('Verify user has necessary access rights');\n    }\n\n    if (combined.includes('timeout') || combined.includes('connection')) {\n      checks.push('Add timeout handling to network requests');\n      checks.push('Implement retry logic for transient failures');\n    }\n\n    if (combined.includes('syntax') || combined.includes('type')) {\n      checks.push('Run linter/type checker before execution');\n      checks.push('Add unit tests to catch errors early');\n    }\n\n    if (combined.includes('null') || combined.includes('undefined')) {\n      checks.push('Add null/undefined checks before property access');\n      checks.push('Use optional chaining (?.) operator');\n    }\n\n    return checks;\n  }\n\n  /**\n   * Generate unique failure key\n   */\n  private generateFailureKey(whatFailed: string, context: TaskContext): string {\n    // Sanitize and truncate\n    const sanitized = whatFailed\n      .toLowerCase()\n      .replace(/[^a-z0-9\\s]/g, '')\n      .replace(/\\s+/g, '_')\n      .substring(0, 50);\n\n    const projectSuffix = context.project_id ? `_${context.project_id}` : '_global';\n    const timestamp = Date.now();\n\n    return `failure_${sanitized}_${timestamp}${projectSuffix}`;\n  }\n\n  /**\n   * Check if user message indicates failure\n   */\n  private isFailureIndicator(message: string): boolean {\n    const lower = message.toLowerCase();\n    const indicators = [\n      \"didn't work\",\n      \"did not work\",\n      'failed',\n      'error',\n      'wrong',\n      'incorrect',\n      'broken',\n      'not working',\n      \"doesn't work\",\n      'problem with',\n      'issue with'\n    ];\n\n    return indicators.some(ind => lower.includes(ind));\n  }\n\n  /**\n   * Parse user's reason for failure from message\n   */\n  private parseUserReason(message: string): string | null {\n    // Look for \"because X\" pattern\n    let match = message.match(/because\\s+(.+?)(\\.|$)/i);\n    if (match) return match[1].trim();\n\n    // Look for \"due to X\" pattern\n    match = message.match(/due to\\s+(.+?)(\\.|$)/i);\n    if (match) return match[1].trim();\n\n    // Look for explanation after failure indicator\n    match = message.match(/(?:failed|error|wrong|broken)\\s*[:-]\\s*(.+?)(\\.|$)/i);\n    if (match) return match[1].trim();\n\n    return null;\n  }\n\n  /**\n   * Parse user's solution from correction message\n   */\n  private parseUserSolution(message: string): string | null {\n    // Look for \"use X instead\" pattern\n    let match = message.match(/use\\s+(.+?)\\s+instead/i);\n    if (match) return match[1].trim();\n\n    // Look for \"should X\" pattern\n    match = message.match(/should\\s+(.+?)(\\.|$)/i);\n    if (match) return match[1].trim();\n\n    // Look for \"try X\" pattern\n    match = message.match(/try\\s+(.+?)(\\.|$)/i);\n    if (match) return match[1].trim();\n\n    // Look for imperative instructions\n    match = message.match(/^([A-Z][^.!?]+)/);\n    if (match && !match[1].toLowerCase().startsWith('that')) {\n      return match[1].trim();\n    }\n\n    return null;\n  }\n\n  /**\n   * Truncate string to max length\n   */\n  private truncate(str: string, maxLength: number): string {\n    if (str.length <= maxLength) return str;\n    return str.substring(0, maxLength - 3) + '...';\n  }\n}\n"],"version":3}