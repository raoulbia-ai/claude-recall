76ccc00bb867f46b718f0c051b30aca7
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PatternStore = void 0;
class PatternStore {
    constructor(storage) {
        this.storage = storage;
    }
    savePattern(pattern) {
        const existing = this.findSimilar(pattern);
        if (existing) {
            existing.frequency++;
            this.storage.save({
                key: `pattern_${existing.id}`,
                value: existing,
                type: 'correction-pattern',
                project_id: process.env.CLAUDE_PROJECT_DIR,
                file_path: undefined,
                timestamp: Date.now(),
                relevance_score: existing.frequency / 10
            });
        }
        else {
            this.storage.save({
                key: `pattern_${Date.now()}`,
                value: pattern,
                type: 'correction-pattern',
                project_id: process.env.CLAUDE_PROJECT_DIR,
                file_path: undefined,
                timestamp: Date.now(),
                relevance_score: 0.1
            });
        }
    }
    findSimilar(pattern) {
        // Search for similar patterns in memory
        const memories = this.storage.searchByContext({
            type: 'correction-pattern',
            project_id: process.env.CLAUDE_PROJECT_DIR,
            file_path: undefined
        });
        for (const memory of memories) {
            const stored = memory.value;
            if (stored.original === pattern.original &&
                stored.corrected === pattern.corrected &&
                stored.context === pattern.context) {
                return {
                    ...stored,
                    id: memory.key.replace('pattern_', '')
                };
            }
        }
        return null;
    }
    getFrequentPatterns(minFrequency = 2) {
        const patterns = this.storage.searchByContext({
            type: 'correction-pattern',
            project_id: process.env.CLAUDE_PROJECT_DIR,
            file_path: undefined
        });
        return patterns
            .map(m => m.value)
            .filter(p => p.frequency >= minFrequency)
            .sort((a, b) => b.frequency - a.frequency);
    }
}
exports.PatternStore = PatternStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL21udC9jL1VzZXJzL2ViaWFyYW8vcmVwb3MvY2xhdWRlLXJlY2FsbC9zcmMvbWVtb3J5L3BhdHRlcm4tc3RvcmUudHMiLCJtYXBwaW5ncyI6Ijs7O0FBR0EsTUFBYSxZQUFZO0lBQ3ZCLFlBQW9CLE9BQXNCO1FBQXRCLFlBQU8sR0FBUCxPQUFPLENBQWU7SUFBRyxDQUFDO0lBRTlDLFdBQVcsQ0FBQyxPQUEwQjtRQUNwQyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTNDLElBQUksUUFBUSxFQUFFLENBQUM7WUFDYixRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDckIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBQ2hCLEdBQUcsRUFBRSxXQUFXLFFBQVEsQ0FBQyxFQUFFLEVBQUU7Z0JBQzdCLEtBQUssRUFBRSxRQUFRO2dCQUNmLElBQUksRUFBRSxvQkFBb0I7Z0JBQzFCLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQjtnQkFDMUMsU0FBUyxFQUFFLFNBQVM7Z0JBQ3BCLFNBQVMsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO2dCQUNyQixlQUFlLEVBQUUsUUFBUSxDQUFDLFNBQVMsR0FBRyxFQUFFO2FBQ3pDLENBQUMsQ0FBQztRQUNMLENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBQ2hCLEdBQUcsRUFBRSxXQUFXLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDNUIsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsSUFBSSxFQUFFLG9CQUFvQjtnQkFDMUIsVUFBVSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCO2dCQUMxQyxTQUFTLEVBQUUsU0FBUztnQkFDcEIsU0FBUyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUU7Z0JBQ3JCLGVBQWUsRUFBRSxHQUFHO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDO0lBRU8sV0FBVyxDQUFDLE9BQTBCO1FBQzVDLHdDQUF3QztRQUN4QyxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQztZQUM1QyxJQUFJLEVBQUUsb0JBQW9CO1lBQzFCLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQjtZQUMxQyxTQUFTLEVBQUUsU0FBUztTQUNyQixDQUFDLENBQUM7UUFFSCxLQUFLLE1BQU0sTUFBTSxJQUFJLFFBQVEsRUFBRSxDQUFDO1lBQzlCLE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFZLENBQUM7WUFDbkMsSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxRQUFRO2dCQUNwQyxNQUFNLENBQUMsU0FBUyxLQUFLLE9BQU8sQ0FBQyxTQUFTO2dCQUN0QyxNQUFNLENBQUMsT0FBTyxLQUFLLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDdkMsT0FBTztvQkFDTCxHQUFHLE1BQU07b0JBQ1QsRUFBRSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7aUJBQ3ZDLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztRQUVELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELG1CQUFtQixDQUFDLGVBQXVCLENBQUM7UUFDMUMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUM7WUFDNUMsSUFBSSxFQUFFLG9CQUFvQjtZQUMxQixVQUFVLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0I7WUFDMUMsU0FBUyxFQUFFLFNBQVM7U0FDckIsQ0FBQyxDQUFDO1FBRUgsT0FBTyxRQUFRO2FBQ1osR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQTBCLENBQUM7YUFDdEMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsSUFBSSxZQUFZLENBQUM7YUFDeEMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDL0MsQ0FBQztDQUNGO0FBakVELG9DQWlFQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvbW50L2MvVXNlcnMvZWJpYXJhby9yZXBvcy9jbGF1ZGUtcmVjYWxsL3NyYy9tZW1vcnkvcGF0dGVybi1zdG9yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNZW1vcnlTdG9yYWdlIH0gZnJvbSAnLi9zdG9yYWdlJztcbmltcG9ydCB7IENvcnJlY3Rpb25QYXR0ZXJuIH0gZnJvbSAnLi4vY29yZS9wYXR0ZXJucyc7XG5cbmV4cG9ydCBjbGFzcyBQYXR0ZXJuU3RvcmUge1xuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHN0b3JhZ2U6IE1lbW9yeVN0b3JhZ2UpIHt9XG4gIFxuICBzYXZlUGF0dGVybihwYXR0ZXJuOiBDb3JyZWN0aW9uUGF0dGVybik6IHZvaWQge1xuICAgIGNvbnN0IGV4aXN0aW5nID0gdGhpcy5maW5kU2ltaWxhcihwYXR0ZXJuKTtcbiAgICBcbiAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgIGV4aXN0aW5nLmZyZXF1ZW5jeSsrO1xuICAgICAgdGhpcy5zdG9yYWdlLnNhdmUoe1xuICAgICAgICBrZXk6IGBwYXR0ZXJuXyR7ZXhpc3RpbmcuaWR9YCxcbiAgICAgICAgdmFsdWU6IGV4aXN0aW5nLFxuICAgICAgICB0eXBlOiAnY29ycmVjdGlvbi1wYXR0ZXJuJyxcbiAgICAgICAgcHJvamVjdF9pZDogcHJvY2Vzcy5lbnYuQ0xBVURFX1BST0pFQ1RfRElSLFxuICAgICAgICBmaWxlX3BhdGg6IHVuZGVmaW5lZCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICByZWxldmFuY2Vfc2NvcmU6IGV4aXN0aW5nLmZyZXF1ZW5jeSAvIDEwXG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdG9yYWdlLnNhdmUoe1xuICAgICAgICBrZXk6IGBwYXR0ZXJuXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgICB2YWx1ZTogcGF0dGVybixcbiAgICAgICAgdHlwZTogJ2NvcnJlY3Rpb24tcGF0dGVybicsXG4gICAgICAgIHByb2plY3RfaWQ6IHByb2Nlc3MuZW52LkNMQVVERV9QUk9KRUNUX0RJUixcbiAgICAgICAgZmlsZV9wYXRoOiB1bmRlZmluZWQsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgcmVsZXZhbmNlX3Njb3JlOiAwLjFcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICBcbiAgcHJpdmF0ZSBmaW5kU2ltaWxhcihwYXR0ZXJuOiBDb3JyZWN0aW9uUGF0dGVybik6IGFueSB8IG51bGwge1xuICAgIC8vIFNlYXJjaCBmb3Igc2ltaWxhciBwYXR0ZXJucyBpbiBtZW1vcnlcbiAgICBjb25zdCBtZW1vcmllcyA9IHRoaXMuc3RvcmFnZS5zZWFyY2hCeUNvbnRleHQoe1xuICAgICAgdHlwZTogJ2NvcnJlY3Rpb24tcGF0dGVybicsXG4gICAgICBwcm9qZWN0X2lkOiBwcm9jZXNzLmVudi5DTEFVREVfUFJPSkVDVF9ESVIsXG4gICAgICBmaWxlX3BhdGg6IHVuZGVmaW5lZFxuICAgIH0pO1xuICAgIFxuICAgIGZvciAoY29uc3QgbWVtb3J5IG9mIG1lbW9yaWVzKSB7XG4gICAgICBjb25zdCBzdG9yZWQgPSBtZW1vcnkudmFsdWUgYXMgYW55O1xuICAgICAgaWYgKHN0b3JlZC5vcmlnaW5hbCA9PT0gcGF0dGVybi5vcmlnaW5hbCAmJiBcbiAgICAgICAgICBzdG9yZWQuY29ycmVjdGVkID09PSBwYXR0ZXJuLmNvcnJlY3RlZCAmJlxuICAgICAgICAgIHN0b3JlZC5jb250ZXh0ID09PSBwYXR0ZXJuLmNvbnRleHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5zdG9yZWQsXG4gICAgICAgICAgaWQ6IG1lbW9yeS5rZXkucmVwbGFjZSgncGF0dGVybl8nLCAnJylcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgXG4gIGdldEZyZXF1ZW50UGF0dGVybnMobWluRnJlcXVlbmN5OiBudW1iZXIgPSAyKTogQ29ycmVjdGlvblBhdHRlcm5bXSB7XG4gICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnN0b3JhZ2Uuc2VhcmNoQnlDb250ZXh0KHtcbiAgICAgIHR5cGU6ICdjb3JyZWN0aW9uLXBhdHRlcm4nLFxuICAgICAgcHJvamVjdF9pZDogcHJvY2Vzcy5lbnYuQ0xBVURFX1BST0pFQ1RfRElSLFxuICAgICAgZmlsZV9wYXRoOiB1bmRlZmluZWRcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gcGF0dGVybnNcbiAgICAgIC5tYXAobSA9PiBtLnZhbHVlIGFzIENvcnJlY3Rpb25QYXR0ZXJuKVxuICAgICAgLmZpbHRlcihwID0+IHAuZnJlcXVlbmN5ID49IG1pbkZyZXF1ZW5jeSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiLmZyZXF1ZW5jeSAtIGEuZnJlcXVlbmN5KTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==