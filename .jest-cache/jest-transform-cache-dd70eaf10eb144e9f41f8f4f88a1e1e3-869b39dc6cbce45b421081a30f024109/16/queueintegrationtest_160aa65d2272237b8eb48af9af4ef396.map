{"file":"/mnt/c/Users/ebiarao/repos/claude-recall/tests/integration/queue-integration.test.ts","mappings":"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","names":[],"sources":["/mnt/c/Users/ebiarao/repos/claude-recall/tests/integration/queue-integration.test.ts"],"sourcesContent":["import { QueueIntegrationService, HookQueueIntegration, MCPQueueIntegration } from '../../src/services/queue-integration';\nimport { QueueAPI } from '../../src/services/queue-api';\nimport { QueueMCPTools, EnhancedMemoryMCPTools } from '../../src/mcp/queue-tools';\nimport { MemoryService } from '../../src/services/memory';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ndescribe('Queue Integration Tests', () => {\n  let testDbPath: string;\n  let integrationService: QueueIntegrationService;\n  let queueAPI: QueueAPI;\n\n  beforeEach(async () => {\n    testDbPath = path.join(__dirname, `test-integration-${Date.now()}.db`);\n    \n    // Mock config service\n    const mockConfig = {\n      getDatabasePath: () => testDbPath,\n      getProjectId: () => 'test-project'\n    };\n    \n    jest.doMock('../../src/services/config', () => ({\n      ConfigService: {\n        getInstance: () => mockConfig\n      }\n    }));\n\n    // Mock logging service\n    jest.doMock('../../src/services/logging', () => ({\n      LoggingService: {\n        getInstance: () => ({\n          info: jest.fn(),\n          warn: jest.fn(),\n          error: jest.fn(),\n          debug: jest.fn(),\n          logMemoryOperation: jest.fn(),\n          logRetrieval: jest.fn(),\n          logServiceError: jest.fn()\n        })\n      }\n    }));\n\n    integrationService = QueueIntegrationService.getInstance();\n    queueAPI = QueueAPI.getInstance();\n  });\n\n  afterEach(async () => {\n    // Shutdown integration service\n    integrationService.shutdown();\n    queueAPI.close();\n    \n    // Clean up test database\n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    \n    jest.clearAllMocks();\n    jest.resetModules();\n  });\n\n  describe('Integration Service Initialization', () => {\n    test('should initialize without errors', async () => {\n      await expect(integrationService.initialize()).resolves.not.toThrow();\n      \n      // Verify system health after initialization\n      const health = integrationService.getSystemHealth();\n      expect(health).toHaveProperty('isHealthy');\n      expect(health.totalPendingMessages).toBe(0);\n    });\n\n    test('should register all queue processors', async () => {\n      await integrationService.initialize();\n      \n      // Verify processors are registered by checking they can process messages\n      const hookMessageId = integrationService.processHookEvent('test-event', { test: 'data' });\n      const mcpMessageId = integrationService.processMCPOperation('test-tool', 'test-op', { test: 'data' });\n      \n      expect(hookMessageId).toBeGreaterThan(0);\n      expect(mcpMessageId).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Hook Integration', () => {\n    let hookIntegration: HookQueueIntegration;\n\n    beforeEach(async () => {\n      hookIntegration = HookQueueIntegration.getInstance();\n      await hookIntegration.initialize();\n    });\n\n    test('should process tool use events through queue', async () => {\n      const toolName = 'test-tool';\n      const toolInput = { param1: 'value1', param2: 123 };\n      const context = { sessionId: 'test-session', projectId: 'test-project' };\n\n      // Process tool use event\n      hookIntegration.processToolUse(toolName, toolInput, context);\n\n      // Give it a moment to queue\n      await new Promise(resolve => setTimeout(resolve, 100));\n\n      // Check if message was queued\n      const messages = queueAPI.peekMessages('hook-events', 10);\n      const toolUseMessage = messages.find(m => m.message_type === 'tool-use');\n      \n      expect(toolUseMessage).toBeDefined();\n      expect(toolUseMessage!.payload.toolName).toBe(toolName);\n      expect(toolUseMessage!.payload.toolInput).toEqual(toolInput);\n      expect(toolUseMessage!.payload.context).toEqual(context);\n    });\n\n    test('should process user prompts through queue', async () => {\n      const content = 'Create a new test file in the tests directory';\n      const context = { sessionId: 'test-session' };\n\n      hookIntegration.processUserPrompt(content, context);\n\n      // Check if message was queued\n      await new Promise(resolve => setTimeout(resolve, 100));\n      const messages = queueAPI.peekMessages('hook-events', 10);\n      const promptMessage = messages.find(m => m.message_type === 'user-prompt');\n      \n      expect(promptMessage).toBeDefined();\n      expect(promptMessage!.payload.content).toBe(content);\n      expect(promptMessage!.payload.context).toEqual(context);\n    });\n\n    test('should process Claude responses through queue', async () => {\n      const content = 'I\\'ll create a test file for you in the tests directory...';\n      const context = { sessionId: 'test-session', responseId: 'resp-123' };\n\n      hookIntegration.processClaudeResponse(content, context);\n\n      // Check if message was queued\n      await new Promise(resolve => setTimeout(resolve, 100));\n      const messages = queueAPI.peekMessages('hook-events', 10);\n      const responseMessage = messages.find(m => m.message_type === 'claude-response');\n      \n      expect(responseMessage).toBeDefined();\n      expect(responseMessage!.payload.content).toBe(content);\n      expect(responseMessage!.payload.context).toEqual(context);\n    });\n  });\n\n  describe('MCP Integration', () => {\n    let mcpIntegration: MCPQueueIntegration;\n\n    beforeEach(async () => {\n      mcpIntegration = MCPQueueIntegration.getInstance();\n      await mcpIntegration.initialize();\n    });\n\n    test('should process MCP tool calls through queue', async () => {\n      const toolName = 'memory';\n      const operation = 'search';\n      const payload = { query: 'test query', context: {} };\n\n      const messageId = mcpIntegration.processToolCall(toolName, operation, payload);\n      expect(messageId).toBeGreaterThan(0);\n\n      // Check if message was queued\n      const messages = queueAPI.peekMessages('mcp-operations', 10);\n      const mcpMessage = messages.find(m => m.id === messageId);\n      \n      expect(mcpMessage).toBeDefined();\n      expect(mcpMessage!.message_type).toBe('memory:search');\n      expect(mcpMessage!.payload).toEqual(payload);\n    });\n\n    test('should process memory searches with high priority', async () => {\n      const query = 'important search query';\n      const context = { urgent: true };\n\n      const messageId = mcpIntegration.processMemorySearch(query, context);\n      expect(messageId).toBeGreaterThan(0);\n\n      const messages = queueAPI.peekMessages('mcp-operations', 10);\n      const searchMessage = messages.find(m => m.id === messageId);\n      \n      expect(searchMessage).toBeDefined();\n      expect(searchMessage!.priority).toBe(6); // High priority for memory searches\n      expect(searchMessage!.message_type).toBe('memory:search');\n    });\n\n    test('should process memory store operations', async () => {\n      const data = { key: 'test-key', value: 'test-value', type: 'test' };\n      const context = { sessionId: 'test-session' };\n\n      const messageId = mcpIntegration.processMemoryStore(data, context);\n      expect(messageId).toBeGreaterThan(0);\n\n      const messages = queueAPI.peekMessages('mcp-operations', 10);\n      const storeMessage = messages.find(m => m.id === messageId);\n      \n      expect(storeMessage).toBeDefined();\n      expect(storeMessage!.message_type).toBe('memory:store');\n      expect(storeMessage!.priority).toBe(5); // Medium-high priority for memory storage\n    });\n  });\n\n  describe('Memory Service Integration', () => {\n    test('should patch MemoryService to use queue for pattern detection', async () => {\n      await integrationService.initialize();\n\n      // Mock MemoryService\n      const mockMemoryService = {\n        store: jest.fn(),\n        storePreferenceWithOverride: jest.fn()\n      };\n\n      // The integration service should patch the memory service\n      // This would be tested by verifying queue messages are created\n      // when memory operations are performed\n\n      expect(integrationService).toBeDefined();\n      // Additional integration tests would go here\n    });\n  });\n\n  describe('Error Handling', () => {\n    test('should handle processor errors gracefully', async () => {\n      await integrationService.initialize();\n\n      // Queue a message that might cause an error\n      const messageId = integrationService.processHookEvent('error-prone-event', {\n        causeError: true\n      });\n\n      expect(messageId).toBeGreaterThan(0);\n\n      // The system should handle errors without crashing\n      // Error messages should go to dead letter queue eventually\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      const health = integrationService.getSystemHealth();\n      expect(health).toBeDefined();\n    });\n\n    test('should track failed messages in dead letter queue', async () => {\n      await integrationService.initialize();\n\n      // This would test the retry and dead letter queue functionality\n      // by creating messages that fail processing multiple times\n      const messageId = integrationService.processHookEvent('failing-event', {\n        shouldFail: true,\n        maxRetries: 1\n      });\n\n      expect(messageId).toBeGreaterThan(0);\n\n      // After processing fails beyond max retries,\n      // message should appear in dead letter queue\n      await new Promise(resolve => setTimeout(resolve, 2000));\n\n      const dlqMessages = integrationService.getDeadLetterMessages(10);\n      // This would check if messages are properly moved to DLQ\n      expect(Array.isArray(dlqMessages)).toBe(true);\n    });\n  });\n\n  describe('Performance and Monitoring', () => {\n    test('should provide accurate system health metrics', async () => {\n      await integrationService.initialize();\n\n      // Add various types of messages\n      integrationService.processHookEvent('event1', {});\n      integrationService.processHookEvent('event2', {});\n      integrationService.processMCPOperation('tool1', 'op1', {});\n\n      const health = integrationService.getSystemHealth();\n\n      expect(health.isHealthy).toBe(true);\n      expect(health.totalPendingMessages).toBeGreaterThan(0);\n      expect(health.totalProcessingMessages).toBeGreaterThanOrEqual(0);\n      expect(health.totalFailedMessages).toBeGreaterThanOrEqual(0);\n      expect(health.uptime).toBeGreaterThan(0);\n    });\n\n    test('should provide queue statistics', async () => {\n      await integrationService.initialize();\n\n      // Add messages to different queues\n      integrationService.processHookEvent('hook-event', {});\n      integrationService.processMCPOperation('mcp-tool', 'operation', {});\n      integrationService.processMemoryOperation('store', { key: 'test', value: 'test' });\n\n      const allStats = integrationService.getQueueStats();\n      expect(Array.isArray(allStats)).toBe(true);\n\n      const hookStats = integrationService.getQueueStats('hook-events');\n      expect(hookStats.queueName).toBe('hook-events');\n      expect(hookStats.pending).toBeGreaterThan(0);\n    });\n  });\n});\n\ndescribe('MCP Queue Tools Integration', () => {\n  let queueTools: QueueMCPTools;\n  let enhancedMemoryTools: EnhancedMemoryMCPTools;\n  let testDbPath: string;\n\n  beforeEach(() => {\n    testDbPath = path.join(__dirname, `test-mcp-tools-${Date.now()}.db`);\n    \n    const mockConfig = {\n      getDatabasePath: () => testDbPath,\n      getProjectId: () => 'test-project'\n    };\n    \n    jest.doMock('../../src/services/config', () => ({\n      ConfigService: {\n        getInstance: () => mockConfig\n      }\n    }));\n\n    jest.doMock('../../src/services/logging', () => ({\n      LoggingService: {\n        getInstance: () => ({\n          info: jest.fn(),\n          warn: jest.fn(),\n          error: jest.fn(),\n          debug: jest.fn()\n        })\n      }\n    }));\n\n    queueTools = new QueueMCPTools();\n    enhancedMemoryTools = new EnhancedMemoryMCPTools();\n  });\n\n  afterEach(() => {\n    if (fs.existsSync(testDbPath)) {\n      fs.unlinkSync(testDbPath);\n    }\n    \n    jest.clearAllMocks();\n    jest.resetModules();\n  });\n\n  describe('Queue MCP Tools', () => {\n    test('should provide correct tool definitions', () => {\n      const tools = queueTools.getToolsDefinition();\n      \n      expect(Array.isArray(tools)).toBe(true);\n      expect(tools.length).toBeGreaterThan(0);\n      \n      const toolNames = tools.map(t => t.name);\n      expect(toolNames).toContain('mcp__claude-recall__queue_status');\n      expect(toolNames).toContain('mcp__claude-recall__queue_stats');\n      expect(toolNames).toContain('mcp__claude-recall__queue_peek');\n      expect(toolNames).toContain('mcp__claude-recall__queue_enqueue');\n    });\n\n    test('should handle queue status requests', async () => {\n      const result = await queueTools.handleToolCall('mcp__claude-recall__queue_status', {});\n      \n      expect(result).toHaveProperty('system_health');\n      expect(result).toHaveProperty('queue_stats');\n      expect(result).toHaveProperty('timestamp');\n      expect(result.system_health).toHaveProperty('isHealthy');\n    });\n\n    test('should handle queue peek requests', async () => {\n      // First enqueue some messages\n      const queueAPI = QueueAPI.getInstance();\n      queueAPI.enqueueHookEvent('test-event', { test: 'data' });\n      queueAPI.enqueueMCPOperation('test-tool', 'test-op', { test: 'data' });\n      \n      const result = await queueTools.handleToolCall('mcp__claude-recall__queue_peek', {\n        queue_name: 'hook-events',\n        limit: 5\n      });\n      \n      expect(result).toHaveProperty('queue_name', 'hook-events');\n      expect(result).toHaveProperty('messages');\n      expect(result).toHaveProperty('count');\n      expect(Array.isArray(result.messages)).toBe(true);\n      \n      queueAPI.close();\n    });\n\n    test('should handle manual enqueue requests', async () => {\n      const result = await queueTools.handleToolCall('mcp__claude-recall__queue_enqueue', {\n        queue_name: 'hook-events',\n        message_type: 'manual-test',\n        payload: { test: 'manual enqueue' },\n        priority: 8\n      });\n      \n      expect(result).toHaveProperty('success', true);\n      expect(result).toHaveProperty('message_id');\n      expect(result.message_id).toBeGreaterThan(0);\n    });\n  });\n\n  describe('Enhanced Memory MCP Tools', () => {\n    test('should provide correct tool definitions', () => {\n      const tools = enhancedMemoryTools.getToolsDefinition();\n      \n      expect(Array.isArray(tools)).toBe(true);\n      expect(tools.length).toBeGreaterThan(0);\n      \n      const toolNames = tools.map(t => t.name);\n      expect(toolNames).toContain('mcp__claude-recall__async_memory_search');\n      expect(toolNames).toContain('mcp__claude-recall__async_pattern_detection');\n      expect(toolNames).toContain('mcp__claude-recall__bulk_memory_operation');\n    });\n\n    test('should handle async memory search requests', async () => {\n      const result = await enhancedMemoryTools.handleToolCall('mcp__claude-recall__async_memory_search', {\n        query: 'test search query',\n        context: { sessionId: 'test-session' },\n        priority: 8\n      });\n      \n      expect(result).toHaveProperty('success', true);\n      expect(result).toHaveProperty('message_id');\n      expect(result).toHaveProperty('status', 'queued_for_processing');\n      expect(result.message_id).toBeGreaterThan(0);\n    });\n\n    test('should handle async pattern detection requests', async () => {\n      const result = await enhancedMemoryTools.handleToolCall('mcp__claude-recall__async_pattern_detection', {\n        content: 'I always prefer TypeScript over JavaScript for new projects',\n        context: { type: 'user-preference' },\n        priority: 7\n      });\n      \n      expect(result).toHaveProperty('success', true);\n      expect(result).toHaveProperty('message_id');\n      expect(result).toHaveProperty('status', 'queued_for_analysis');\n      expect(result.content_length).toBeGreaterThan(0);\n    });\n\n    test('should handle bulk memory operations', async () => {\n      const operations = [\n        {\n          operation: 'store',\n          payload: { key: 'test1', value: 'value1', type: 'test' }\n        },\n        {\n          operation: 'store',\n          payload: { key: 'test2', value: 'value2', type: 'test' }\n        },\n        {\n          operation: 'search',\n          payload: { query: 'test values' }\n        }\n      ];\n\n      const result = await enhancedMemoryTools.handleToolCall('mcp__claude-recall__bulk_memory_operation', {\n        operations,\n        batch_priority: 6\n      });\n      \n      expect(result).toHaveProperty('success', true);\n      expect(result).toHaveProperty('batch_id');\n      expect(result).toHaveProperty('message_ids');\n      expect(result).toHaveProperty('operations_count', 3);\n      expect(Array.isArray(result.message_ids)).toBe(true);\n      expect(result.message_ids.length).toBe(3);\n    });\n  });\n\n  describe('Error Handling', () => {\n    test('should handle invalid tool names gracefully', async () => {\n      await expect(queueTools.handleToolCall('invalid_tool_name', {}))\n        .rejects\n        .toThrow('Unknown queue tool');\n        \n      await expect(enhancedMemoryTools.handleToolCall('invalid_memory_tool', {}))\n        .rejects\n        .toThrow('Unknown enhanced memory tool');\n    });\n\n    test('should validate input parameters', async () => {\n      // Test missing required parameters\n      await expect(queueTools.handleToolCall('mcp__claude-recall__queue_peek', {}))\n        .rejects\n        .toThrow();\n        \n      await expect(enhancedMemoryTools.handleToolCall('mcp__claude-recall__async_memory_search', {}))\n        .rejects\n        .toThrow();\n    });\n  });\n});"],"version":3}